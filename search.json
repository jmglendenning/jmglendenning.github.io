[
  {
    "objectID": "hmm_analysis.html",
    "href": "hmm_analysis.html",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "",
    "text": "This analysis adapts the spatio-temporal HMM framework from Pasanen et al. (2024) “Hidden Markov modelling of spatio-temporal dynamics of measles in 1750–1850 Finland” to Roman coin hoard data.\n\n\n\n\n\nPasanen et al. (Measles)\nThis Analysis (Coins)\n\n\n\n\nParish (N = 387)\nHex cell (N ~ 100)\n\n\nMonth (T = 1212)\nTPQ period (T = 4)\n\n\nBinary: death observed\nContinuous: Rome proportion\n\n\nStates: epidemic phases\nStates: monetary regimes\n\n\nICAR: spatial correlation\nICAR: spatial correlation\n\n\n\n\n\n\nFollowing Pasanen et al. equation (5), but adapted for continuous proportions:\n\\[y_{i,t} \\sim \\text{Beta}(\\alpha_{x_t}, \\beta_{x_t})\\]\nwhere the mean is:\n\\[\\text{logit}(\\mu_{x_t}) = \\mu_{x_t} + \\lambda_i + \\sigma_\\phi \\phi_{i,x_t}\\]\nComponents:\n\n\\(\\mu_{x_t}\\): State-specific baseline (ordered to avoid label switching)\n\\(\\lambda_i\\): Site-specific constant (non-spatial heterogeneity)\n\\(\\sigma_\\phi \\phi_{i,x_t}\\): State-specific ICAR spatial effects\n\\(x_t\\): Hidden state at time \\(t\\), following first-order Markov chain\n\n\n\n\nGiven computational constraints and limited temporal resolution (T=4 periods), we implement a simplified version first:\n\nAggregate HMM: Fit HMM at the aggregate level (all hexes combined) to identify temporal regimes\nSpatial variation by regime: Examine spatial patterns within each identified regime\nFull spatial HMM: If computational resources permit, fit the full ICAR-HMM"
  },
  {
    "objectID": "hmm_analysis.html#adapting-pasanen-et-al.-2024-to-numismatic-data",
    "href": "hmm_analysis.html#adapting-pasanen-et-al.-2024-to-numismatic-data",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "",
    "text": "This analysis adapts the spatio-temporal HMM framework from Pasanen et al. (2024) “Hidden Markov modelling of spatio-temporal dynamics of measles in 1750–1850 Finland” to Roman coin hoard data.\n\n\n\n\n\nPasanen et al. (Measles)\nThis Analysis (Coins)\n\n\n\n\nParish (N = 387)\nHex cell (N ~ 100)\n\n\nMonth (T = 1212)\nTPQ period (T = 4)\n\n\nBinary: death observed\nContinuous: Rome proportion\n\n\nStates: epidemic phases\nStates: monetary regimes\n\n\nICAR: spatial correlation\nICAR: spatial correlation\n\n\n\n\n\n\nFollowing Pasanen et al. equation (5), but adapted for continuous proportions:\n\\[y_{i,t} \\sim \\text{Beta}(\\alpha_{x_t}, \\beta_{x_t})\\]\nwhere the mean is:\n\\[\\text{logit}(\\mu_{x_t}) = \\mu_{x_t} + \\lambda_i + \\sigma_\\phi \\phi_{i,x_t}\\]\nComponents:\n\n\\(\\mu_{x_t}\\): State-specific baseline (ordered to avoid label switching)\n\\(\\lambda_i\\): Site-specific constant (non-spatial heterogeneity)\n\\(\\sigma_\\phi \\phi_{i,x_t}\\): State-specific ICAR spatial effects\n\\(x_t\\): Hidden state at time \\(t\\), following first-order Markov chain\n\n\n\n\nGiven computational constraints and limited temporal resolution (T=4 periods), we implement a simplified version first:\n\nAggregate HMM: Fit HMM at the aggregate level (all hexes combined) to identify temporal regimes\nSpatial variation by regime: Examine spatial patterns within each identified regime\nFull spatial HMM: If computational resources permit, fit the full ICAR-HMM"
  },
  {
    "objectID": "hmm_analysis.html#create-period-stratified-observations",
    "href": "hmm_analysis.html#create-period-stratified-observations",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "4.1 Create Period-Stratified Observations",
    "text": "4.1 Create Period-Stratified Observations\n\n\nCode\n# Flag Rome and parse TPQ\nchrr_prep &lt;- chrr_raw %&gt;%\n  mutate(\n    is_rome = mint_id == \"rome\" | str_detect(mint_uri, \"/id/rome$\"),\n    is_rome = replace_na(is_rome, FALSE),\n    tpq_year = readr::parse_number(as.character(hoard_tpq))\n  ) %&gt;%\n  filter(!is.na(tpq_year), !is.na(hoard_lat), !is.na(hoard_long))\n\n# Period bins\nperiod_breaks &lt;- c(-Inf, -150, -100, -50, 14, Inf)\nperiod_labels &lt;- c(\n  \"1: Early Republic\",\n  \"2: Late Republic I\",\n  \"3: Late Republic II\", \n  \"4: Triumviral/Augustan\",\n  \"5: Early Imperial\"\n)\n\nchrr_prep &lt;- chrr_prep %&gt;%\n  mutate(\n    tpq_period = cut(tpq_year, breaks = period_breaks, labels = period_labels, right = TRUE),\n    tpq_period_num = as.integer(tpq_period)\n  ) %&gt;%\n  filter(!is.na(tpq_period))\n\n# Aggregate to hoard level\nhoard_comp &lt;- chrr_prep %&gt;%\n  group_by(hoard_id, hoard_lat, hoard_long, tpq_year, tpq_period, tpq_period_num) %&gt;%\n  summarise(\n    n_types = n(),\n    n_rome = sum(is_rome),\n    p_rome = n_rome / n_types,\n    .groups = \"drop\"\n  )\n\ncat(\"Hoards with TPQ:\", nrow(hoard_comp), \"\\n\")\n\n\nHoards with TPQ: 463 \n\n\nCode\ncat(\"Periods present:\", paste(unique(hoard_comp$tpq_period), collapse = \", \"), \"\\n\")\n\n\nPeriods present: 4: Triumviral/Augustan, 3: Late Republic II, 2: Late Republic I, 1: Early Republic"
  },
  {
    "objectID": "hmm_analysis.html#aggregate-time-series-for-hmm",
    "href": "hmm_analysis.html#aggregate-time-series-for-hmm",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "4.2 Aggregate Time Series for HMM",
    "text": "4.2 Aggregate Time Series for HMM\n\n\nCode\n# Create aggregate time series (all hoards combined per period)\nperiod_agg &lt;- hoard_comp %&gt;%\n  group_by(tpq_period, tpq_period_num) %&gt;%\n  summarise(\n    n_hoards = n(),\n    total_types = sum(n_types),\n    rome_types = sum(n_rome),\n    p_rome = rome_types / total_types,\n    mean_p_rome = mean(p_rome),\n    sd_p_rome = sd(p_rome),\n    .groups = \"drop\"\n  ) %&gt;%\n  arrange(tpq_period_num)\n\nkable(period_agg, digits = 3, caption = \"Aggregate Rome proportion by period\")\n\n\n\nAggregate Rome proportion by period\n\n\n\n\n\n\n\n\n\n\n\n\ntpq_period\ntpq_period_num\nn_hoards\ntotal_types\nrome_types\np_rome\nmean_p_rome\nsd_p_rome\n\n\n\n\n1: Early Republic\n1\n11\n185\n106\n0.573\n0.573\nNA\n\n\n2: Late Republic I\n2\n87\n4346\n4105\n0.945\n0.945\nNA\n\n\n3: Late Republic II\n3\n166\n9826\n9279\n0.944\n0.944\nNA\n\n\n4: Triumviral/Augustan\n4\n199\n16075\n13310\n0.828\n0.828\nNA"
  },
  {
    "objectID": "hmm_analysis.html#fit-2-state-and-3-state-hmms",
    "href": "hmm_analysis.html#fit-2-state-and-3-state-hmms",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "5.1 Fit 2-State and 3-State HMMs",
    "text": "5.1 Fit 2-State and 3-State HMMs\nSince we have only 4 time points at the aggregate level, a traditional HMM is underpowered. Instead, we’ll use the hoard-level data where each hoard is an observation within a period, allowing the HMM to learn state-specific emission distributions.\n\n\nCode\n# For HMM, we need a \"sequence\" - treat periods as time, hoards as repeated observations\n# Reshape: each row is a hoard with its period and Rome proportion\n\nhmm_data &lt;- hoard_comp %&gt;%\n  dplyr::select(hoard_id, tpq_period_num, p_rome, n_types) %&gt;%\n  arrange(hoard_id, tpq_period_num) %&gt;%\n  # Weight by sample size for more reliable estimates\n  mutate(\n    # Transform proportion to avoid 0/1 boundary issues for beta\n    p_rome_adj = pmax(0.001, pmin(0.999, p_rome))\n  )\n\ncat(\"Observations for HMM:\", nrow(hmm_data), \"\\n\")\n\n\nObservations for HMM: 463"
  },
  {
    "objectID": "hmm_analysis.html#fit-gaussian-mixture-hmm-on-period-means",
    "href": "hmm_analysis.html#fit-gaussian-mixture-hmm-on-period-means",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "5.2 Fit Gaussian Mixture HMM on Period Means",
    "text": "5.2 Fit Gaussian Mixture HMM on Period Means\nGiven the structure of our data (4 periods, ~500 hoards), we’ll fit an HMM where:\n\nTime dimension: The 4 TPQ periods\nObservations: The distribution of Rome proportions across hoards within each period\nStates: Latent monetary regimes\n\n\n\nCode\n# Aggregate to period level with distributional summary\nperiod_stats &lt;- hoard_comp %&gt;%\n  group_by(tpq_period_num) %&gt;%\n  summarise(\n    n = n(),\n    mean_p = mean(p_rome),\n    sd_p = sd(p_rome),\n    median_p = median(p_rome),\n    q25 = quantile(p_rome, 0.25),\n    q75 = quantile(p_rome, 0.75),\n    .groups = \"drop\"\n  ) %&gt;%\n  arrange(tpq_period_num)\n\nkable(period_stats, digits = 3, caption = \"Rome proportion distribution by period\")\n\n\n\nRome proportion distribution by period\n\n\ntpq_period_num\nn\nmean_p\nsd_p\nmedian_p\nq25\nq75\n\n\n\n\n1\n11\n0.657\n0.205\n0.583\n0.528\n0.784\n\n\n2\n87\n0.954\n0.064\n0.966\n0.936\n1.000\n\n\n3\n166\n0.949\n0.071\n0.951\n0.930\n1.000\n\n\n4\n199\n0.804\n0.181\n0.859\n0.734\n0.923"
  },
  {
    "objectID": "hmm_analysis.html#visual-regime-detection",
    "href": "hmm_analysis.html#visual-regime-detection",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "5.3 Visual Regime Detection",
    "text": "5.3 Visual Regime Detection\nBefore formal HMM, let’s visualize the distributional shifts:\n\n\nCode\n# Density plots by period\np1 &lt;- ggplot(hoard_comp, aes(x = p_rome, fill = tpq_period)) +\n  geom_density(alpha = 0.5) +\n  scale_fill_viridis_d(option = \"plasma\") +\n  labs(\n    title = \"Rome Proportion Distribution by Period\",\n    x = \"Rome proportion\",\n    y = \"Density\",\n    fill = \"Period\"\n  ) +\n  theme(legend.position = \"bottom\")\n\n# Boxplot comparison\np2 &lt;- ggplot(hoard_comp, aes(x = tpq_period, y = p_rome, fill = tpq_period)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(alpha = 0.2, width = 0.2, size = 0.5) +\n  scale_fill_viridis_d(option = \"plasma\") +\n  labs(\n    title = \"Rome Proportion by Period\",\n    x = NULL,\n    y = \"Rome proportion\"\n  ) +\n  theme(\n    axis.text.x = element_text(angle = 30, hjust = 1),\n    legend.position = \"none\"\n  )\n\np1 + p2"
  },
  {
    "objectID": "hmm_analysis.html#k-means-clustering-on-period-characteristics",
    "href": "hmm_analysis.html#k-means-clustering-on-period-characteristics",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "5.4 K-Means Clustering on Period Characteristics",
    "text": "5.4 K-Means Clustering on Period Characteristics\nAs a precursor to HMM, identify natural clusters in the period-level statistics:\n\n\nCode\n# Features for clustering\nperiod_features &lt;- period_stats %&gt;%\n  dplyr::select(tpq_period_num, mean_p, sd_p, median_p) %&gt;%\n  column_to_rownames(\"tpq_period_num\")\n\n# Try 2 and 3 clusters\nset.seed(42)\nkm2 &lt;- kmeans(scale(period_features), centers = 2, nstart = 25)\nkm3 &lt;- kmeans(scale(period_features), centers = 3, nstart = 25)\n\nperiod_stats &lt;- period_stats %&gt;%\n  mutate(\n    regime_2 = km2$cluster,\n    regime_3 = km3$cluster\n  )\n\nkable(period_stats %&gt;% dplyr::select(tpq_period_num, mean_p, sd_p, regime_2, regime_3),\n      digits = 3,\n      caption = \"Period clustering into regimes\")\n\n\n\nPeriod clustering into regimes\n\n\ntpq_period_num\nmean_p\nsd_p\nregime_2\nregime_3\n\n\n\n\n1\n0.657\n0.205\n1\n3\n\n\n2\n0.954\n0.064\n2\n1\n\n\n3\n0.949\n0.071\n2\n1\n\n\n4\n0.804\n0.181\n1\n2"
  },
  {
    "objectID": "hmm_analysis.html#fit-depmixs4-hmm",
    "href": "hmm_analysis.html#fit-depmixs4-hmm",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "5.5 Fit depmixS4 HMM",
    "text": "5.5 Fit depmixS4 HMM\n\n\nCode\n# Create a dataset suitable for depmixS4\n# Each \"sequence\" is one period; observations are the individual hoards\n# We need to structure this as panel data\n\n# Simpler approach: treat the aggregate period statistics as a time series\n# and fit HMM on the mean/variance\n\n# For a proper HMM with 4 time points, we need to think carefully\n# Let's use the hoard-level data with period as the time index\n\n# Create individual \"trajectories\" - but we only have 1 observation per hoard\n# This won't work for traditional HMM\n\n# Alternative: Fit mixture model to detect regimes in the pooled data\nlibrary(mclust)\n\n# Fit Gaussian mixture on Rome proportions\ngmm_fit &lt;- Mclust(hoard_comp$p_rome, G = 2:4)\n\ncat(\"Optimal number of components:\", gmm_fit$G, \"\\n\")\n\n\nOptimal number of components: 2 \n\n\nCode\ncat(\"BIC values:\\n\")\n\n\nBIC values:\n\n\nCode\nprint(gmm_fit$BIC)\n\n\nBayesian Information Criterion (BIC): \n         E        V\n2 614.8660 840.0573\n3 602.5896       NA\n4 590.3134       NA\n\nTop 3 models based on the BIC criterion: \n     V,2      E,2      E,3 \n840.0573 614.8660 602.5896 \n\n\n\n\nCode\n# Add cluster assignments\nhoard_comp$gmm_cluster &lt;- gmm_fit$classification\n\n# Summarize by period and cluster\nperiod_cluster &lt;- hoard_comp %&gt;%\n  group_by(tpq_period, tpq_period_num, gmm_cluster) %&gt;%\n  summarise(n = n(), .groups = \"drop\") %&gt;%\n  group_by(tpq_period_num) %&gt;%\n  mutate(prop = n / sum(n)) %&gt;%\n  ungroup()\n\n# Visualize cluster composition by period\nggplot(period_cluster, aes(x = factor(tpq_period_num), y = prop, fill = factor(gmm_cluster))) +\n  geom_col(position = \"stack\") +\n  scale_fill_viridis_d(name = \"Cluster\", option = \"plasma\") +\n  scale_x_discrete(labels = c(\"Early\\nRepublic\", \"Late Rep I\", \"Late Rep II\", \"Triumviral/\\nAugustan\")) +\n  labs(\n    title = \"Hoard Cluster Composition by Period\",\n    subtitle = paste(\"Gaussian Mixture Model with\", gmm_fit$G, \"components\"),\n    x = \"Period\",\n    y = \"Proportion of hoards\"\n  )"
  },
  {
    "objectID": "hmm_analysis.html#define-states-based-on-prior-analysis",
    "href": "hmm_analysis.html#define-states-based-on-prior-analysis",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "6.1 Define States Based on Prior Analysis",
    "text": "6.1 Define States Based on Prior Analysis\n\n\nCode\n# Based on TPQ and mint-date analysis:\n# State 1: Pre-transition (periods 1-2): High Rome %, no distance decay\n# State 2: Transition (period 3): Intermediate\n# State 3: Post-transition (period 4): Lower Rome %, distance decay emerges\n\nhoard_comp &lt;- hoard_comp %&gt;%\n  mutate(\n    regime = case_when(\n      tpq_period_num &lt;= 2 ~ \"A: Pre-transition\",\n      tpq_period_num == 3 ~ \"B: Transition\",\n      tpq_period_num &gt;= 4 ~ \"C: Post-transition\"\n    ),\n    regime_num = case_when(\n      tpq_period_num &lt;= 2 ~ 1,\n      tpq_period_num == 3 ~ 2,\n      tpq_period_num &gt;= 4 ~ 3\n    )\n  )\n\nregime_summary &lt;- hoard_comp %&gt;%\n  group_by(regime) %&gt;%\n  summarise(\n    n_hoards = n(),\n    mean_p_rome = mean(p_rome),\n    sd_p_rome = sd(p_rome),\n    .groups = \"drop\"\n  )\n\nkable(regime_summary, digits = 3, caption = \"Summary by assigned regime\")\n\n\n\nSummary by assigned regime\n\n\nregime\nn_hoards\nmean_p_rome\nsd_p_rome\n\n\n\n\nA: Pre-transition\n98\n0.921\n0.130\n\n\nB: Transition\n166\n0.949\n0.071\n\n\nC: Post-transition\n199\n0.804\n0.181"
  },
  {
    "objectID": "hmm_analysis.html#spatial-analysis-by-regime",
    "href": "hmm_analysis.html#spatial-analysis-by-regime",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "6.2 Spatial Analysis by Regime",
    "text": "6.2 Spatial Analysis by Regime\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Convert to sf\nhoard_sf &lt;- st_as_sf(\n  hoard_comp,\n  coords = c(\"hoard_long\", \"hoard_lat\"),\n  crs = 4326,\n  remove = FALSE\n)\n\n# Land and extent\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;% st_union()\n\nhoard_bbox &lt;- st_bbox(hoard_sf)\npad &lt;- 2\n\nstudy_extent &lt;- st_polygon(list(rbind(\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad)\n))) %&gt;% st_sfc(crs = 4326)\n\nstudy_land &lt;- st_intersection(land, study_extent)\n\n# Project\ntarget_crs &lt;- 3035\nhoard_sf_proj &lt;- st_transform(hoard_sf, target_crs)\nstudy_land_proj &lt;- st_transform(study_land, target_crs)\n\nrome_mint &lt;- st_as_sf(\n  tibble(lon = 12.4964, lat = 41.9028),\n  coords = c(\"lon\", \"lat\"), crs = 4326\n) %&gt;% st_transform(target_crs)"
  },
  {
    "objectID": "hmm_analysis.html#hex-grid-and-aggregation-by-regime",
    "href": "hmm_analysis.html#hex-grid-and-aggregation-by-regime",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "6.3 Hex Grid and Aggregation by Regime",
    "text": "6.3 Hex Grid and Aggregation by Regime\n\n\nCode\nhex_size &lt;- 100000\n\nhex_grid &lt;- st_make_grid(study_land_proj, cellsize = hex_size, square = FALSE) %&gt;%\n  st_sf(hex_id = seq_along(.), geometry = .) %&gt;%\n  st_set_crs(target_crs)\n\nhex_land &lt;- hex_grid %&gt;%\n  filter(lengths(st_intersects(., study_land_proj)) &gt; 0)\n\nhex_centroids &lt;- st_centroid(hex_land)\non_land &lt;- lengths(st_intersects(hex_centroids, study_land_proj)) &gt; 0\nhex_land &lt;- hex_land[on_land, ]\n\n# Spatial join\nhoard_hex &lt;- st_join(hoard_sf_proj, hex_land, join = st_within) %&gt;%\n  filter(!is.na(hex_id))\n\n# Aggregate by hex AND regime\nhex_regime &lt;- hoard_hex %&gt;%\n  st_drop_geometry() %&gt;%\n  group_by(hex_id, regime, regime_num) %&gt;%\n  summarise(\n    n_hoards = n(),\n    total_types = sum(n_types),\n    rome_types = sum(n_rome),\n    p_rome = rome_types / total_types,\n    .groups = \"drop\"\n  )\n\n# Regime-specific globals\nregime_globals &lt;- hex_regime %&gt;%\n  group_by(regime, regime_num) %&gt;%\n  summarise(\n    p_rome_regime = sum(rome_types) / sum(total_types),\n    .groups = \"drop\"\n  )\n\nkable(regime_globals, digits = 3, caption = \"Global Rome proportion by regime\")\n\n\n\nGlobal Rome proportion by regime\n\n\nregime\nregime_num\np_rome_regime\n\n\n\n\nA: Pre-transition\n1\n0.927\n\n\nB: Transition\n2\n0.945\n\n\nC: Post-transition\n3\n0.835\n\n\n\n\n\nCode\n# Compute LRR by regime\nhex_regime_lrr &lt;- hex_regime %&gt;%\n  left_join(regime_globals, by = c(\"regime\", \"regime_num\")) %&gt;%\n  mutate(\n    LRR = log(p_rome + 0.01) - log(p_rome_regime)\n  )"
  },
  {
    "objectID": "hmm_analysis.html#regime-specific-spatial-maps",
    "href": "hmm_analysis.html#regime-specific-spatial-maps",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "6.4 Regime-Specific Spatial Maps",
    "text": "6.4 Regime-Specific Spatial Maps\n\n\nCode\nhex_regime_sf &lt;- hex_land %&gt;%\n  inner_join(hex_regime_lrr, by = \"hex_id\") %&gt;%\n  st_transform(4326)\n\nland_wgs &lt;- st_transform(study_land_proj, 4326)\nrome_wgs &lt;- st_transform(rome_mint, 4326)\n\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_regime_sf,\n    aes(fill = LRR),\n    color = \"grey50\",\n    linewidth = 0.15\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 3, stroke = 1) +\n  scale_fill_gradient2(\n    low = \"steelblue\", mid = \"white\", high = \"darkred\",\n    midpoint = 0, name = \"LRR\",\n    limits = c(-0.5, 0.5), oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  facet_wrap(~regime, ncol = 3) +\n  labs(\n    title = \"Compositional LRR by Monetary Regime\",\n    subtitle = \"Red = above regime average | Blue = below | Star = Rome mint\",\n    caption = \"Regimes defined by TPQ period grouping\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    strip.text = element_text(size = 10, face = \"bold\")\n  )"
  },
  {
    "objectID": "hmm_analysis.html#emission-model-definition",
    "href": "hmm_analysis.html#emission-model-definition",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "7.1 Emission Model Definition",
    "text": "7.1 Emission Model Definition\nDefine emission probabilities based on observed distributions:\n\n\nCode\n# For each regime, estimate the emission distribution parameters\nemission_params &lt;- hoard_comp %&gt;%\n  group_by(regime_num) %&gt;%\n  summarise(\n    mu = mean(p_rome),\n    sigma = sd(p_rome),\n    n = n(),\n    .groups = \"drop\"\n  )\n\nkable(emission_params, digits = 4, caption = \"Emission distribution parameters by regime\")\n\n\n\nEmission distribution parameters by regime\n\n\nregime_num\nmu\nsigma\nn\n\n\n\n\n1\n0.9207\n0.1298\n98\n\n\n2\n0.9488\n0.0711\n166\n\n\n3\n0.8035\n0.1811\n199\n\n\n\n\n\nCode\n# Define emission probability function (Gaussian)\nemission_prob &lt;- function(p_rome, state, params) {\n  mu &lt;- params$mu[params$regime_num == state]\n  sigma &lt;- params$sigma[params$regime_num == state]\n  dnorm(p_rome, mean = mu, sd = sigma)\n}"
  },
  {
    "objectID": "hmm_analysis.html#transition-matrix-estimation",
    "href": "hmm_analysis.html#transition-matrix-estimation",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "7.2 Transition Matrix Estimation",
    "text": "7.2 Transition Matrix Estimation\n\n\nCode\n# Count transitions between periods\n# Since we defined regimes by period, transitions are deterministic:\n# Period 1,2 -&gt; Regime 1\n# Period 3 -&gt; Regime 2\n# Period 4 -&gt; Regime 3\n\n# For a proper HMM, we'd estimate transitions from repeated observations\n# Here we'll define a plausible transition matrix based on the regime structure\n\n# Transition matrix: probability of moving from row state to column state\n# Given our setup: we expect state persistence with gradual transitions\n\ntrans_matrix &lt;- matrix(\n  c(0.7, 0.3, 0.0,   # From state 1\n    0.1, 0.6, 0.3,   # From state 2\n    0.0, 0.2, 0.8),  # From state 3\n  nrow = 3, byrow = TRUE,\n  dimnames = list(c(\"Pre\", \"Trans\", \"Post\"), c(\"Pre\", \"Trans\", \"Post\"))\n)\n\nkable(trans_matrix, digits = 2, caption = \"Assumed transition matrix\")\n\n\n\nAssumed transition matrix\n\n\n\nPre\nTrans\nPost\n\n\n\n\nPre\n0.7\n0.3\n0.0\n\n\nTrans\n0.1\n0.6\n0.3\n\n\nPost\n0.0\n0.2\n0.8"
  },
  {
    "objectID": "hmm_analysis.html#forward-backward-algorithm-conceptual",
    "href": "hmm_analysis.html#forward-backward-algorithm-conceptual",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "7.3 Forward-Backward Algorithm (Conceptual)",
    "text": "7.3 Forward-Backward Algorithm (Conceptual)\n\n\nCode\n# For illustration, compute the most likely state sequence\n# given our 4 periods and the observed Rome proportions\n\n# Aggregate observations per period\nperiod_obs &lt;- period_agg %&gt;%\n  dplyr::select(tpq_period_num, p_rome) %&gt;%\n  rename(period = tpq_period_num, obs = p_rome)\n\n# Initial state probabilities\ninit_prob &lt;- c(0.8, 0.15, 0.05)  # Start likely in pre-transition\n\n# Forward algorithm\nforward_probs &lt;- matrix(0, nrow = nrow(period_obs), ncol = 3)\ncolnames(forward_probs) &lt;- c(\"Pre\", \"Trans\", \"Post\")\n\nfor (t in 1:nrow(period_obs)) {\n  obs &lt;- period_obs$obs[t]\n  \n  # Emission probabilities for this observation\n  emit &lt;- sapply(1:3, function(s) emission_prob(obs, s, emission_params))\n  \n  if (t == 1) {\n    forward_probs[t, ] &lt;- init_prob * emit\n  } else {\n    for (s in 1:3) {\n      forward_probs[t, s] &lt;- emit[s] * sum(forward_probs[t-1, ] * trans_matrix[, s])\n    }\n  }\n  # Normalize\n  forward_probs[t, ] &lt;- forward_probs[t, ] / sum(forward_probs[t, ])\n}\n\n# Most likely state per period\nmost_likely &lt;- apply(forward_probs, 1, which.max)\nstate_names &lt;- c(\"Pre-transition\", \"Transition\", \"Post-transition\")\n\nviterbi_result &lt;- tibble(\n  period = period_obs$period,\n  period_label = period_labels[period_obs$period],\n  obs_p_rome = period_obs$obs,\n  prob_pre = forward_probs[, 1],\n  prob_trans = forward_probs[, 2],\n  prob_post = forward_probs[, 3],\n  most_likely_state = state_names[most_likely]\n)\n\nkable(viterbi_result, digits = 3, caption = \"Forward algorithm state probabilities\")\n\n\n\nForward algorithm state probabilities\n\n\n\n\n\n\n\n\n\n\n\nperiod\nperiod_label\nobs_p_rome\nprob_pre\nprob_trans\nprob_post\nmost_likely_state\n\n\n\n\n1\n1: Early Republic\n0.573\n0.581\n0.000\n0.419\nPre-transition\n\n\n2\n2: Late Republic I\n0.945\n0.382\n0.449\n0.169\nTransition\n\n\n3\n3: Late Republic II\n0.944\n0.253\n0.629\n0.118\nTransition\n\n\n4\n4: Triumviral/Augustan\n0.828\n0.314\n0.347\n0.339\nTransition"
  },
  {
    "objectID": "hmm_analysis.html#visualize-state-sequence",
    "href": "hmm_analysis.html#visualize-state-sequence",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "7.4 Visualize State Sequence",
    "text": "7.4 Visualize State Sequence\n\n\nCode\n# Reshape for plotting\nviterbi_long &lt;- viterbi_result %&gt;%\n  pivot_longer(\n    cols = starts_with(\"prob_\"),\n    names_to = \"state\",\n    values_to = \"probability\",\n    names_prefix = \"prob_\"\n  ) %&gt;%\n  mutate(\n    state = recode(state,\n      \"pre\" = \"Pre-transition\",\n      \"trans\" = \"Transition\",\n      \"post\" = \"Post-transition\"\n    )\n  )\n\np1 &lt;- ggplot(viterbi_long, aes(x = period, y = probability, fill = state)) +\n  geom_area(alpha = 0.7) +\n  scale_fill_manual(\n    values = c(\"Pre-transition\" = \"steelblue\", \n               \"Transition\" = \"gold\", \n               \"Post-transition\" = \"darkred\")\n  ) +\n  scale_x_continuous(\n    breaks = 1:4,\n    labels = c(\"Early Rep\", \"Late Rep I\", \"Late Rep II\", \"Triumviral\")\n  ) +\n  labs(\n    title = \"State Probabilities Over Time\",\n    subtitle = \"Forward algorithm results\",\n    x = \"Period\",\n    y = \"State probability\",\n    fill = \"State\"\n  )\n\np2 &lt;- ggplot(viterbi_result, aes(x = period, y = obs_p_rome)) +\n  geom_line(linewidth = 1.2, color = \"grey30\") +\n  geom_point(aes(color = most_likely_state), size = 5) +\n  scale_color_manual(\n    values = c(\"Pre-transition\" = \"steelblue\",\n               \"Transition\" = \"gold\",\n               \"Post-transition\" = \"darkred\")\n  ) +\n  scale_x_continuous(\n    breaks = 1:4,\n    labels = c(\"Early Rep\", \"Late Rep I\", \"Late Rep II\", \"Triumviral\")\n  ) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0.8, 1)) +\n  labs(\n    title = \"Observed Rome Proportion with State Assignment\",\n    x = \"Period\",\n    y = \"Rome proportion\",\n    color = \"Most likely state\"\n  )\n\np1 / p2"
  },
  {
    "objectID": "hmm_analysis.html#morans-i-test",
    "href": "hmm_analysis.html#morans-i-test",
    "title": "Hidden Markov Model for Roman Monetary Regimes",
    "section": "9.1 Moran’s I Test",
    "text": "9.1 Moran’s I Test\n\n\nCode\nlibrary(spdep)\n\n# For each regime, test spatial autocorrelation in Rome proportion\n\nmorans_results &lt;- list()\n\nfor (r in unique(hex_regime_lrr$regime)) {\n  \n  regime_data &lt;- hex_regime_sf %&gt;%\n    filter(regime == r)\n  \n  if (nrow(regime_data) &lt; 10) {\n    morans_results[[r]] &lt;- list(regime = r, n = nrow(regime_data), \n                                  moran_I = NA, p_value = NA)\n    next\n  }\n  \n  # Create neighbor list\n  coords &lt;- st_coordinates(st_centroid(regime_data))\n  \n  # K-nearest neighbors (k=4)\n  knn &lt;- knearneigh(coords, k = min(4, nrow(regime_data) - 1))\n  nb &lt;- knn2nb(knn)\n  \n  # Weights\n  lw &lt;- nb2listw(nb, style = \"W\", zero.policy = TRUE)\n  \n  # Moran's I\n  moran_test &lt;- tryCatch(\n    moran.test(regime_data$p_rome, lw, zero.policy = TRUE),\n    error = function(e) NULL\n  )\n  \n  if (!is.null(moran_test)) {\n    morans_results[[r]] &lt;- list(\n      regime = r,\n      n = nrow(regime_data),\n      moran_I = moran_test$estimate[\"Moran I statistic\"],\n      p_value = moran_test$p.value\n    )\n  } else {\n    morans_results[[r]] &lt;- list(regime = r, n = nrow(regime_data),\n                                  moran_I = NA, p_value = NA)\n  }\n}\n\nmorans_df &lt;- bind_rows(morans_results)\nkable(morans_df, digits = 4, caption = \"Spatial autocorrelation (Moran's I) by regime\")\n\n\n\nSpatial autocorrelation (Moran’s I) by regime\n\n\nregime\nn\nmoran_I\np_value\n\n\n\n\nA: Pre-transition\n48\n0.1015\n0.0672\n\n\nB: Transition\n74\n-0.0865\n0.8445\n\n\nC: Post-transition\n91\n0.1460\n0.0081"
  },
  {
    "objectID": "circulation_model.html",
    "href": "circulation_model.html",
    "title": "Roman Coin Circulation Model",
    "section": "",
    "text": "Create probability surfaces showing expected hoard composition at any location and time, based on:\n\nProduction: Which mints produced how many coins, when\nDiffusion: How coins spread spatially from their mint of origin\nAccumulation: How hoards aggregate coins from multiple sources over time\n\n\n\n\n\\[E[\\text{prop. from mint } m \\text{ at } (h,t)] = \\frac{\\sum_{\\tau &lt; t} M_{m,\\tau} \\cdot P(h|m,\\tau,t) \\cdot w(t-\\tau)}{\\sum_{m'}\\sum_{\\tau &lt; t} M_{m',\\tau} \\cdot P(h|m',\\tau,t) \\cdot w(t-\\tau)}\\]\nWhere:\n\n\\(M_{m,\\tau}\\) = production from mint \\(m\\) in period \\(\\tau\\)\n\\(P(h|m,\\tau,t)\\) = probability coin reaches hex \\(h\\) from mint \\(m\\)\n\\(w(t-\\tau)\\) = circulation weight (optional decay)\n\n\n\n\n\\[\\text{logit}(p_{mh}) = \\alpha_m - \\beta_m \\cdot d_{mh} + \\gamma_{m,1} \\cdot \\cos(\\theta_{mh}) + \\gamma_{m,2} \\cdot \\sin(\\theta_{mh}) + \\delta_m \\cdot \\text{age}\\]\nWith partial pooling:\n\\[\\beta_m \\sim N(\\mu_\\beta, \\sigma_\\beta^2)\\]"
  },
  {
    "objectID": "circulation_model.html#objective",
    "href": "circulation_model.html#objective",
    "title": "Roman Coin Circulation Model",
    "section": "",
    "text": "Create probability surfaces showing expected hoard composition at any location and time, based on:\n\nProduction: Which mints produced how many coins, when\nDiffusion: How coins spread spatially from their mint of origin\nAccumulation: How hoards aggregate coins from multiple sources over time"
  },
  {
    "objectID": "circulation_model.html#model-structure",
    "href": "circulation_model.html#model-structure",
    "title": "Roman Coin Circulation Model",
    "section": "",
    "text": "\\[E[\\text{prop. from mint } m \\text{ at } (h,t)] = \\frac{\\sum_{\\tau &lt; t} M_{m,\\tau} \\cdot P(h|m,\\tau,t) \\cdot w(t-\\tau)}{\\sum_{m'}\\sum_{\\tau &lt; t} M_{m',\\tau} \\cdot P(h|m',\\tau,t) \\cdot w(t-\\tau)}\\]\nWhere:\n\n\\(M_{m,\\tau}\\) = production from mint \\(m\\) in period \\(\\tau\\)\n\\(P(h|m,\\tau,t)\\) = probability coin reaches hex \\(h\\) from mint \\(m\\)\n\\(w(t-\\tau)\\) = circulation weight (optional decay)"
  },
  {
    "objectID": "circulation_model.html#hierarchical-diffusion-model",
    "href": "circulation_model.html#hierarchical-diffusion-model",
    "title": "Roman Coin Circulation Model",
    "section": "",
    "text": "\\[\\text{logit}(p_{mh}) = \\alpha_m - \\beta_m \\cdot d_{mh} + \\gamma_{m,1} \\cdot \\cos(\\theta_{mh}) + \\gamma_{m,2} \\cdot \\sin(\\theta_{mh}) + \\delta_m \\cdot \\text{age}\\]\nWith partial pooling:\n\\[\\beta_m \\sim N(\\mu_\\beta, \\sigma_\\beta^2)\\]"
  },
  {
    "objectID": "circulation_model.html#load-chrr-data",
    "href": "circulation_model.html#load-chrr-data",
    "title": "Roman Coin Circulation Model",
    "section": "3.1 1.1 Load CHRR Data",
    "text": "3.1 1.1 Load CHRR Data\n\n\nCode\nchrr_file &lt;- \"/Users/john/Library/Mobile Documents/com~apple~CloudDocs/Home/John/GIS/Roman Italy GIS/Coin Project/data/chrr_data.csv\"\n\nif (!file.exists(chrr_file)) {\n  alt_paths &lt;- c(\"/mnt/user-data/uploads/chrr_data.csv\", \"~/chrr_data.csv\")\n  for (alt in alt_paths) {\n    if (file.exists(alt)) {\n      chrr_file &lt;- alt\n      break\n    }\n  }\n}\n\nchrr_raw &lt;- read_csv(chrr_file, show_col_types = FALSE)\ncat(\"✓ Loaded\", nrow(chrr_raw), \"coin-type records\\n\")\n\n\n✓ Loaded 31951 coin-type records\n\n\nCode\ncat(\"  Unique hoards:\", n_distinct(chrr_raw$hoard_id), \"\\n\")\n\n\n  Unique hoards: 493 \n\n\nCode\ncat(\"  Unique mints:\", n_distinct(chrr_raw$mint_id), \"\\n\")\n\n\n  Unique mints: 15"
  },
  {
    "objectID": "circulation_model.html#extract-unique-mint-uris",
    "href": "circulation_model.html#extract-unique-mint-uris",
    "title": "Roman Coin Circulation Model",
    "section": "3.2 1.2 Extract Unique Mint URIs",
    "text": "3.2 1.2 Extract Unique Mint URIs\n\n\nCode\n# Get unique mints with their URIs\nmint_list &lt;- chrr_raw %&gt;%\n  filter(!is.na(mint_uri), mint_uri != \"\") %&gt;%\n  group_by(mint_id, mint_uri) %&gt;%\n  summarise(\n    n_types = n(),\n    n_hoards = n_distinct(hoard_id),\n    .groups = \"drop\"\n  ) %&gt;%\n  arrange(desc(n_types))\n\ncat(\"Unique mints with URIs:\", nrow(mint_list), \"\\n\")\n\n\nUnique mints with URIs: 14 \n\n\nCode\ncat(\"\\nTop 20 mints by coin-type count:\\n\")\n\n\n\nTop 20 mints by coin-type count:\n\n\nCode\nkable(head(mint_list, 20))\n\n\n\n\n\n\n\n\n\n\n\nmint_id\nmint_uri\nn_types\nn_hoards\n\n\n\n\nrome\nhttp://nomisma.org/id/rome\n28177\n490\n\n\nuncertain_value\nhttp://nomisma.org/id/uncertain_value\n2263\n343\n\n\nnarbo\nhttp://nomisma.org/id/narbo\n379\n185\n\n\nitaly_north_rrc\nhttp://nomisma.org/id/italy_north_rrc\n297\n165\n\n\nmassalia\nhttp://nomisma.org/id/massalia\n55\n50\n\n\nitaly_southeast_rrc\nhttp://nomisma.org/id/italy_southeast_rrc\n53\n35\n\n\nsicily2_rrc\nhttp://nomisma.org/id/sicily2_rrc\n45\n34\n\n\napollonia_illyria\nhttp://nomisma.org/id/apollonia_illyria\n32\n27\n\n\nluceria\nhttp://nomisma.org/id/luceria\n25\n13\n\n\nitaly_central_rrc\nhttp://nomisma.org/id/italy_central_rrc\n24\n21\n\n\nsicily1_rrc\nhttp://nomisma.org/id/sicily1_rrc\n12\n11\n\n\nosca\nhttp://nomisma.org/id/osca\n4\n4\n\n\nlugdunum\nhttp://nomisma.org/id/lugdunum\n3\n3\n\n\nsalpesa\nhttp://nomisma.org/id/salpesa\n3\n2"
  },
  {
    "objectID": "circulation_model.html#load-mint-coordinates-from-geojson",
    "href": "circulation_model.html#load-mint-coordinates-from-geojson",
    "title": "Roman Coin Circulation Model",
    "section": "3.3 1.3 Load Mint Coordinates from GeoJSON",
    "text": "3.3 1.3 Load Mint Coordinates from GeoJSON\n\n\nCode\n# Load mint coordinates from your GeoJSON file\n# This is more reliable than fetching from Nomisma API\nmints_geojson_path &lt;- \"/Users/john/Library/Mobile Documents/com~apple~CloudDocs/Home/John/GIS/Roman Italy GIS/Coin Project/data/mints.geojson\"\n\n# Try alternative paths if needed\nif (!file.exists(mints_geojson_path)) {\n  alt_paths &lt;- c(\n    \"/mnt/user-data/uploads/mints.geojson\",\n    \"~/mints.geojson\",\n    \"mints.geojson\"\n  )\n  for (p in alt_paths) {\n    if (file.exists(p)) {\n      mints_geojson_path &lt;- p\n      break\n    }\n  }\n}\n\nif (file.exists(mints_geojson_path)) {\n  # Load GeoJSON\n  mints_sf &lt;- st_read(mints_geojson_path, quiet = TRUE)\n  \n  # Extract coordinates and mint_id from URI\n  mints_from_geojson &lt;- mints_sf %&gt;%\n    st_drop_geometry() %&gt;%\n    mutate(\n      coords = st_coordinates(mints_sf),\n      mint_lon = coords[, 1],\n      mint_lat = coords[, 2],\n      # Extract mint_id from URI (last part after /)\n      mint_id_from_uri = str_extract(uri, \"[^/]+$\")\n    ) %&gt;%\n    dplyr::select(name, mint_id_from_uri, mint_lat, mint_lon, uri) %&gt;%\n    distinct(mint_id_from_uri, .keep_all = TRUE)\n  \n  cat(\"✓ Loaded\", nrow(mints_from_geojson), \"mints from GeoJSON\\n\")\n  print(mints_from_geojson)\n  \n} else {\n  cat(\"⚠ GeoJSON file not found, will use manual coordinates only\\n\")\n  mints_from_geojson &lt;- tibble(\n    name = character(),\n    mint_id_from_uri = character(),\n    mint_lat = numeric(),\n    mint_lon = numeric(),\n    uri = character()\n  )\n}\n\n\n⚠ GeoJSON file not found, will use manual coordinates only\n\n\nCode\n# Join GeoJSON coordinates to mint_list by matching URI or mint_id\nmint_coords &lt;- mint_list %&gt;%\n  mutate(\n    mint_id_clean = str_extract(mint_uri, \"[^/]+$\")\n  ) %&gt;%\n  left_join(\n    mints_from_geojson %&gt;% dplyr::select(mint_id_from_uri, mint_lat, mint_lon),\n    by = c(\"mint_id_clean\" = \"mint_id_from_uri\")\n  )\n\n# Summary\nn_with_coords &lt;- sum(!is.na(mint_coords$mint_lat))\ncat(\"\\n✓ Mints with coordinates from GeoJSON:\", n_with_coords, \"of\", nrow(mint_coords), \n    \"(\", round(100*n_with_coords/nrow(mint_coords), 1), \"%)\\n\")\n\n\n\n✓ Mints with coordinates from GeoJSON: 0 of 14 ( 0 %)\n\n\nCode\n# Show mints without coordinates\nmissing_coords &lt;- mint_coords %&gt;%\n  filter(is.na(mint_lat)) %&gt;%\n  arrange(desc(n_types))\n\nif (nrow(missing_coords) &gt; 0) {\n  cat(\"\\nMints missing coordinates (top 20 by volume):\\n\")\n  print(head(missing_coords %&gt;% dplyr::select(mint_id, mint_uri, n_types), 20))\n}\n\n\n\nMints missing coordinates (top 20 by volume):\n# A tibble: 14 × 3\n   mint_id             mint_uri                                  n_types\n   &lt;chr&gt;               &lt;chr&gt;                                       &lt;int&gt;\n 1 rome                http://nomisma.org/id/rome                  28177\n 2 uncertain_value     http://nomisma.org/id/uncertain_value        2263\n 3 narbo               http://nomisma.org/id/narbo                   379\n 4 italy_north_rrc     http://nomisma.org/id/italy_north_rrc         297\n 5 massalia            http://nomisma.org/id/massalia                 55\n 6 italy_southeast_rrc http://nomisma.org/id/italy_southeast_rrc      53\n 7 sicily2_rrc         http://nomisma.org/id/sicily2_rrc              45\n 8 apollonia_illyria   http://nomisma.org/id/apollonia_illyria        32\n 9 luceria             http://nomisma.org/id/luceria                  25\n10 italy_central_rrc   http://nomisma.org/id/italy_central_rrc        24\n11 sicily1_rrc         http://nomisma.org/id/sicily1_rrc              12\n12 osca                http://nomisma.org/id/osca                      4\n13 lugdunum            http://nomisma.org/id/lugdunum                  3\n14 salpesa             http://nomisma.org/id/salpesa                   3"
  },
  {
    "objectID": "circulation_model.html#manual-coordinate-additions",
    "href": "circulation_model.html#manual-coordinate-additions",
    "title": "Roman Coin Circulation Model",
    "section": "3.4 1.4 Manual Coordinate Additions",
    "text": "3.4 1.4 Manual Coordinate Additions\n\n\nCode\n# Comprehensive manual coordinates for Roman Republican mints\n# Since Nomisma API may not return coordinates, we provide known locations\nmanual_coords &lt;- tribble(\n  ~mint_id, ~mint_lat, ~mint_lon,\n  # Rome and Italy\n  \"rome\", 41.9028, 12.4964,\n  \"roma\", 41.9028, 12.4964,\n  \"luceria\", 41.5089, 15.3350,\n  \"capua\", 41.1067, 14.2133,\n  \"croton\", 39.0811, 17.1275,\n  \"crotona\", 39.0811, 17.1275,\n  \"brundisium\", 40.6333, 17.9333,\n  \"tarentum\", 40.4667, 17.2333,\n  \"venusia\", 40.9667, 15.8167,\n  \"canusium\", 41.2167, 16.0667,\n  \"hatria\", 42.8333, 13.9833,\n  \"cales\", 41.2000, 14.2167,\n  \"suessa\", 41.2333, 13.9333,\n  \"teanum\", 41.2500, 14.0667,\n  \"aquileia\", 45.7667, 13.3667,\n  \"arretium\", 43.4633, 11.8783,\n  \"ariminum\", 44.0594, 12.5683,\n  \n  # Regional Italian\n  \"italy_north_rrc\", 45.0000, 11.0000,  # Centroid\n  \"italy_central_rrc\", 42.5000, 12.5000,\n  \"italy_southeast_rrc\", 40.5000, 17.0000,\n  \"italy_south_rrc\", 40.0000, 16.0000,\n  \n  # Sicily and Sardinia  \n  \"sicily2_rrc\", 37.5000, 14.0000,\n  \"sicily_rrc\", 37.5000, 14.0000,\n  \"syracusae\", 37.0755, 15.2866,\n  \"syracuse\", 37.0755, 15.2866,\n  \"panormus\", 38.1157, 13.3615,\n  \"lilybaeum\", 37.8000, 12.4333,\n  \"sardinia_rrc\", 40.0000, 9.0000,\n  \n  # Gaul\n  \"massalia\", 43.2965, 5.3698,\n  \"narbo\", 43.1833, 3.0000,\n  \"lugdunum\", 45.7640, 4.8357,\n  \"vienna\", 45.5167, 4.8833,\n  \"nemausus\", 43.8367, 4.3600,\n  \"gallia_rrc\", 45.0000, 3.0000,\n  \n  # Hispania\n  \"tarraco\", 41.1189, 1.2445,\n  \"carthago_nova\", 37.6000, -0.9833,\n  \"emporiae\", 42.1333, 3.1167,\n  \"emporia\", 42.1333, 3.1167,\n  \"osca\", 42.1400, -0.4083,\n  \"saguntum\", 39.6833, -0.2667,\n  \"corduba\", 37.8833, -4.7667,\n  \"hispania_rrc\", 40.0000, -3.0000,\n  \n  # Greece and Macedonia\n  \"apollonia_illyria\", 40.7167, 19.4833,\n  \"apollonia\", 40.7167, 19.4833,\n  \"dyrrhachium\", 41.3167, 19.4500,\n  \"thessalonica\", 40.6403, 22.9439,\n  \"thessaloniki\", 40.6403, 22.9439,\n  \"corinthus\", 37.9060, 22.8800,\n  \"corinth\", 37.9060, 22.8800,\n  \"athenae\", 37.9838, 23.7275,\n  \"athens\", 37.9838, 23.7275,\n  \"macedonia_rrc\", 41.0000, 22.0000,\n  \"achaea_rrc\", 38.0000, 22.0000,\n  \"greece_rrc\", 39.0000, 22.0000,\n  \n  # Asia Minor\n  \"ephesus\", 37.9394, 27.3417,\n  \"ephesos\", 37.9394, 27.3417,\n  \"pergamum\", 39.1167, 27.1833,\n  \"pergamon\", 39.1167, 27.1833,\n  \"smyrna\", 38.4192, 27.1287,\n  \"sardis\", 38.4833, 28.0333,\n  \"antioch\", 36.2000, 36.1500,\n  \"antiochia\", 36.2000, 36.1500,\n  \"asia_rrc\", 38.5000, 28.0000,\n  \n  # Africa\n  \"carthago\", 36.8528, 10.3233,\n  \"carthage\", 36.8528, 10.3233,\n  \"utica\", 37.0553, 10.0617,\n  \"cirta\", 36.3650, 6.6147,\n  \"africa_rrc\", 36.0000, 9.0000,\n  \n  # Pontus / Black Sea\n  \"amisus\", 41.7167, 36.3333,\n  \"sinope\", 42.0231, 35.1531,\n  \"pontus_rrc\", 41.0000, 36.0000,\n  \n  # Military / Moving mints\n  \"military_mint_rrc\", NA_real_, NA_real_,\n  \"moving_mint\", NA_real_, NA_real_,\n  \n  # Uncertain\n  \"uncertain\", NA_real_, NA_real_,\n  \"uncertain_value\", NA_real_, NA_real_,\n  \"unknown\", NA_real_, NA_real_\n)\n\n# Update mint_coords with manual additions where GeoJSON didn't have coordinates\n# Match by mint_id (not mint_id_clean)\nfor (i in seq_len(nrow(manual_coords))) {\n  mid &lt;- manual_coords$mint_id[i]\n  mlat &lt;- manual_coords$mint_lat[i]\n  mlon &lt;- manual_coords$mint_lon[i]\n  \n  # Check if this mint exists and needs coordinates\n  idx &lt;- which(mint_coords$mint_id == mid | mint_coords$mint_id_clean == mid)\n  if (length(idx) &gt; 0 && is.na(mint_coords$mint_lat[idx[1]])) {\n    mint_coords$mint_lat[idx] &lt;- mlat\n    mint_coords$mint_lon[idx] &lt;- mlon\n  }\n}\n\n# Add any mints from manual_coords that aren't in mint_coords at all\nexisting_ids &lt;- c(mint_coords$mint_id, mint_coords$mint_id_clean)\nmissing_mints &lt;- manual_coords %&gt;%\n  filter(!mint_id %in% existing_ids, !is.na(mint_lat))\n\nif (nrow(missing_mints) &gt; 0) {\n  missing_mints &lt;- missing_mints %&gt;%\n    mutate(\n      mint_uri = paste0(\"http://nomisma.org/id/\", mint_id),\n      mint_id_clean = mint_id,\n      n_types = 0,\n      n_hoards = 0\n    )\n  mint_coords &lt;- bind_rows(mint_coords, missing_mints)\n}\n\n# Report\nn_with_manual &lt;- sum(!is.na(mint_coords$mint_lat))\ncat(\"✓ Mints with coordinates (after manual additions):\", n_with_manual, \"of\", nrow(mint_coords), \"\\n\")\n\n\n✓ Mints with coordinates (after manual additions): 71 of 74 \n\n\nCode\n# Show which mints now have coordinates\ncat(\"\\nMints with coordinates:\\n\")\n\n\n\nMints with coordinates:\n\n\nCode\nmint_coords %&gt;%\n  filter(!is.na(mint_lat)) %&gt;%\n  dplyr::select(mint_id, mint_lat, mint_lon, n_types) %&gt;%\n  arrange(desc(n_types)) %&gt;%\n  head(20) %&gt;%\n  print()\n\n\n# A tibble: 20 × 4\n   mint_id             mint_lat mint_lon n_types\n   &lt;chr&gt;                  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;\n 1 rome                    41.9   12.5     28177\n 2 narbo                   43.2    3         379\n 3 italy_north_rrc         45     11         297\n 4 massalia                43.3    5.37       55\n 5 italy_southeast_rrc     40.5   17          53\n 6 sicily2_rrc             37.5   14          45\n 7 apollonia_illyria       40.7   19.5        32\n 8 luceria                 41.5   15.3        25\n 9 italy_central_rrc       42.5   12.5        24\n10 osca                    42.1   -0.408       4\n11 lugdunum                45.8    4.84        3\n12 roma                    41.9   12.5         0\n13 capua                   41.1   14.2         0\n14 croton                  39.1   17.1         0\n15 crotona                 39.1   17.1         0\n16 brundisium              40.6   17.9         0\n17 tarentum                40.5   17.2         0\n18 venusia                 41.0   15.8         0\n19 canusium                41.2   16.1         0\n20 hatria                  42.8   14.0         0\n\n\nCode\n# Verify Rome\nrome_check &lt;- mint_coords %&gt;% filter(mint_id == \"rome\")\nif (nrow(rome_check) &gt; 0 && !is.na(rome_check$mint_lat[1])) {\n  cat(\"\\n✓ Rome coordinates verified:\", rome_check$mint_lat[1], \",\", rome_check$mint_lon[1], \"\\n\")\n}\n\n\n\n✓ Rome coordinates verified: 41.9028 , 12.4964"
  },
  {
    "objectID": "circulation_model.html#classify-mints-into-regions",
    "href": "circulation_model.html#classify-mints-into-regions",
    "title": "Roman Coin Circulation Model",
    "section": "3.5 1.5 Classify Mints into Regions",
    "text": "3.5 1.5 Classify Mints into Regions\n\n\nCode\n# Define mint regions based on coordinates and known geography\nclassify_mint_region &lt;- function(mint_id, lat, lon) {\n  \n  # Handle missing coordinates\n if (is.na(lat) || is.na(lon)) {\n    # Try to classify by mint_id patterns\n    id_lower &lt;- tolower(mint_id)\n    \n    if (grepl(\"rome|roma\", id_lower)) return(\"ROME\")\n    if (grepl(\"hispa|spain|iberi|tarraco|carthago_nova|emporiae|osca|sagunt\", id_lower)) return(\"HISP\")\n    if (grepl(\"gaul|gall|massalia|lugdunum|narbo|vienna\", id_lower)) return(\"GALL\")\n    if (grepl(\"africa|carthag|utica|cirta|numidia\", id_lower)) return(\"AFRI\")\n    if (grepl(\"sicil|syracus|panormus|lilyb\", id_lower)) return(\"SICI\")\n    if (grepl(\"sardinia|sard\", id_lower)) return(\"SICI\")  # Group with Sicily\n    if (grepl(\"macedon|thessal|apollon|dyrr|greece|achae|corinth|athens\", id_lower)) return(\"GREC\")\n    if (grepl(\"asia|ephes|pergam|antioch|smyrna|sardis\", id_lower)) return(\"ASIA\")\n    if (grepl(\"pontus|amis|sinop|black\", id_lower)) return(\"PONT\")\n    if (grepl(\"military|moving|legionary|camp\", id_lower)) return(\"MILI\")\n    if (grepl(\"uncertain|unknown\", id_lower)) return(\"UNKN\")\n    \n    # Italian mints\n    if (grepl(\"capua|luceria|croton|venusia|brund|tarent|canusium|hatria\", id_lower)) return(\"ITAL\")\n    \n    return(\"UNKN\")\n  }\n  \n  # Classify by coordinates\n  # Rome\n  if (abs(lat - 41.9028) &lt; 0.5 && abs(lon - 12.4964) &lt; 0.5) {\n    if (grepl(\"rome|roma\", tolower(mint_id))) return(\"ROME\")\n    return(\"ITAL\")  # Other mints near Rome\n  }\n  \n  # Geographic regions\n  if (lon &lt; -2) return(\"HISP\")  # Iberia\n  if (lon &gt;= -2 && lon &lt; 5 && lat &gt; 42) return(\"GALL\")  # Gaul\n  if (lat &lt; 38 && lon &gt;= 5 && lon &lt; 15) return(\"AFRI\")  # North Africa\n  if (lon &gt;= 12 && lon &lt; 16 && lat &gt;= 36 && lat &lt; 39) return(\"SICI\")  # Sicily\n  if (lon &gt;= 6 && lon &lt; 12 && lat &gt;= 38 && lat &lt; 41) return(\"SICI\")  # Sardinia/Corsica\n  if (lon &gt;= 19 && lon &lt; 28 && lat &gt;= 35 && lat &lt; 43) return(\"GREC\")  # Greece\n  if (lon &gt;= 28 && lat &gt;= 35) return(\"ASIA\")  # Asia Minor\n  if (lon &gt;= 30 && lat &gt;= 40) return(\"PONT\")  # Pontus/Black Sea\n  if (lon &gt;= 10 && lon &lt; 19 && lat &gt;= 39 && lat &lt; 47) return(\"ITAL\")  # Italy\n  \n  return(\"UNKN\")\n}\n\n# Apply classification\nmint_coords &lt;- mint_coords %&gt;%\n  mutate(\n    mint_region = pmap_chr(list(mint_id, mint_lat, mint_lon), classify_mint_region)\n  )\n\n# Summary by region\nregion_summary &lt;- mint_coords %&gt;%\n  group_by(mint_region) %&gt;%\n  summarise(\n    n_mints = n(),\n    n_types = sum(n_types),\n    n_hoards = sum(n_hoards),\n    has_coords = sum(!is.na(mint_lat)),\n    .groups = \"drop\"\n  ) %&gt;%\n  arrange(desc(n_types))\n\ncat(\"\\nMint classification summary:\\n\")\n\n\n\nMint classification summary:\n\n\nCode\nkable(region_summary)\n\n\n\n\n\nmint_region\nn_mints\nn_types\nn_hoards\nhas_coords\n\n\n\n\nROME\n2\n28177\n490\n2\n\n\nUNKN\n6\n2321\n395\n4\n\n\nITAL\n19\n399\n234\n19\n\n\nGALL\n8\n386\n192\n8\n\n\nAFRI\n8\n45\n34\n8\n\n\nGREC\n17\n32\n27\n17\n\n\nSICI\n5\n12\n11\n4\n\n\nASIA\n7\n0\n0\n7\n\n\nHISP\n2\n0\n0\n2"
  },
  {
    "objectID": "circulation_model.html#define-production-periods-25-year-bins",
    "href": "circulation_model.html#define-production-periods-25-year-bins",
    "title": "Roman Coin Circulation Model",
    "section": "3.6 1.6 Define Production Periods (25-year bins)",
    "text": "3.6 1.6 Define Production Periods (25-year bins)\n\n\nCode\n# 25-year production periods\n# 12 breaks create 11 intervals, so we need 11 labels\nperiod_breaks &lt;- c(-Inf, -200, -175, -150, -125, -100, -75, -50, -25, 1, 14, Inf)\nperiod_labels &lt;- c(\n \"P01: pre-200\",\n  \"P02: 200-175\",\n  \"P03: 175-150\", \n  \"P04: 150-125\",\n  \"P05: 125-100\",\n  \"P06: 100-75\",\n  \"P07: 75-50\",\n  \"P08: 50-25\",\n  \"P09: 25-1 BCE\",\n  \"P10: 1-14 CE\",\n  \"P11: post-14 CE\"\n)\n\nperiod_midpoints &lt;- c(-225, -187, -162, -137, -112, -87, -62, -37, -12, 7, 25)\nnames(period_midpoints) &lt;- period_labels\n\n# Deposition periods (for TPQ)\ndeposition_breaks &lt;- c(-Inf, -150, -100, -50, 14, Inf)\ndeposition_labels &lt;- c(\"Early Republic\", \"Late Republic I\", \n                        \"Late Republic II\", \"Triumviral/Augustan\", \"Early Imperial\")"
  },
  {
    "objectID": "circulation_model.html#build-analysis-dataset",
    "href": "circulation_model.html#build-analysis-dataset",
    "title": "Roman Coin Circulation Model",
    "section": "3.7 1.7 Build Analysis Dataset",
    "text": "3.7 1.7 Build Analysis Dataset\n\n\nCode\n# First, ensure mint_coords has mint_id properly set for joining\n# The coordinates may have come from mint_id_clean (from URI), so unify them\nif (\"mint_id_clean\" %in% names(mint_coords)) {\n  # Use mint_id if available, otherwise mint_id_clean\n  mint_coords &lt;- mint_coords %&gt;%\n    mutate(mint_id = coalesce(mint_id, mint_id_clean))\n}\n\n# Debug: show what we're joining\ncat(\"Mints available for joining:\\n\")\n\n\nMints available for joining:\n\n\nCode\ncat(\"  Total mints:\", nrow(mint_coords), \"\\n\")\n\n\n  Total mints: 74 \n\n\nCode\ncat(\"  With coordinates:\", sum(!is.na(mint_coords$mint_lat)), \"\\n\")\n\n\n  With coordinates: 71 \n\n\nCode\ncat(\"  With region:\", sum(!is.na(mint_coords$mint_region)), \"\\n\")\n\n\n  With region: 74 \n\n\nCode\n# Show sample of mint_coords\ncat(\"\\nSample of mint_coords:\\n\")\n\n\n\nSample of mint_coords:\n\n\nCode\nprint(mint_coords %&gt;% \n        filter(!is.na(mint_lat)) %&gt;%\n        dplyr::select(mint_id, mint_lat, mint_lon, mint_region, n_types) %&gt;%\n        head(10))\n\n\n# A tibble: 10 × 5\n   mint_id             mint_lat mint_lon mint_region n_types\n   &lt;chr&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;\n 1 rome                    41.9   12.5   ROME          28177\n 2 narbo                   43.2    3     GALL            379\n 3 italy_north_rrc         45     11     ITAL            297\n 4 massalia                43.3    5.37  UNKN             55\n 5 italy_southeast_rrc     40.5   17     ITAL             53\n 6 sicily2_rrc             37.5   14     AFRI             45\n 7 apollonia_illyria       40.7   19.5   GREC             32\n 8 luceria                 41.5   15.3   ITAL             25\n 9 italy_central_rrc       42.5   12.5   ITAL             24\n10 osca                    42.1   -0.408 GALL              4\n\n\nCode\n# Parse dates and join mint info\nchrr_analysis &lt;- chrr_raw %&gt;%\n  # Parse mint dates\n  mutate(\n    mint_start = as.numeric(start_year),\n    mint_end = as.numeric(end_year),\n    mint_mid = (mint_start + mint_end) / 2,\n    tpq_year = readr::parse_number(as.character(hoard_tpq))\n  ) %&gt;%\n  filter(\n    !is.na(mint_mid),\n    !is.na(tpq_year),\n    !is.na(hoard_lat),\n    !is.na(hoard_long)\n  ) %&gt;%\n  # Assign production period\n  mutate(\n    prod_period = cut(mint_mid, breaks = period_breaks, labels = period_labels, right = TRUE),\n    depo_period = cut(tpq_year, breaks = deposition_breaks, labels = deposition_labels, right = TRUE)\n  ) %&gt;%\n  # Join mint coordinates and region\n left_join(\n    mint_coords %&gt;% dplyr::select(mint_id, mint_lat, mint_lon, mint_region),\n    by = \"mint_id\"\n  )\n\n# Debug: check join success\ncat(\"\\nJoin results:\\n\")\n\n\n\nJoin results:\n\n\nCode\ncat(\"  Records with mint_lat:\", sum(!is.na(chrr_analysis$mint_lat)), \"of\", nrow(chrr_analysis), \"\\n\")\n\n\n  Records with mint_lat: 27673 of 29871 \n\n\nCode\ncat(\"  Records with mint_region:\", sum(!is.na(chrr_analysis$mint_region)), \"\\n\")\n\n\n  Records with mint_region: 29871 \n\n\nCode\n# Show which mints didn't join\nmissing_join &lt;- chrr_analysis %&gt;%\n  filter(is.na(mint_lat)) %&gt;%\n  count(mint_id, sort = TRUE) %&gt;%\n  head(10)\nif (nrow(missing_join) &gt; 0) {\n  cat(\"\\nTop mints that didn't get coordinates:\\n\")\n  print(missing_join)\n}\n\n\n\nTop mints that didn't get coordinates:\n# A tibble: 3 × 2\n  mint_id             n\n  &lt;chr&gt;           &lt;int&gt;\n1 uncertain_value  2183\n2 sicily1_rrc        12\n3 salpesa             3\n\n\nCode\n# Now calculate distances\nchrr_analysis &lt;- chrr_analysis %&gt;%\n  mutate(\n    # Distance from mint to hoard (km)\n    delta_lon_mint = hoard_long - mint_lon,\n    delta_lat_mint = hoard_lat - mint_lat,\n    dist_from_mint_km = sqrt(\n      (delta_lon_mint * 111 * cos(mint_lat * pi/180))^2 + \n      (delta_lat_mint * 111)^2\n    ),\n    \n    # Bearing from mint to hoard\n    bearing_from_mint_rad = atan2(\n      delta_lon_mint * cos(mint_lat * pi/180), \n      delta_lat_mint\n    ),\n    bearing_from_mint_deg = (bearing_from_mint_rad * 180 / pi + 360) %% 360,\n    cos_bearing_mint = cos(bearing_from_mint_rad),\n    sin_bearing_mint = sin(bearing_from_mint_rad),\n    \n    # Distance from Rome to hoard (for comparison)\n    delta_lon_rome = hoard_long - rome_lon,\n    delta_lat_rome = hoard_lat - rome_lat,\n    dist_from_rome_km = sqrt(\n      (delta_lon_rome * 111 * cos(rome_lat * pi/180))^2 + \n      (delta_lat_rome * 111)^2\n    ),\n    \n    # Circulation age\n    circ_age = tpq_year - mint_mid\n  ) %&gt;%\n  filter(\n    !is.na(mint_region),\n    !is.na(dist_from_mint_km),\n    circ_age &gt;= 0  # Valid circulation time\n  )\n\ncat(\"✓ Analysis dataset:\", nrow(chrr_analysis), \"coin-type records\\n\")\n\n\n✓ Analysis dataset: 27641 coin-type records\n\n\nCode\ncat(\"  With mint coordinates:\", sum(!is.na(chrr_analysis$mint_lat)), \"\\n\")\n\n\n  With mint coordinates: 27641 \n\n\nCode\ncat(\"  Unique hoards:\", n_distinct(chrr_analysis$hoard_id), \"\\n\")\n\n\n  Unique hoards: 461 \n\n\nCode\ncat(\"  Unique mints:\", n_distinct(chrr_analysis$mint_id), \"\\n\")\n\n\n  Unique mints: 11"
  },
  {
    "objectID": "circulation_model.html#aggregate-to-hoard-mint-level",
    "href": "circulation_model.html#aggregate-to-hoard-mint-level",
    "title": "Roman Coin Circulation Model",
    "section": "3.8 1.8 Aggregate to Hoard-Mint Level",
    "text": "3.8 1.8 Aggregate to Hoard-Mint Level\n\n\nCode\n# Aggregate: count of each mint-region in each hoard\nhoard_mint &lt;- chrr_analysis %&gt;%\n  group_by(\n    hoard_id, hoard_lat, hoard_long, tpq_year, depo_period,\n    mint_region, mint_lat, mint_lon\n  ) %&gt;%\n  summarise(\n    n_types = n(),\n    mean_circ_age = mean(circ_age, na.rm = TRUE),\n    .groups = \"drop\"\n  ) %&gt;%\n  # Recalculate distances at aggregated level\n  mutate(\n    dist_from_mint_km = sqrt(\n      ((hoard_long - mint_lon) * 111 * cos(mint_lat * pi/180))^2 + \n      ((hoard_lat - mint_lat) * 111)^2\n    ),\n    bearing_rad = atan2(\n      (hoard_long - mint_lon) * cos(mint_lat * pi/180),\n      hoard_lat - mint_lat\n    ),\n    cos_bearing = cos(bearing_rad),\n    sin_bearing = sin(bearing_rad)\n  )\n\n# Get hoard totals\nhoard_totals &lt;- hoard_mint %&gt;%\n  group_by(hoard_id) %&gt;%\n  summarise(n_total = sum(n_types), .groups = \"drop\")\n\nhoard_mint &lt;- hoard_mint %&gt;%\n  left_join(hoard_totals, by = \"hoard_id\") %&gt;%\n  mutate(prop_mint = n_types / n_total)\n\ncat(\"✓ Hoard-mint aggregation:\", nrow(hoard_mint), \"records\\n\")\n\n\n✓ Hoard-mint aggregation: 970 records"
  },
  {
    "objectID": "circulation_model.html#map-mint-locations-by-region",
    "href": "circulation_model.html#map-mint-locations-by-region",
    "title": "Roman Coin Circulation Model",
    "section": "4.1 2.1 Map Mint Locations by Region",
    "text": "4.1 2.1 Map Mint Locations by Region\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Get basemap\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;% \n  st_union()\n\n# Mint locations\nmint_sf &lt;- mint_coords %&gt;%\n  filter(!is.na(mint_lat), !is.na(mint_lon)) %&gt;%\n  st_as_sf(coords = c(\"mint_lon\", \"mint_lat\"), crs = 4326, remove = FALSE)\n\n# Color palette for regions\nregion_colors &lt;- c(\n  \"ROME\" = \"#E41A1C\",\n  \"ITAL\" = \"#FF7F00\",\n  \"HISP\" = \"#377EB8\",\n  \"GALL\" = \"#4DAF4A\",\n  \"AFRI\" = \"#984EA3\",\n  \"SICI\" = \"#FFFF33\",\n  \"GREC\" = \"#A65628\",\n  \"ASIA\" = \"#F781BF\",\n  \"PONT\" = \"#999999\",\n  \"MILI\" = \"#000000\",\n  \"UNKN\" = \"#CCCCCC\"\n)\n\nggplot() +\n  geom_sf(data = land, fill = \"grey95\", color = \"grey70\") +\n  geom_sf(data = mint_sf, aes(color = mint_region, size = n_types), alpha = 0.7) +\n  scale_color_manual(values = region_colors, name = \"Mint Region\") +\n  scale_size_continuous(name = \"N Types\", range = c(1, 10), trans = \"sqrt\") +\n  coord_sf(xlim = c(-10, 45), ylim = c(30, 55)) +\n  labs(\n    title = \"Mint Locations by Region\",\n    subtitle = paste(sum(!is.na(mint_coords$mint_lat)), \"mints with coordinates\")\n  ) +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.title = element_blank())"
  },
  {
    "objectID": "circulation_model.html#production-volume-by-region-and-period",
    "href": "circulation_model.html#production-volume-by-region-and-period",
    "title": "Roman Coin Circulation Model",
    "section": "4.2 2.2 Production Volume by Region and Period",
    "text": "4.2 2.2 Production Volume by Region and Period\n\n\nCode\n# Count types by mint region and production period\nproduction &lt;- chrr_analysis %&gt;%\n  filter(mint_region != \"UNKN\") %&gt;%\n  group_by(mint_region, prod_period) %&gt;%\n  summarise(n_types = n(), .groups = \"drop\") %&gt;%\n  complete(mint_region, prod_period, fill = list(n_types = 0))\n\n# Heatmap\nggplot(production, aes(x = prod_period, y = mint_region, fill = n_types)) +\n  geom_tile(color = \"white\") +\n  geom_text(aes(label = ifelse(n_types &gt; 0, n_types, \"\")), size = 3) +\n  scale_fill_viridis_c(option = \"plasma\", name = \"N Types\", trans = \"sqrt\") +\n  labs(\n    title = \"Coin Production by Mint Region and Period\",\n    x = \"Production Period\",\n    y = \"Mint Region\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Time series of production\nggplot(production, aes(x = prod_period, y = n_types, fill = mint_region)) +\n  geom_col(position = \"stack\") +\n  scale_fill_manual(values = region_colors, name = \"Mint Region\") +\n  labs(\n    title = \"Coin Production Over Time\",\n    x = \"Production Period\",\n    y = \"Number of Coin Types\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))"
  },
  {
    "objectID": "circulation_model.html#distance-distributions-by-mint-region",
    "href": "circulation_model.html#distance-distributions-by-mint-region",
    "title": "Roman Coin Circulation Model",
    "section": "4.3 2.3 Distance Distributions by Mint Region",
    "text": "4.3 2.3 Distance Distributions by Mint Region\n\n\nCode\n# Filter to regions with enough data\nmajor_regions &lt;- hoard_mint %&gt;%\n  filter(mint_region %in% c(\"ROME\", \"HISP\", \"GALL\", \"GREC\", \"ASIA\", \"ITAL\", \"SICI\")) %&gt;%\n  filter(!is.na(dist_from_mint_km))\n\nggplot(major_regions, aes(x = dist_from_mint_km, fill = mint_region)) +\n  geom_histogram(bins = 30, alpha = 0.7, color = \"white\") +\n  facet_wrap(~mint_region, scales = \"free_y\", ncol = 3) +\n  scale_fill_manual(values = region_colors) +\n  labs(\n    title = \"How Far Did Coins Travel from Their Mint?\",\n    x = \"Distance from mint (km)\",\n    y = \"Count\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")"
  },
  {
    "objectID": "circulation_model.html#distance-vs-proportion-by-mint-region",
    "href": "circulation_model.html#distance-vs-proportion-by-mint-region",
    "title": "Roman Coin Circulation Model",
    "section": "4.4 2.4 Distance vs Proportion by Mint Region",
    "text": "4.4 2.4 Distance vs Proportion by Mint Region\n\n\nCode\nggplot(major_regions, aes(x = dist_from_mint_km, y = prop_mint)) +\n  geom_point(alpha = 0.3, size = 1) +\n  geom_smooth(method = \"glm\", method.args = list(family = \"quasibinomial\"),\n              color = \"darkred\", se = TRUE) +\n  facet_wrap(~mint_region, scales = \"free\", ncol = 3) +\n  scale_y_continuous(labels = scales::percent_format()) +\n  labs(\n    title = \"Mint Proportion vs Distance from Mint\",\n    subtitle = \"How does a mint's share decline with distance from its source?\",\n    x = \"Distance from mint (km)\",\n    y = \"Proportion of hoard from this mint\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "circulation_model.html#prepare-modeling-data",
    "href": "circulation_model.html#prepare-modeling-data",
    "title": "Roman Coin Circulation Model",
    "section": "5.1 3.1 Prepare Modeling Data",
    "text": "5.1 3.1 Prepare Modeling Data\n\n\nCode\n# Create modeling dataset with required columns\nmodel_data &lt;- hoard_mint %&gt;%\n  filter(\n    mint_region %in% c(\"ROME\", \"HISP\", \"GALL\", \"GREC\", \"ASIA\", \"ITAL\", \"SICI\", \"AFRI\"),\n    !is.na(dist_from_mint_km),\n    !is.na(cos_bearing),\n    n_total &gt;= 5  # Minimum hoard size\n  ) %&gt;%\n  mutate(\n    # Scale distance for numerical stability\n    dist_scaled = dist_from_mint_km / 1000,  # Units of 1000 km\n    \n    # Log transform for age (add 1 to avoid log(0))\n    log_circ_age = log(mean_circ_age + 1),\n    \n    # Ensure factors\n    mint_region = factor(mint_region),\n    hoard_id = factor(hoard_id)\n  )\n\ncat(\"Model data:\", nrow(model_data), \"observations\\n\")\n\n\nModel data: 885 observations\n\n\nCode\ncat(\"Mint regions:\", levels(model_data$mint_region), \"\\n\")\n\n\nMint regions: AFRI GALL GREC ITAL ROME"
  },
  {
    "objectID": "circulation_model.html#independent-models-by-mint-region",
    "href": "circulation_model.html#independent-models-by-mint-region",
    "title": "Roman Coin Circulation Model",
    "section": "5.2 3.2 Independent Models by Mint Region",
    "text": "5.2 3.2 Independent Models by Mint Region\n\n\nCode\n# Fit separate logistic models for each mint region\nfit_region_model &lt;- function(data, region) {\n  \n  region_data &lt;- data %&gt;% filter(mint_region == region)\n  \n  if (nrow(region_data) &lt; 30) {\n    return(NULL)\n  }\n  \n  tryCatch({\n    # Fit GLM with binomial-like weights\n    model &lt;- glm(\n      prop_mint ~ dist_scaled + cos_bearing + sin_bearing,\n      data = region_data,\n      family = quasibinomial(link = \"logit\"),\n      weights = n_total\n    )\n    \n    return(model)\n  }, error = function(e) {\n    return(NULL)\n  })\n}\n\n# Fit models\nregions &lt;- unique(model_data$mint_region)\nregion_models &lt;- setNames(\n  lapply(regions, function(r) fit_region_model(model_data, r)),\n  regions\n)\n\n# Extract coefficients\nregion_coefs &lt;- map_dfr(names(region_models), function(r) {\n  model &lt;- region_models[[r]]\n  if (is.null(model)) return(NULL)\n  \n  tidy(model) %&gt;%\n    mutate(mint_region = r)\n}) %&gt;%\n  filter(!is.na(estimate))\n\n# Display distance decay coefficients\ndistance_effects &lt;- region_coefs %&gt;%\n  filter(term == \"dist_scaled\") %&gt;%\n  arrange(estimate)\n\ncat(\"\\nDistance decay coefficients by region:\\n\")\n\n\n\nDistance decay coefficients by region:\n\n\nCode\ncat(\"(More negative = stronger decay with distance)\\n\\n\")\n\n\n(More negative = stronger decay with distance)\n\n\nCode\nkable(distance_effects %&gt;% \n        dplyr::select(mint_region, estimate, std.error, p.value) %&gt;%\n        mutate(\n          or_per_1000km = exp(estimate),\n          sig = ifelse(p.value &lt; 0.05, \"*\", \"\")\n        ),\n      digits = c(0, 3, 3, 4, 3, 0),\n      col.names = c(\"Region\", \"Coefficient\", \"SE\", \"p-value\", \"OR/1000km\", \"\"))\n\n\n\n\n\nRegion\nCoefficient\nSE\np-value\nOR/1000km\n\n\n\n\n\nROME\n0.068\n0.106\n0.5187\n1.071\n\n\n\nITAL\n0.140\n0.131\n0.2848\n1.150\n\n\n\nGALL\n0.155\n0.134\n0.2476\n1.168\n\n\n\nAFRI\n0.409\n0.979\n0.6790\n1.505"
  },
  {
    "objectID": "circulation_model.html#visualize-independent-model-fits",
    "href": "circulation_model.html#visualize-independent-model-fits",
    "title": "Roman Coin Circulation Model",
    "section": "5.3 3.3 Visualize Independent Model Fits",
    "text": "5.3 3.3 Visualize Independent Model Fits\n\n\nCode\n# Create predictions for each region\npred_data &lt;- expand_grid(\n  dist_scaled = seq(0, 3, 0.1),\n  cos_bearing = 0,\n  sin_bearing = 0\n)\n\npredictions &lt;- map_dfr(names(region_models), function(r) {\n  model &lt;- region_models[[r]]\n  if (is.null(model)) return(NULL)\n  \n  preds &lt;- predict(model, newdata = pred_data, type = \"response\", se.fit = TRUE)\n  \n  pred_data %&gt;%\n    mutate(\n      mint_region = r,\n      pred = preds$fit,\n      se = preds$se.fit,\n      lower = pred - 1.96 * se,\n      upper = pred + 1.96 * se,\n      dist_km = dist_scaled * 1000\n    )\n})\n\nggplot(predictions, aes(x = dist_km, y = pred, color = mint_region, fill = mint_region)) +\n  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +\n  geom_line(linewidth = 1) +\n  scale_color_manual(values = region_colors) +\n  scale_fill_manual(values = region_colors) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0, 1)) +\n  labs(\n    title = \"Distance Decay Curves by Mint Region\",\n    subtitle = \"Predicted proportion vs distance from mint of origin\",\n    x = \"Distance from mint (km)\",\n    y = \"Predicted proportion\",\n    color = \"Mint Region\",\n    fill = \"Mint Region\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "circulation_model.html#hierarchical-model-partial-pooling",
    "href": "circulation_model.html#hierarchical-model-partial-pooling",
    "title": "Roman Coin Circulation Model",
    "section": "5.4 3.4 Hierarchical Model (Partial Pooling)",
    "text": "5.4 3.4 Hierarchical Model (Partial Pooling)\n\n\nCode\n# Check we have enough regions for hierarchical model\nn_regions &lt;- n_distinct(model_data$mint_region)\ncat(\"Number of mint regions in model data:\", n_regions, \"\\n\")\n\n\nNumber of mint regions in model data: 5 \n\n\nCode\ncat(\"Observations per region:\\n\")\n\n\nObservations per region:\n\n\nCode\nprint(table(model_data$mint_region))\n\n\n\nAFRI GALL GREC ITAL ROME \n  34  180   24  224  423 \n\n\nCode\nif (n_regions &lt; 2) {\n  cat(\"\\n⚠ Only one mint region with data - cannot fit hierarchical model\\n\")\n  cat(\"Falling back to simple linear model\\n\")\n  \n  # Fallback: simple model without random effects\n  hierarchical_model &lt;- lm(\n    qlogis(pmax(pmin(prop_mint, 0.999), 0.001)) ~ \n      dist_scaled + cos_bearing + sin_bearing,\n    data = model_data,\n    weights = sqrt(n_total)\n  )\n  \n  use_hierarchical &lt;- FALSE\n} else {\n  # Fit mixed effects model with random slopes by mint region\n  hierarchical_model &lt;- lmer(\n    qlogis(pmax(pmin(prop_mint, 0.999), 0.001)) ~ \n      dist_scaled + cos_bearing + sin_bearing +\n      (1 + dist_scaled | mint_region),\n    data = model_data,\n    weights = sqrt(n_total),\n    control = lmerControl(optimizer = \"bobyqa\", optCtrl = list(maxfun = 100000))\n  )\n  \n  use_hierarchical &lt;- TRUE\n}\n\nsummary(hierarchical_model)\n\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: \nqlogis(pmax(pmin(prop_mint, 0.999), 0.001)) ~ dist_scaled + cos_bearing +  \n    sin_bearing + (1 + dist_scaled | mint_region)\n   Data: model_data\nWeights: sqrt(n_total)\nControl: lmerControl(optimizer = \"bobyqa\", optCtrl = list(maxfun = 1e+05))\n\nREML criterion at convergence: 2896\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.65855 -0.63255 -0.01002  0.80313  2.97529 \n\nRandom effects:\n Groups      Name        Variance  Std.Dev. Corr\n mint_region (Intercept) 1.469e+01 3.83331      \n             dist_scaled 1.356e-04 0.01164  1.00\n Residual                1.134e+01 3.36730      \nNumber of obs: 885, groups:  mint_region, 5\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept) -2.78526    1.71677  -1.622\ndist_scaled  0.15480    0.07952   1.947\ncos_bearing -0.11422    0.07602  -1.503\nsin_bearing  0.01637    0.05164   0.317\n\nCorrelation of Fixed Effects:\n            (Intr) dst_sc cs_brn\ndist_scaled  0.026              \ncos_bearing -0.012  0.075       \nsin_bearing -0.002  0.065  0.013\noptimizer (bobyqa) convergence code: 0 (OK)\nboundary (singular) fit: see help('isSingular')"
  },
  {
    "objectID": "circulation_model.html#extract-hierarchical-coefficients",
    "href": "circulation_model.html#extract-hierarchical-coefficients",
    "title": "Roman Coin Circulation Model",
    "section": "5.5 3.5 Extract Hierarchical Coefficients",
    "text": "5.5 3.5 Extract Hierarchical Coefficients\n\n\nCode\nif (use_hierarchical) {\n  # Fixed effects (population average)\n  fixed_eff &lt;- fixef(hierarchical_model)\n  cat(\"\\nFixed effects (population average):\\n\")\n  print(fixed_eff)\n  \n  # Random effects (mint-specific deviations)\n  random_eff &lt;- ranef(hierarchical_model)$mint_region\n  cat(\"\\nRandom effects (deviations from population average):\\n\")\n  print(random_eff)\n  \n  # Combine to get mint-specific coefficients\n  hier_coefs &lt;- random_eff %&gt;%\n    rownames_to_column(\"mint_region\") %&gt;%\n    rename(\n      intercept_dev = `(Intercept)`,\n      slope_dev = dist_scaled\n    ) %&gt;%\n    mutate(\n      intercept_total = fixed_eff[\"(Intercept)\"] + intercept_dev,\n      slope_total = fixed_eff[\"dist_scaled\"] + slope_dev,\n      or_per_1000km = exp(slope_total)\n    )\n  \n  cat(\"\\nMint-specific coefficients (with partial pooling):\\n\")\n  kable(hier_coefs, digits = 3)\n  \n} else {\n  # Fallback: use coefficients from simple model\n  fixed_eff &lt;- coef(hierarchical_model)\n  cat(\"\\nFixed effects (simple model - no pooling):\\n\")\n  print(fixed_eff)\n  \n  # Create single-row hier_coefs for compatibility\n  hier_coefs &lt;- tibble(\n    mint_region = unique(model_data$mint_region)[1],\n    intercept_dev = 0,\n    slope_dev = 0,\n    intercept_total = fixed_eff[\"(Intercept)\"],\n    slope_total = fixed_eff[\"dist_scaled\"],\n    or_per_1000km = exp(fixed_eff[\"dist_scaled\"])\n  )\n  \n  cat(\"\\nNote: Only one region available, using pooled estimates\\n\")\n}\n\n\n\nFixed effects (population average):\n(Intercept) dist_scaled cos_bearing sin_bearing \n-2.78525869  0.15479626 -0.11421802  0.01636517 \n\nRandom effects (deviations from population average):\n     (Intercept)  dist_scaled\nAFRI   -1.732167 -0.005261253\nGALL   -1.481389 -0.004499544\nGREC   -2.162850 -0.006569402\nITAL   -1.457424 -0.004426755\nROME    6.833830  0.020756955\n\nMint-specific coefficients (with partial pooling):\n\n\n\n\n\n\n\n\n\n\n\n\n\nmint_region\nintercept_dev\nslope_dev\nintercept_total\nslope_total\nor_per_1000km\n\n\n\n\nAFRI\n-1.732\n-0.005\n-4.517\n0.150\n1.161\n\n\nGALL\n-1.481\n-0.004\n-4.267\n0.150\n1.162\n\n\nGREC\n-2.163\n-0.007\n-4.948\n0.148\n1.160\n\n\nITAL\n-1.457\n-0.004\n-4.243\n0.150\n1.162\n\n\nROME\n6.834\n0.021\n4.049\n0.176\n1.192"
  },
  {
    "objectID": "circulation_model.html#compare-independent-vs-hierarchical-estimates",
    "href": "circulation_model.html#compare-independent-vs-hierarchical-estimates",
    "title": "Roman Coin Circulation Model",
    "section": "5.6 3.6 Compare Independent vs Hierarchical Estimates",
    "text": "5.6 3.6 Compare Independent vs Hierarchical Estimates\n\n\nCode\nif (use_hierarchical && nrow(hier_coefs) &gt; 1) {\n  # Combine estimates\n  comparison &lt;- distance_effects %&gt;%\n    dplyr::select(mint_region, ind_estimate = estimate, ind_se = std.error) %&gt;%\n    left_join(\n      hier_coefs %&gt;% dplyr::select(mint_region, hier_estimate = slope_total),\n      by = \"mint_region\"\n    ) %&gt;%\n    filter(!is.na(hier_estimate))\n  \n  if (nrow(comparison) &gt; 1) {\n    ggplot(comparison, aes(x = ind_estimate, y = hier_estimate)) +\n      geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"grey50\") +\n      geom_errorbarh(aes(xmin = ind_estimate - 1.96*ind_se, \n                         xmax = ind_estimate + 1.96*ind_se),\n                     height = 0, alpha = 0.5) +\n      geom_point(aes(color = mint_region), size = 4) +\n      geom_text(aes(label = mint_region), vjust = -1, size = 3) +\n      scale_color_manual(values = region_colors) +\n      labs(\n        title = \"Shrinkage: Independent vs Hierarchical Estimates\",\n        subtitle = \"Points closer to diagonal = less shrinkage; away = more pooling\",\n        x = \"Independent estimate (no pooling)\",\n        y = \"Hierarchical estimate (partial pooling)\"\n      ) +\n      theme_minimal() +\n      theme(legend.position = \"none\")\n  } else {\n    cat(\"Not enough regions to compare estimates\\n\")\n  }\n} else {\n  cat(\"Hierarchical model not fitted or only one region - skipping comparison plot\\n\")\n}"
  },
  {
    "objectID": "circulation_model.html#add-circulation-age-effect",
    "href": "circulation_model.html#add-circulation-age-effect",
    "title": "Roman Coin Circulation Model",
    "section": "5.7 3.7 Add Circulation Age Effect",
    "text": "5.7 3.7 Add Circulation Age Effect\n\n\nCode\nif (use_hierarchical) {\n  # Model with circulation age\n  age_model &lt;- lmer(\n    qlogis(pmax(pmin(prop_mint, 0.999), 0.001)) ~ \n      dist_scaled + cos_bearing + sin_bearing + log_circ_age +\n      (1 + dist_scaled | mint_region),\n    data = model_data %&gt;% filter(!is.na(log_circ_age)),\n    weights = sqrt(n_total),\n    control = lmerControl(optimizer = \"bobyqa\", optCtrl = list(maxfun = 100000))\n  )\n  \n  cat(\"\\nModel with circulation age:\\n\")\n  summary(age_model)\n  \n  # Compare AIC\n  cat(\"\\n\\nModel comparison:\\n\")\n  cat(\"Without age:\", AIC(hierarchical_model), \"\\n\")\n  cat(\"With age:\", AIC(age_model), \"\\n\")\n} else {\n  # Fallback: simple model with age\n  age_model &lt;- lm(\n    qlogis(pmax(pmin(prop_mint, 0.999), 0.001)) ~ \n      dist_scaled + cos_bearing + sin_bearing + log_circ_age,\n    data = model_data %&gt;% filter(!is.na(log_circ_age)),\n    weights = sqrt(n_total)\n  )\n  \n  cat(\"\\nModel with circulation age (simple, no random effects):\\n\")\n  summary(age_model)\n}\n\n\n\nModel with circulation age:\n\n\nModel comparison:\nWithout age: 2912.027 \nWith age: 2884.034"
  },
  {
    "objectID": "circulation_model.html#create-prediction-grid",
    "href": "circulation_model.html#create-prediction-grid",
    "title": "Roman Coin Circulation Model",
    "section": "6.1 4.1 Create Prediction Grid",
    "text": "6.1 4.1 Create Prediction Grid\n\n\nCode\n# Create hexagonal grid covering study area\nstudy_bbox &lt;- st_bbox(c(xmin = -10, ymin = 30, xmax = 45, ymax = 55), crs = 4326)\n\n# Project for hexagon creation\nstudy_poly &lt;- st_as_sfc(study_bbox) %&gt;% st_transform(3035)\n\nhex_grid &lt;- st_make_grid(study_poly, cellsize = 100000, square = FALSE) %&gt;%\n  st_sf(hex_id = seq_along(.), geometry = .) %&gt;%\n  st_transform(4326)\n\n# Get centroids\nhex_centroids &lt;- st_centroid(hex_grid)\ncent_coords &lt;- st_coordinates(hex_centroids)\n\nhex_grid &lt;- hex_grid %&gt;%\n  mutate(\n    cent_lon = cent_coords[, 1],\n    cent_lat = cent_coords[, 2]\n  )\n\n# Filter to land (approximate)\nland_simple &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;%\n  filter(continent %in% c(\"Europe\", \"Africa\", \"Asia\")) %&gt;%\n  st_union() %&gt;%\n  st_simplify(dTolerance = 10000)\n\nhex_land &lt;- hex_grid %&gt;%\n  filter(lengths(st_intersects(., land_simple)) &gt; 0)\n\ncat(\"Prediction grid:\", nrow(hex_land), \"hexes\\n\")\n\n\nPrediction grid: 1461 hexes"
  },
  {
    "objectID": "circulation_model.html#compute-distances-from-each-mint-region",
    "href": "circulation_model.html#compute-distances-from-each-mint-region",
    "title": "Roman Coin Circulation Model",
    "section": "6.2 4.2 Compute Distances from Each Mint Region",
    "text": "6.2 4.2 Compute Distances from Each Mint Region\n\n\nCode\n# Get representative coordinates for each mint region\nmint_region_coords &lt;- mint_coords %&gt;%\n  filter(!is.na(mint_lat), mint_region %in% levels(model_data$mint_region)) %&gt;%\n  group_by(mint_region) %&gt;%\n  summarise(\n    region_lat = weighted.mean(mint_lat, n_types, na.rm = TRUE),\n    region_lon = weighted.mean(mint_lon, n_types, na.rm = TRUE),\n    n_mints = n(),\n    n_types = sum(n_types),\n    .groups = \"drop\"\n  )\n\ncat(\"Mint region centroids:\\n\")\n\n\nMint region centroids:\n\n\nCode\nkable(mint_region_coords, digits = 2)\n\n\n\n\n\nmint_region\nregion_lat\nregion_lon\nn_mints\nn_types\n\n\n\n\nAFRI\n37.50\n14.00\n8\n45\n\n\nGALL\n43.19\n2.98\n8\n386\n\n\nGREC\n40.72\n19.48\n17\n32\n\n\nITAL\n44.03\n12.16\n19\n399\n\n\nROME\n41.90\n12.50\n2\n28177\n\n\n\n\n\nCode\n# Compute distance from each hex to each mint region\nhex_to_mint &lt;- expand_grid(\n  hex_id = hex_land$hex_id,\n  mint_region = mint_region_coords$mint_region\n) %&gt;%\n  left_join(hex_land %&gt;% st_drop_geometry() %&gt;% dplyr::select(hex_id, cent_lon, cent_lat), \n            by = \"hex_id\") %&gt;%\n  left_join(mint_region_coords, by = \"mint_region\") %&gt;%\n  mutate(\n    delta_lon = cent_lon - region_lon,\n    delta_lat = cent_lat - region_lat,\n    dist_km = sqrt(\n      (delta_lon * 111 * cos(region_lat * pi/180))^2 +\n      (delta_lat * 111)^2\n    ),\n    dist_scaled = dist_km / 1000,\n    bearing_rad = atan2(\n      delta_lon * cos(region_lat * pi/180),\n      delta_lat\n    ),\n    cos_bearing = cos(bearing_rad),\n    sin_bearing = sin(bearing_rad)\n  )\n\ncat(\"✓ Computed distances:\", nrow(hex_to_mint), \"hex-mint pairs\\n\")\n\n\n✓ Computed distances: 7305 hex-mint pairs"
  },
  {
    "objectID": "circulation_model.html#generate-probability-surface-for-each-mint-region",
    "href": "circulation_model.html#generate-probability-surface-for-each-mint-region",
    "title": "Roman Coin Circulation Model",
    "section": "6.3 4.3 Generate Probability Surface for Each Mint Region",
    "text": "6.3 4.3 Generate Probability Surface for Each Mint Region\n\n\nCode\n# Predict using the fitted model\n# Create prediction data\nif (use_hierarchical) {\n  pred_surface &lt;- hex_to_mint %&gt;%\n    mutate(\n      # Predict linear predictor with random effects\n      eta = predict(hierarchical_model, \n                    newdata = data.frame(\n                      dist_scaled = dist_scaled,\n                      cos_bearing = cos_bearing,\n                      sin_bearing = sin_bearing,\n                      mint_region = factor(mint_region, levels = levels(model_data$mint_region))\n                    ),\n                    allow.new.levels = FALSE,\n                    re.form = NULL),  # Include random effects\n      \n      # Convert to probability\n      prob_raw = plogis(eta)\n    )\n} else {\n  # Simple model prediction (no random effects)\n  pred_surface &lt;- hex_to_mint %&gt;%\n    mutate(\n      eta = predict(hierarchical_model, \n                    newdata = data.frame(\n                      dist_scaled = dist_scaled,\n                      cos_bearing = cos_bearing,\n                      sin_bearing = sin_bearing\n                    )),\n      prob_raw = plogis(eta)\n    )\n}\n\n# Handle regions not in model\npred_surface &lt;- pred_surface %&gt;%\n  mutate(\n    prob_raw = ifelse(is.na(prob_raw), 0.01, prob_raw)  # Small baseline for missing\n  )\n\n# Get production weights (total types per region)\nproduction_weights &lt;- chrr_analysis %&gt;%\n  filter(mint_region %in% mint_region_coords$mint_region) %&gt;%\n  group_by(mint_region) %&gt;%\n  summarise(production = n(), .groups = \"drop\") %&gt;%\n  mutate(prod_weight = production / sum(production))\n\n# Add production weights\npred_surface &lt;- pred_surface %&gt;%\n  left_join(production_weights, by = \"mint_region\") %&gt;%\n  mutate(\n    weighted_prob = prob_raw * prod_weight\n  )\n\n# Normalize within each hex\npred_normalized &lt;- pred_surface %&gt;%\n  group_by(hex_id) %&gt;%\n  mutate(\n    total_prob = sum(weighted_prob),\n    expected_prop = weighted_prob / total_prob\n  ) %&gt;%\n  ungroup()\n\ncat(\"✓ Probability surface generated\\n\")\n\n\n✓ Probability surface generated"
  },
  {
    "objectID": "circulation_model.html#create-multi-layer-spatial-object",
    "href": "circulation_model.html#create-multi-layer-spatial-object",
    "title": "Roman Coin Circulation Model",
    "section": "6.4 4.4 Create Multi-Layer Spatial Object",
    "text": "6.4 4.4 Create Multi-Layer Spatial Object\n\n\nCode\n# Pivot to wide format\nprob_wide &lt;- pred_normalized %&gt;%\n  dplyr::select(hex_id, mint_region, expected_prop, dist_km) %&gt;%\n  pivot_wider(\n    id_cols = hex_id,\n    names_from = mint_region,\n    values_from = c(expected_prop, dist_km),\n    names_sep = \"_\"\n  )\n\n# Calculate summary metrics\nprob_summary &lt;- pred_normalized %&gt;%\n  group_by(hex_id) %&gt;%\n  summarise(\n    dominant_mint = mint_region[which.max(expected_prop)],\n    max_prop = max(expected_prop),\n    entropy = -sum(expected_prop * log(expected_prop + 1e-10)),\n    rome_prop = sum(expected_prop[mint_region == \"ROME\"]),\n    .groups = \"drop\"\n  )\n\n# Join to hex grid\nhex_probs &lt;- hex_land %&gt;%\n  left_join(prob_wide, by = \"hex_id\") %&gt;%\n  left_join(prob_summary, by = \"hex_id\")\n\ncat(\"✓ Multi-layer spatial object created\\n\")\n\n\n✓ Multi-layer spatial object created\n\n\nCode\ncat(\"  Columns:\", ncol(hex_probs), \"\\n\")\n\n\n  Columns: 18"
  },
  {
    "objectID": "circulation_model.html#rome-proportion-surface",
    "href": "circulation_model.html#rome-proportion-surface",
    "title": "Roman Coin Circulation Model",
    "section": "7.1 5.1 Rome Proportion Surface",
    "text": "7.1 5.1 Rome Proportion Surface\n\n\nCode\n# Rome proportion map\nggplot() +\n  geom_sf(data = land_simple, fill = \"grey95\", color = \"grey70\") +\n  geom_sf(data = hex_probs, aes(fill = expected_prop_ROME), color = NA) +\n  geom_point(data = mint_region_coords %&gt;% filter(mint_region == \"ROME\"),\n             aes(x = region_lon, y = region_lat), \n             shape = 8, size = 5, color = \"black\", stroke = 2) +\n  scale_fill_viridis_c(\n    name = \"Expected\\nRome %\",\n    option = \"plasma\",\n    labels = scales::percent_format(),\n    limits = c(0, 1)\n  ) +\n  coord_sf(xlim = c(-10, 42), ylim = c(30, 55)) +\n  labs(\n    title = \"Expected Proportion of Rome-Minted Coins\",\n    subtitle = \"Based on hierarchical diffusion model | Star = Rome\"\n  ) +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.title = element_blank())"
  },
  {
    "objectID": "circulation_model.html#dominant-mint-map",
    "href": "circulation_model.html#dominant-mint-map",
    "title": "Roman Coin Circulation Model",
    "section": "7.2 5.2 Dominant Mint Map",
    "text": "7.2 5.2 Dominant Mint Map\n\n\nCode\nggplot() +\n  geom_sf(data = land_simple, fill = \"grey95\", color = \"grey70\") +\n  geom_sf(data = hex_probs, aes(fill = dominant_mint), color = \"white\", linewidth = 0.1) +\n  geom_point(data = mint_region_coords,\n             aes(x = region_lon, y = region_lat, color = mint_region),\n             shape = 17, size = 4) +\n  scale_fill_manual(values = region_colors, name = \"Dominant\\nMint\") +\n  scale_color_manual(values = region_colors, guide = \"none\") +\n  coord_sf(xlim = c(-10, 42), ylim = c(30, 55)) +\n  labs(\n    title = \"Dominant Mint Region by Location\",\n    subtitle = \"Which mint is expected to contribute most coins?\"\n  ) +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.title = element_blank())"
  },
  {
    "objectID": "circulation_model.html#compositional-entropy-map",
    "href": "circulation_model.html#compositional-entropy-map",
    "title": "Roman Coin Circulation Model",
    "section": "7.3 5.3 Compositional Entropy Map",
    "text": "7.3 5.3 Compositional Entropy Map\n\n\nCode\nggplot() +\n  geom_sf(data = land_simple, fill = \"grey95\", color = \"grey70\") +\n  geom_sf(data = hex_probs, aes(fill = entropy), color = NA) +\n  geom_point(data = mint_region_coords,\n             aes(x = region_lon, y = region_lat),\n             shape = 17, size = 3, color = \"black\") +\n  scale_fill_viridis_c(\n    name = \"Entropy\",\n    option = \"viridis\"\n  ) +\n  coord_sf(xlim = c(-10, 42), ylim = c(30, 55)) +\n  labs(\n    title = \"Compositional Diversity (Entropy)\",\n    subtitle = \"Higher entropy = more mixed sources | Triangles = mint region centroids\"\n  ) +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.title = element_blank())"
  },
  {
    "objectID": "circulation_model.html#individual-mint-surfaces",
    "href": "circulation_model.html#individual-mint-surfaces",
    "title": "Roman Coin Circulation Model",
    "section": "7.4 5.4 Individual Mint Surfaces",
    "text": "7.4 5.4 Individual Mint Surfaces\n\n\nCode\n# Create individual panels for each mint region\nmint_panels &lt;- pred_normalized %&gt;%\n  filter(mint_region %in% c(\"ROME\", \"HISP\", \"GALL\", \"GREC\", \"ASIA\", \"ITAL\")) %&gt;%\n  left_join(hex_land %&gt;% st_drop_geometry() %&gt;% dplyr::select(hex_id, cent_lon, cent_lat),\n            by = \"hex_id\")\n\n# Get hex geometries\nhex_for_plot &lt;- hex_land %&gt;%\n  inner_join(\n    pred_normalized %&gt;% \n      filter(mint_region %in% c(\"ROME\", \"HISP\", \"GALL\", \"GREC\", \"ASIA\", \"ITAL\")) %&gt;%\n      dplyr::select(hex_id, mint_region, expected_prop),\n    by = \"hex_id\"\n  )\n\nggplot() +\n  geom_sf(data = land_simple, fill = \"grey95\", color = \"grey70\") +\n  geom_sf(data = hex_for_plot, aes(fill = expected_prop), color = NA) +\n  geom_point(data = mint_region_coords %&gt;% \n               filter(mint_region %in% c(\"ROME\", \"HISP\", \"GALL\", \"GREC\", \"ASIA\", \"ITAL\")),\n             aes(x = region_lon, y = region_lat),\n             shape = 8, size = 3, color = \"black\", stroke = 1.5) +\n  facet_wrap(~mint_region, ncol = 3) +\n  scale_fill_viridis_c(\n    name = \"Expected\\nProportion\",\n    option = \"plasma\",\n    labels = scales::percent_format()\n  ) +\n  coord_sf(xlim = c(-10, 42), ylim = c(30, 55)) +\n  labs(\n    title = \"Expected Coin Proportion by Mint Region\",\n    subtitle = \"Stars = mint centroid locations\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(), \n    axis.title = element_blank(),\n    strip.text = element_text(size = 12, face = \"bold\")\n  )"
  },
  {
    "objectID": "circulation_model.html#mint-catchment-areas",
    "href": "circulation_model.html#mint-catchment-areas",
    "title": "Roman Coin Circulation Model",
    "section": "7.5 5.5 Mint Catchment Areas",
    "text": "7.5 5.5 Mint Catchment Areas\n\n\nCode\n# Define catchment as area where mint is dominant or &gt;20% share\ncatchment_data &lt;- pred_normalized %&gt;%\n  filter(expected_prop &gt; 0.15) %&gt;%\n  left_join(hex_land %&gt;% dplyr::select(hex_id), by = \"hex_id\")\n\ncatchment_sf &lt;- hex_land %&gt;%\n  inner_join(\n    catchment_data %&gt;% dplyr::select(hex_id, mint_region, expected_prop),\n    by = \"hex_id\"\n  )\n\nggplot() +\n  geom_sf(data = land_simple, fill = \"grey95\", color = \"grey70\") +\n  geom_sf(data = catchment_sf, aes(fill = mint_region), alpha = 0.6, color = \"white\", linewidth = 0.1) +\n  geom_point(data = mint_region_coords,\n             aes(x = region_lon, y = region_lat, color = mint_region),\n             shape = 17, size = 5) +\n  scale_fill_manual(values = region_colors, name = \"Mint Region\") +\n  scale_color_manual(values = region_colors, guide = \"none\") +\n  coord_sf(xlim = c(-10, 42), ylim = c(30, 55)) +\n  labs(\n    title = \"Mint Catchment Areas (&gt;15% expected share)\",\n    subtitle = \"Overlapping areas show competing mint influences\"\n  ) +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.title = element_blank())"
  },
  {
    "objectID": "circulation_model.html#cross-validation",
    "href": "circulation_model.html#cross-validation",
    "title": "Roman Coin Circulation Model",
    "section": "8.1 6.1 Cross-Validation",
    "text": "8.1 6.1 Cross-Validation\n\n\nCode\n# Simple validation: compare predicted vs observed for hoards\n# Aggregate observed data to hoard level by mint region\nobserved_props &lt;- hoard_mint %&gt;%\n  filter(mint_region %in% mint_region_coords$mint_region) %&gt;%\n  group_by(hoard_id, hoard_lat, hoard_long, mint_region) %&gt;%\n  summarise(\n    observed_prop = sum(n_types) / first(n_total),\n    n_total = first(n_total),\n    .groups = \"drop\"\n  )\n\n# Find nearest hex for each hoard\nhoard_sf &lt;- observed_props %&gt;%\n  distinct(hoard_id, hoard_lat, hoard_long) %&gt;%\n  st_as_sf(coords = c(\"hoard_long\", \"hoard_lat\"), crs = 4326)\n\nhex_centroids_sf &lt;- hex_land %&gt;% st_centroid()\n\nnearest_hex &lt;- st_nearest_feature(hoard_sf, hex_centroids_sf)\nhoard_hex_map &lt;- tibble(\n  hoard_id = hoard_sf$hoard_id,\n  hex_id = hex_land$hex_id[nearest_hex]\n)\n\n# Join predictions to observations\nvalidation &lt;- observed_props %&gt;%\n  left_join(hoard_hex_map, by = \"hoard_id\") %&gt;%\n  left_join(\n    pred_normalized %&gt;% dplyr::select(hex_id, mint_region, expected_prop),\n    by = c(\"hex_id\", \"mint_region\")\n  ) %&gt;%\n  filter(!is.na(expected_prop))\n\n# Calculate metrics\nvalidation_metrics &lt;- validation %&gt;%\n  group_by(mint_region) %&gt;%\n  summarise(\n    n_obs = n(),\n    rmse = sqrt(mean((observed_prop - expected_prop)^2)),\n    mae = mean(abs(observed_prop - expected_prop)),\n    cor = cor(observed_prop, expected_prop, use = \"complete.obs\"),\n    .groups = \"drop\"\n  )\n\ncat(\"\\nValidation metrics by mint region:\\n\")\n\n\n\nValidation metrics by mint region:\n\n\nCode\nkable(validation_metrics, digits = 3)\n\n\n\n\n\nmint_region\nn_obs\nrmse\nmae\ncor\n\n\n\n\nAFRI\n34\n0.056\n0.035\n-0.095\n\n\nGALL\n175\n0.050\n0.028\n0.147\n\n\nGREC\n24\n0.019\n0.014\n-0.234\n\n\nITAL\n195\n0.061\n0.036\n0.046\n\n\nROME\n461\n0.063\n0.030\n-0.019"
  },
  {
    "objectID": "circulation_model.html#observed-vs-predicted-plot",
    "href": "circulation_model.html#observed-vs-predicted-plot",
    "title": "Roman Coin Circulation Model",
    "section": "8.2 6.2 Observed vs Predicted Plot",
    "text": "8.2 6.2 Observed vs Predicted Plot\n\n\nCode\nggplot(validation %&gt;% filter(mint_region %in% c(\"ROME\", \"HISP\", \"GREC\", \"GALL\")), \n       aes(x = expected_prop, y = observed_prop)) +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"grey50\") +\n  geom_point(alpha = 0.3, size = 1) +\n  geom_smooth(method = \"lm\", color = \"darkred\", se = TRUE) +\n  facet_wrap(~mint_region, scales = \"free\") +\n  scale_x_continuous(labels = scales::percent_format()) +\n  scale_y_continuous(labels = scales::percent_format()) +\n  labs(\n    title = \"Observed vs Predicted Mint Proportions\",\n    subtitle = \"Dashed line = perfect prediction; red line = actual fit\",\n    x = \"Predicted proportion (from model)\",\n    y = \"Observed proportion (in hoards)\"\n  ) +\n  theme_minimal()"
  },
  {
    "objectID": "circulation_model.html#residual-mapping",
    "href": "circulation_model.html#residual-mapping",
    "title": "Roman Coin Circulation Model",
    "section": "8.3 6.3 Residual Mapping",
    "text": "8.3 6.3 Residual Mapping\n\n\nCode\n# Calculate residuals for Rome - get coordinates from hoard_mint\nrome_residuals &lt;- validation %&gt;%\n  filter(mint_region == \"ROME\") %&gt;%\n  mutate(residual = observed_prop - expected_prop)\n\n# Check if we have hoard_lat in validation, if not join it\nif (!\"hoard_lat\" %in% names(rome_residuals)) {\n  rome_residuals &lt;- rome_residuals %&gt;%\n    left_join(\n      hoard_mint %&gt;% \n        distinct(hoard_id, hoard_lat, hoard_long),\n      by = \"hoard_id\"\n    )\n}\n\nrome_resid_sf &lt;- rome_residuals %&gt;%\n  filter(!is.na(hoard_lat), !is.na(hoard_long)) %&gt;%\n  st_as_sf(coords = c(\"hoard_long\", \"hoard_lat\"), crs = 4326)\n\nif (nrow(rome_resid_sf) &gt; 0) {\n  ggplot() +\n    geom_sf(data = land_simple, fill = \"grey95\", color = \"grey70\") +\n    geom_sf(data = rome_resid_sf, aes(color = residual), size = 2, alpha = 0.7) +\n    scale_color_gradient2(\n      name = \"Residual\\n(Obs - Pred)\",\n      low = \"blue\", mid = \"white\", high = \"red\",\n      midpoint = 0,\n      limits = c(-0.5, 0.5),\n      oob = scales::squish\n    ) +\n    coord_sf(xlim = c(-10, 42), ylim = c(30, 55)) +\n    labs(\n      title = \"Rome Proportion Residuals\",\n      subtitle = \"Red = more Rome coins than expected | Blue = fewer than expected\"\n    ) +\n    theme_minimal() +\n    theme(axis.text = element_blank(), axis.title = element_blank())\n} else {\n  cat(\"No Rome residuals to map\\n\")\n}"
  },
  {
    "objectID": "circulation_model.html#identify-anomalous-hoards",
    "href": "circulation_model.html#identify-anomalous-hoards",
    "title": "Roman Coin Circulation Model",
    "section": "8.4 6.4 Identify Anomalous Hoards",
    "text": "8.4 6.4 Identify Anomalous Hoards\n\n\nCode\n# Find hoards with large residuals\nanomalies &lt;- validation %&gt;%\n  filter(mint_region == \"ROME\") %&gt;%\n  mutate(residual = observed_prop - expected_prop) %&gt;%\n  filter(abs(residual) &gt; 0.3) %&gt;%\n  arrange(desc(abs(residual)))\n\ncat(\"\\nAnomalous hoards (Rome residual &gt; 0.3):\\n\")\n\n\n\nAnomalous hoards (Rome residual &gt; 0.3):\n\n\nCode\ncat(\"These may represent military pay, emergency hoards, or unusual circulation patterns\\n\\n\")\n\n\nThese may represent military pay, emergency hoards, or unusual circulation patterns\n\n\nCode\nif (nrow(anomalies) &gt; 0) {\n  kable(head(anomalies %&gt;% \n               dplyr::select(hoard_id, observed_prop, expected_prop, residual, n_total), 20),\n        digits = 3,\n        col.names = c(\"Hoard ID\", \"Observed Rome %\", \"Expected Rome %\", \"Residual\", \"N Types\"))\n} else {\n  cat(\"No hoards with residuals &gt; 0.3\\n\")\n}\n\n\n\n\n\nHoard ID\nObserved Rome %\nExpected Rome %\nResidual\nN Types\n\n\n\n\nPTS\n0.500\n0.999\n-0.499\n2\n\n\nCUP\n0.556\n0.999\n-0.444\n27\n\n\nFAN\n0.611\n1.000\n-0.388\n18\n\n\nNUM\n0.667\n1.000\n-0.333\n15\n\n\nFRC\n0.667\n1.000\n-0.333\n12\n\n\nCSN\n0.667\n1.000\n-0.333\n12\n\n\nSCM\n0.667\n0.999\n-0.333\n21"
  },
  {
    "objectID": "circulation_model.html#comparison-with-hmm-regimes",
    "href": "circulation_model.html#comparison-with-hmm-regimes",
    "title": "Roman Coin Circulation Model",
    "section": "8.5 6.5 Comparison with HMM Regimes",
    "text": "8.5 6.5 Comparison with HMM Regimes\n\n\nCode\n# Compare predictions across regimes (using deposition period as proxy)\nregime_validation &lt;- hoard_mint %&gt;%\n  filter(mint_region == \"ROME\", !is.na(depo_period)) %&gt;%\n  left_join(hoard_hex_map, by = \"hoard_id\") %&gt;%\n  left_join(\n    pred_normalized %&gt;% \n      filter(mint_region == \"ROME\") %&gt;% \n      dplyr::select(hex_id, expected_prop),\n    by = \"hex_id\"\n  ) %&gt;%\n  filter(!is.na(expected_prop))\n\nregime_summary &lt;- regime_validation %&gt;%\n  group_by(depo_period) %&gt;%\n  summarise(\n    n_hoards = n_distinct(hoard_id),\n    mean_observed = mean(prop_mint),\n    mean_predicted = mean(expected_prop),\n    rmse = sqrt(mean((prop_mint - expected_prop)^2)),\n    .groups = \"drop\"\n  )\n\ncat(\"\\nModel performance by deposition period:\\n\")\n\n\n\nModel performance by deposition period:\n\n\nCode\nkable(regime_summary, digits = 3,\n      col.names = c(\"Period\", \"N Hoards\", \"Mean Observed\", \"Mean Predicted\", \"RMSE\"))\n\n\n\n\n\nPeriod\nN Hoards\nMean Observed\nMean Predicted\nRMSE\n\n\n\n\nEarly Republic\n11\n0.787\n1.000\n0.272\n\n\nLate Republic I\n87\n0.973\n0.999\n0.053\n\n\nLate Republic II\n166\n0.970\n1.000\n0.054\n\n\nTriumviral/Augustan\n197\n0.978\n1.000\n0.037"
  },
  {
    "objectID": "circulation_model.html#key-findings",
    "href": "circulation_model.html#key-findings",
    "title": "Roman Coin Circulation Model",
    "section": "9.1 Key Findings",
    "text": "9.1 Key Findings\n\n\nCode\ncat(\"\n================================================================\nROMAN COIN CIRCULATION MODEL: SUMMARY\n================================================================\n\n1. MINT REGIONS CLASSIFIED\n\")\n\n\n\n================================================================\nROMAN COIN CIRCULATION MODEL: SUMMARY\n================================================================\n\n1. MINT REGIONS CLASSIFIED\n\n\nCode\ncat(\"   Total mints:\", nrow(mint_coords), \"\\n\")\n\n\n   Total mints: 74 \n\n\nCode\ncat(\"   With coordinates:\", sum(!is.na(mint_coords$mint_lat)), \"\\n\")\n\n\n   With coordinates: 71 \n\n\nCode\ncat(\"   Regions:\", paste(unique(mint_coords$mint_region), collapse = \", \"), \"\\n\")\n\n\n   Regions: ROME, UNKN, GALL, ITAL, AFRI, GREC, SICI, HISP, ASIA \n\n\nCode\ncat(\"\n2. DIFFUSION PARAMETERS\n\")\n\n\n\n2. DIFFUSION PARAMETERS\n\n\nCode\nif (use_hierarchical) {\n  cat(\"   Model type: Hierarchical (partial pooling)\\n\")\n  cat(\"   Population-level distance decay:\", round(fixef(hierarchical_model)[\"dist_scaled\"], 3), \"\\n\")\n} else {\n  cat(\"   Model type: Simple (no pooling - single region only)\\n\")\n  cat(\"   Distance decay:\", round(coef(hierarchical_model)[\"dist_scaled\"], 3), \"\\n\")\n}\n\n\n   Model type: Hierarchical (partial pooling)\n   Population-level distance decay: 0.155 \n\n\nCode\ncat(\"   (More negative = faster decay with distance)\\n\")\n\n\n   (More negative = faster decay with distance)\n\n\nCode\ncat(\"\n3. MINT-SPECIFIC DECAY RATES\n\")\n\n\n\n3. MINT-SPECIFIC DECAY RATES\n\n\nCode\nif (use_hierarchical && exists(\"random_eff\") && nrow(random_eff) &gt; 0) {\n  for (r in rownames(random_eff)) {\n    total_slope &lt;- fixed_eff[\"dist_scaled\"] + random_eff[r, \"dist_scaled\"]\n    cat(\"   \", r, \":\", round(total_slope, 3), \"\\n\")\n  }\n} else {\n  cat(\"   Single pooled estimate used for all regions\\n\")\n}\n\n\n    AFRI : 0.15 \n    GALL : 0.15 \n    GREC : 0.148 \n    ITAL : 0.15 \n    ROME : 0.176 \n\n\nCode\ncat(\"\n4. VALIDATION\n\")\n\n\n\n4. VALIDATION\n\n\nCode\nrome_validation &lt;- validation %&gt;% filter(mint_region == \"ROME\")\nif (nrow(rome_validation) &gt; 0) {\n  cat(\"   Overall correlation (Rome):\", \n      round(cor(rome_validation$observed_prop,\n                rome_validation$expected_prop, \n                use = \"complete.obs\"), 3), \"\\n\")\n} else {\n  cat(\"   No Rome validation data available\\n\")\n}\n\n\n   Overall correlation (Rome): -0.019 \n\n\nCode\ncat(\"\n5. OUTPUTS GENERATED\n   - Probability surfaces for each mint region\n   - Dominant mint map\n   - Compositional entropy map\n   - Catchment area visualization\n   - Residual analysis identifying anomalous hoards\n\n================================================================\n\")\n\n\n\n5. OUTPUTS GENERATED\n   - Probability surfaces for each mint region\n   - Dominant mint map\n   - Compositional entropy map\n   - Catchment area visualization\n   - Residual analysis identifying anomalous hoards\n\n================================================================"
  },
  {
    "objectID": "circulation_model.html#a.1-adding-circulation-decay",
    "href": "circulation_model.html#a.1-adding-circulation-decay",
    "title": "Roman Coin Circulation Model",
    "section": "12.1 A.1 Adding Circulation Decay",
    "text": "12.1 A.1 Adding Circulation Decay\nTo model withdrawal from circulation, add a decay term:\n\\[w(t - \\tau) = e^{-\\lambda(t - \\tau)}\\]\nWhere \\(\\lambda\\) is the withdrawal rate. This can be estimated by adding an age term to the model:\n# With decay\ndecay_model &lt;- lmer(\n  qlogis(prop_mint) ~ \n    dist_scaled + cos_bearing + sin_bearing + \n    I(-log_circ_age * lambda) +  # Decay term\n    (1 + dist_scaled | mint_region),\n  data = model_data\n)"
  },
  {
    "objectID": "circulation_model.html#a.2-time-varying-probability-surfaces",
    "href": "circulation_model.html#a.2-time-varying-probability-surfaces",
    "title": "Roman Coin Circulation Model",
    "section": "12.2 A.2 Time-Varying Probability Surfaces",
    "text": "12.2 A.2 Time-Varying Probability Surfaces\nTo generate surfaces for specific time periods, filter the production data:\n# Surface for hoards deposited 50-25 BCE\nsurface_P08 &lt;- generate_surface(\n  production_data %&gt;% filter(prod_period &lt;= \"P08\"),\n  deposition_time = -37  # Midpoint of period\n)"
  },
  {
    "objectID": "circulation_model.html#a.3-bayesian-implementation-with-brms",
    "href": "circulation_model.html#a.3-bayesian-implementation-with-brms",
    "title": "Roman Coin Circulation Model",
    "section": "12.3 A.3 Bayesian Implementation with brms",
    "text": "12.3 A.3 Bayesian Implementation with brms\nFor full uncertainty quantification:\nbrm(\n  n_mint | trials(n_total) ~ \n    dist_scaled + cos_bearing + sin_bearing +\n    (1 + dist_scaled | mint_region),\n  family = binomial(),\n  data = model_data,\n  prior = c(\n    prior(normal(0, 2), class = \"b\"),\n    prior(exponential(1), class = \"sd\")\n  ),\n  chains = 4, cores = 4, iter = 2000\n)\nThis would provide posterior predictive intervals on all probability surfaces."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "master_proposal.html",
    "href": "master_proposal.html",
    "title": "Proposal",
    "section": "",
    "text": "1 Introduction"
  },
  {
    "objectID": "lrr_compositional.html",
    "href": "lrr_compositional.html",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "",
    "text": "The initial diagnostic analysis revealed:\n\n\n\nMetric\nValue\n\n\n\n\nHoards containing Rome coins\n99.4%\n\n\nHoards without ANY Rome coins\n3\n\n\n\nWith only 3 hoards lacking Rome coins, the binary contrast (Rome-containing vs. all hoards) collapsed—numerator ≈ denominator everywhere, producing LRR ≈ 0.\n\n\n\nHowever, the diagnostics also revealed exploitable variation:\n\nRome share within hoards varies from 0% to 100% (mean 88%, SD ~15%)\nDistance-decay signal: Rome proportion declines beyond 2000 km\n80% of hoards contain non-Rome coins: compositional diversity exists\n\nThe compositional approach asks: Where is the proportion of Rome-minted coins higher or lower than the global average?\n\\[\\text{LRR}_{\\text{comp}}(s) = \\log \\left( \\frac{p_{\\text{Rome}}(s)}{p_{\\text{Rome}}^{\\text{global}}} \\right)\\]\nwhere \\(p_{\\text{Rome}}(s)\\) is the proportion of Rome coins in spatial unit \\(s\\)."
  },
  {
    "objectID": "lrr_compositional.html#why-binary-lrr-failed",
    "href": "lrr_compositional.html#why-binary-lrr-failed",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "",
    "text": "The initial diagnostic analysis revealed:\n\n\n\nMetric\nValue\n\n\n\n\nHoards containing Rome coins\n99.4%\n\n\nHoards without ANY Rome coins\n3\n\n\n\nWith only 3 hoards lacking Rome coins, the binary contrast (Rome-containing vs. all hoards) collapsed—numerator ≈ denominator everywhere, producing LRR ≈ 0."
  },
  {
    "objectID": "lrr_compositional.html#what-compositional-lrr-captures",
    "href": "lrr_compositional.html#what-compositional-lrr-captures",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "",
    "text": "However, the diagnostics also revealed exploitable variation:\n\nRome share within hoards varies from 0% to 100% (mean 88%, SD ~15%)\nDistance-decay signal: Rome proportion declines beyond 2000 km\n80% of hoards contain non-Rome coins: compositional diversity exists\n\nThe compositional approach asks: Where is the proportion of Rome-minted coins higher or lower than the global average?\n\\[\\text{LRR}_{\\text{comp}}(s) = \\log \\left( \\frac{p_{\\text{Rome}}(s)}{p_{\\text{Rome}}^{\\text{global}}} \\right)\\]\nwhere \\(p_{\\text{Rome}}(s)\\) is the proportion of Rome coins in spatial unit \\(s\\)."
  },
  {
    "objectID": "lrr_compositional.html#flag-rome-vs.-non-rome-at-row-level",
    "href": "lrr_compositional.html#flag-rome-vs.-non-rome-at-row-level",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "4.1 Flag Rome vs. Non-Rome at Row Level",
    "text": "4.1 Flag Rome vs. Non-Rome at Row Level\n\n\nCode\nchrr_flagged &lt;- chrr_raw %&gt;%\n  mutate(\n    is_rome = mint_id == \"rome\" | str_detect(mint_uri, \"/id/rome$\"),\n    is_rome = replace_na(is_rome, FALSE)\n  )\n\n# Global composition\nglobal_comp &lt;- chrr_flagged %&gt;%\n  summarise(\n    total_rows = n(),\n    rome_rows = sum(is_rome),\n    non_rome_rows = sum(!is_rome),\n    p_rome_global = rome_rows / total_rows\n  )\n\nkable(global_comp, \n      digits = c(0, 0, 0, 4),\n      caption = \"Global composition (row-level)\")\n\n\n\nGlobal composition (row-level)\n\n\ntotal_rows\nrome_rows\nnon_rome_rows\np_rome_global\n\n\n\n\n31951\n28177\n3774\n0.8819\n\n\n\n\n\nCode\np_global &lt;- global_comp$p_rome_global\ncat(\"\\nGlobal Rome proportion:\", round(p_global * 100, 2), \"%\\n\")\n\n\n\nGlobal Rome proportion: 88.19 %"
  },
  {
    "objectID": "lrr_compositional.html#aggregate-to-hoard-level",
    "href": "lrr_compositional.html#aggregate-to-hoard-level",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "4.2 Aggregate to Hoard Level",
    "text": "4.2 Aggregate to Hoard Level\n\n\nCode\nhoard_comp &lt;- chrr_flagged %&gt;%\n  group_by(hoard_id, hoard_lat, hoard_long) %&gt;%\n  summarise(\n    n_types = n(),\n    n_rome = sum(is_rome),\n    n_non_rome = sum(!is_rome),\n    p_rome = n_rome / n_types,\n    .groups = \"drop\"\n  ) %&gt;%\n  filter(!is.na(hoard_lat), !is.na(hoard_long))\n\ncat(\"Hoards with valid coordinates:\", nrow(hoard_comp), \"\\n\")\n\n\nHoards with valid coordinates: 466 \n\n\nCode\n# Summary of hoard-level Rome proportions\nhoard_summary &lt;- hoard_comp %&gt;%\n  summarise(\n    n_hoards = n(),\n    mean_p_rome = mean(p_rome),\n    sd_p_rome = sd(p_rome),\n    min_p_rome = min(p_rome),\n    q25_p_rome = quantile(p_rome, 0.25),\n    median_p_rome = median(p_rome),\n    q75_p_rome = quantile(p_rome, 0.75),\n    max_p_rome = max(p_rome)\n  )\n\nkable(hoard_summary, \n      digits = 3,\n      caption = \"Rome proportion within hoards: summary statistics\")\n\n\n\nRome proportion within hoards: summary statistics\n\n\n\n\n\n\n\n\n\n\n\n\nn_hoards\nmean_p_rome\nsd_p_rome\nmin_p_rome\nq25_p_rome\nmedian_p_rome\nq75_p_rome\nmax_p_rome\n\n\n\n\n466\n0.881\n0.154\n0\n0.857\n0.932\n0.97\n1"
  },
  {
    "objectID": "lrr_compositional.html#convert-to-spatial-object",
    "href": "lrr_compositional.html#convert-to-spatial-object",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "4.3 Convert to Spatial Object",
    "text": "4.3 Convert to Spatial Object\n\n\nCode\nhoard_sf &lt;- st_as_sf(\n\n  hoard_comp,\n  coords = c(\"hoard_long\", \"hoard_lat\"),\n  crs = 4326,\n  remove = FALSE\n)\n\ncat(\"Spatial object created with\", nrow(hoard_sf), \"hoards\\n\")\n\n\nSpatial object created with 466 hoards"
  },
  {
    "objectID": "lrr_compositional.html#define-study-window",
    "href": "lrr_compositional.html#define-study-window",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "5.1 Define Study Window",
    "text": "5.1 Define Study Window\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Get land polygons\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;%\n  st_union()\n\n# Filter valid geometries\nhoard_sf_valid &lt;- hoard_sf %&gt;%\n  filter(!st_is_empty(geometry))\n\n# Bounding box\nhoard_bbox &lt;- st_bbox(hoard_sf_valid)\n\nif (any(is.na(hoard_bbox))) {\n  hoard_bbox &lt;- c(xmin = -10, ymin = 30, xmax = 45, ymax = 55)\n  names(hoard_bbox) &lt;- c(\"xmin\", \"ymin\", \"xmax\", \"ymax\")\n}\n\npad &lt;- 2\n\n# Create study extent\nstudy_extent &lt;- st_polygon(list(rbind(\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad)\n))) %&gt;%\n  st_sfc(crs = 4326)\n\nstudy_land &lt;- st_intersection(land, study_extent)\n\ncat(\"Study window: [\", \n    round(hoard_bbox[\"xmin\"] - pad, 1), \",\", \n    round(hoard_bbox[\"xmax\"] + pad, 1), \"] x [\",\n    round(hoard_bbox[\"ymin\"] - pad, 1), \",\",\n    round(hoard_bbox[\"ymax\"] + pad, 1), \"]\\n\")\n\n\nStudy window: [ -11.1 , 49.1 ] x [ 33.3 , 54.9 ]\n\n\nCode\nhoard_sf &lt;- hoard_sf_valid"
  },
  {
    "objectID": "lrr_compositional.html#project-to-equal-area-crs",
    "href": "lrr_compositional.html#project-to-equal-area-crs",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "5.2 Project to Equal-Area CRS",
    "text": "5.2 Project to Equal-Area CRS\n\n\nCode\ntarget_crs &lt;- 3035  # ETRS89-extended / LAEA Europe\n\nhoard_sf_proj &lt;- st_transform(hoard_sf, target_crs)\nstudy_land_proj &lt;- st_transform(study_land, target_crs)\n\nrome_mint &lt;- st_as_sf(\n  tibble(name = \"Rome\", lon = 12.4964, lat = 41.9028),\n  coords = c(\"lon\", \"lat\"),\n  crs = 4326\n) %&gt;%\n  st_transform(target_crs)\n\ncat(\"Projected to EPSG:\", target_crs, \"\\n\")\n\n\nProjected to EPSG: 3035"
  },
  {
    "objectID": "lrr_compositional.html#construct-hexagonal-grid-100-km",
    "href": "lrr_compositional.html#construct-hexagonal-grid-100-km",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "5.3 Construct Hexagonal Grid (100 km)",
    "text": "5.3 Construct Hexagonal Grid (100 km)\n\n\nCode\nhex_size &lt;- 100000  # 100 km in meters\n\nhex_grid &lt;- st_make_grid(\n  study_land_proj,\n  cellsize = hex_size,\n  square = FALSE\n) %&gt;%\n  st_sf(hex_id = seq_along(.), geometry = .) %&gt;%\n  st_set_crs(target_crs)\n\n# Filter to land hexes\nhex_land &lt;- hex_grid %&gt;%\n  filter(lengths(st_intersects(., study_land_proj)) &gt; 0)\n\n# Centroid on land filter\nhex_centroids &lt;- st_centroid(hex_land)\non_land &lt;- lengths(st_intersects(hex_centroids, study_land_proj)) &gt; 0\nhex_land &lt;- hex_land[on_land, ]\n\ncat(\"Hex grid: \", nrow(hex_land), \"hexes on land (\", hex_size/1000, \"km)\\n\")\n\n\nHex grid:  859 hexes on land ( 100 km)"
  },
  {
    "objectID": "lrr_compositional.html#assign-hoards-to-hexes-and-aggregate",
    "href": "lrr_compositional.html#assign-hoards-to-hexes-and-aggregate",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "6.1 Assign Hoards to Hexes and Aggregate",
    "text": "6.1 Assign Hoards to Hexes and Aggregate\n\n\nCode\n# Spatial join\nhoard_hex &lt;- st_join(hoard_sf_proj, hex_land, join = st_within) %&gt;%\n  filter(!is.na(hex_id))\n\n# Aggregate composition per hex\nhex_comp &lt;- hoard_hex %&gt;%\n  st_drop_geometry() %&gt;%\n  group_by(hex_id) %&gt;%\n  summarise(\n    n_hoards = n(),\n    total_types = sum(n_types),      # Total coin-type occurrences\n    rome_types = sum(n_rome),        # Rome coin-type occurrences\n    non_rome_types = sum(n_non_rome),\n    \n    # Weighted mean Rome proportion (by hoard size)\n    p_rome_weighted = rome_types / total_types,\n    \n    # Unweighted mean (each hoard counts equally)\n    p_rome_unweighted = mean(p_rome),\n    \n    .groups = \"drop\"\n  )\n\n# Join back to hex geometry\nhex_lrr &lt;- hex_land %&gt;%\n  left_join(hex_comp, by = \"hex_id\") %&gt;%\n  mutate(\n    across(c(n_hoards, total_types, rome_types, non_rome_types), \n           ~replace_na(.x, 0)),\n    has_data = n_hoards &gt; 0\n  )\n\ncat(\"Hoards assigned to hexes:\", sum(hex_lrr$n_hoards), \"\\n\")\n\n\nHoards assigned to hexes: 404 \n\n\nCode\ncat(\"Hexes with data:\", sum(hex_lrr$has_data), \"\\n\")\n\n\nHexes with data: 141"
  },
  {
    "objectID": "lrr_compositional.html#compute-compositional-lrr",
    "href": "lrr_compositional.html#compute-compositional-lrr",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "6.2 Compute Compositional LRR",
    "text": "6.2 Compute Compositional LRR\nThree formulations, each with different assumptions:\n\n\nCode\n# Global Rome proportion for reference\np_global &lt;- sum(hex_lrr$rome_types) / sum(hex_lrr$total_types)\ncat(\"Global Rome proportion (from hex data):\", round(p_global * 100, 2), \"%\\n\\n\")\n\n\nGlobal Rome proportion (from hex data): 88.29 %\n\n\nCode\n# Smoothing constant for sparse hexes\nepsilon &lt;- 0.5\n\nhex_lrr &lt;- hex_lrr %&gt;%\n  mutate(\n    # ============================================================\n    # Method 1: Compositional LRR (row-level aggregation)\n    # Compares hex Rome proportion to global Rome proportion\n    # ============================================================\n    LRR_comp = ifelse(\n      has_data,\n      log((rome_types + epsilon) / (total_types + epsilon)) - log(p_global),\n      NA_real_\n    ),\n    \n    # ============================================================\n    # Method 2: Rome vs Non-Rome LRR (direct contrast)\n    # Positive = Rome dominates, Negative = other mints dominate\n    # ============================================================\n    LRR_contrast = ifelse(\n      has_data & non_rome_types &gt; 0,\n      log((rome_types + epsilon) / (non_rome_types + epsilon)),\n      NA_real_\n    ),\n    \n    # ============================================================\n    # Method 3: Deviation from expected (binomial framework)\n    # How many more/fewer Rome coins than expected at global rate?\n    # ============================================================\n    expected_rome = total_types * p_global,\n    rome_excess = rome_types - expected_rome,\n    rome_excess_pct = ifelse(has_data, 100 * rome_excess / expected_rome, NA_real_)\n  )"
  },
  {
    "objectID": "lrr_compositional.html#lrr-summary-statistics",
    "href": "lrr_compositional.html#lrr-summary-statistics",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "6.3 LRR Summary Statistics",
    "text": "6.3 LRR Summary Statistics\n\n\nCode\nlrr_stats &lt;- hex_lrr %&gt;%\n  filter(has_data) %&gt;%\n  st_drop_geometry() %&gt;%\n  summarise(\n    n_hexes = n(),\n    \n    # Compositional LRR\n    lrr_comp_mean = mean(LRR_comp, na.rm = TRUE),\n    lrr_comp_sd = sd(LRR_comp, na.rm = TRUE),\n    lrr_comp_min = min(LRR_comp, na.rm = TRUE),\n    lrr_comp_max = max(LRR_comp, na.rm = TRUE),\n    \n    # Rome vs Non-Rome\n    lrr_contrast_mean = mean(LRR_contrast, na.rm = TRUE),\n    lrr_contrast_sd = sd(LRR_contrast, na.rm = TRUE),\n    \n    # Rome proportion\n    p_rome_mean = mean(p_rome_weighted, na.rm = TRUE),\n    p_rome_sd = sd(p_rome_weighted, na.rm = TRUE)\n  )\n\nkable(lrr_stats, digits = 3, caption = \"LRR Summary Statistics\")\n\n\n\nLRR Summary Statistics\n\n\n\n\n\n\n\n\n\n\n\n\n\nn_hexes\nlrr_comp_mean\nlrr_comp_sd\nlrr_comp_min\nlrr_comp_max\nlrr_contrast_mean\nlrr_contrast_sd\np_rome_mean\np_rome_sd\n\n\n\n\n141\n-0.023\n0.185\n-1.311\n0.125\n1.998\n0.896\n0.871\n0.13\n\n\n\n\n\n\n\nCode\nhex_data &lt;- hex_lrr %&gt;%\n  filter(has_data) %&gt;%\n  st_drop_geometry()\n\np1 &lt;- ggplot(hex_data, aes(x = LRR_comp)) +\n  geom_histogram(bins = 25, fill = \"steelblue\", color = \"white\", alpha = 0.8) +\n  geom_vline(xintercept = 0, color = \"darkred\", linetype = \"dashed\") +\n  labs(\n    title = \"Compositional LRR Distribution\",\n    subtitle = \"LRR = 0 means hex matches global Rome proportion\",\n    x = \"LRR (compositional)\",\n    y = \"Count\"\n  )\n\np2 &lt;- ggplot(hex_data, aes(x = p_rome_weighted)) +\n  geom_histogram(bins = 25, fill = \"forestgreen\", color = \"white\", alpha = 0.8) +\n  geom_vline(xintercept = p_global, color = \"darkred\", linetype = \"dashed\") +\n  scale_x_continuous(labels = scales::percent_format()) +\n  labs(\n    title = \"Rome Proportion per Hex\",\n    subtitle = paste(\"Global =\", round(p_global * 100, 1), \"%\"),\n    x = \"Rome proportion\",\n    y = \"Count\"\n  )\n\nlibrary(patchwork)\np1 + p2"
  },
  {
    "objectID": "lrr_compositional.html#map-1-compositional-lrr",
    "href": "lrr_compositional.html#map-1-compositional-lrr",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "7.1 Map 1: Compositional LRR",
    "text": "7.1 Map 1: Compositional LRR\n\n\nCode\nhex_map &lt;- hex_lrr %&gt;%\n  filter(has_data) %&gt;%\n  st_transform(4326)\n\nland_wgs &lt;- st_transform(study_land_proj, 4326)\nrome_wgs &lt;- st_transform(rome_mint, 4326)\n\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_map,\n    aes(fill = LRR_comp),\n    color = \"grey50\",\n    linewidth = 0.2\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 5, stroke = 1.5) +\n  scale_fill_gradient2(\n    low = \"steelblue\",\n    mid = \"white\",\n    high = \"darkred\",\n    midpoint = 0,\n    name = \"LRR\",\n    limits = c(-0.5, 0.5),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  labs(\n    title = \"Compositional Log-Relative Risk\",\n    subtitle = \"Rome proportion relative to global average (88%) | Red = above average, Blue = below\",\n    caption = \"Star = Rome mint | 100 km hexagonal grid\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_compositional.html#map-2-rome-vs.-non-rome-contrast",
    "href": "lrr_compositional.html#map-2-rome-vs.-non-rome-contrast",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "7.2 Map 2: Rome vs. Non-Rome Contrast",
    "text": "7.2 Map 2: Rome vs. Non-Rome Contrast\n\n\nCode\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_map %&gt;% filter(!is.na(LRR_contrast)),\n    aes(fill = LRR_contrast),\n    color = \"grey50\",\n    linewidth = 0.2\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 5, stroke = 1.5) +\n  scale_fill_gradient2(\n    low = \"purple4\",\n    mid = \"white\",\n    high = \"darkorange\",\n    midpoint = log(1),  # Equal Rome and non-Rome\n    name = \"log(Rome/\\nNon-Rome)\",\n    limits = c(0, 4),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  labs(\n    title = \"Rome vs. Non-Rome Mint Contrast\",\n    subtitle = \"Orange = Rome dominates, Purple = other mints more prevalent\",\n    caption = \"Star = Rome mint | Hexes with non-Rome coins only\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_compositional.html#map-3-raw-rome-proportion",
    "href": "lrr_compositional.html#map-3-raw-rome-proportion",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "7.3 Map 3: Raw Rome Proportion",
    "text": "7.3 Map 3: Raw Rome Proportion\n\n\nCode\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_map,\n    aes(fill = p_rome_weighted),\n    color = \"grey50\",\n    linewidth = 0.2\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 5, stroke = 1.5) +\n  scale_fill_viridis_c(\n    name = \"Rome %\",\n    labels = scales::percent_format(),\n    option = \"plasma\",\n    limits = c(0.5, 1),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  labs(\n    title = \"Rome Mint Proportion by Hex\",\n    subtitle = \"Proportion of coin-type occurrences from Rome mint\",\n    caption = \"Star = Rome mint | 100 km hexagonal grid\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_compositional.html#map-4-sample-size-denominator",
    "href": "lrr_compositional.html#map-4-sample-size-denominator",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "7.4 Map 4: Sample Size (Denominator)",
    "text": "7.4 Map 4: Sample Size (Denominator)\n\n\nCode\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_map,\n    aes(fill = total_types),\n    color = \"grey50\",\n    linewidth = 0.2\n  ) +\n  geom_sf(data = rome_wgs, color = \"white\", shape = 8, size = 5, stroke = 1.5) +\n  scale_fill_viridis_c(\n    name = \"Coin-types\",\n    trans = \"sqrt\",\n    option = \"viridis\"\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  labs(\n    title = \"Sample Size per Hex (Total Coin-Type Occurrences)\",\n    subtitle = \"Denominator for compositional LRR | sqrt scale\",\n    caption = \"Star = Rome mint\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_compositional.html#hex-level-binomial-model",
    "href": "lrr_compositional.html#hex-level-binomial-model",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "8.1 Hex-Level Binomial Model",
    "text": "8.1 Hex-Level Binomial Model\nThe compositional LRR can be formalized as a binomial regression:\n\\[N_{\\text{Rome},h} \\sim \\text{Binomial}(N_{\\text{total},h}, \\pi_h)\\] \\[\\text{logit}(\\pi_h) = \\beta_0 + \\text{spatial effects}\\]\n\n\nCode\n# Prepare data for modeling\nmodel_data &lt;- hex_lrr %&gt;%\n  filter(has_data, total_types &gt; 0) %&gt;%\n  st_drop_geometry()\n\n# Simple binomial model (intercept only)\nbinom_fit &lt;- glm(\n\n  cbind(rome_types, non_rome_types) ~ 1,\n  family = binomial(link = \"logit\"),\n  data = model_data\n)\n\n# Extract estimates\nbeta0 &lt;- coef(binom_fit)[1]\nse_beta0 &lt;- sqrt(vcov(binom_fit)[1,1])\np_fitted &lt;- plogis(beta0)\n\ncat(\"Binomial Model Results\\n\")\n\n\nBinomial Model Results\n\n\nCode\ncat(\"======================\\n\")\n\n\n======================\n\n\nCode\ncat(\"Intercept (logit scale):\", round(beta0, 4), \"\\n\")\n\n\nIntercept (logit scale): 2.0205 \n\n\nCode\ncat(\"Standard error:\", round(se_beta0, 4), \"\\n\")\n\n\nStandard error: 0.0194 \n\n\nCode\ncat(\"Fitted global probability:\", round(p_fitted, 4), \"(\", round(p_fitted*100, 1), \"%)\\n\")\n\n\nFitted global probability: 0.8829 ( 88.3 %)\n\n\nCode\ncat(\"95% CI:\", round(plogis(beta0 - 1.96*se_beta0), 4), \"-\", \n    round(plogis(beta0 + 1.96*se_beta0), 4), \"\\n\")\n\n\n95% CI: 0.879 - 0.8868"
  },
  {
    "objectID": "lrr_compositional.html#distance-from-rome-as-covariate",
    "href": "lrr_compositional.html#distance-from-rome-as-covariate",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "8.2 Distance from Rome as Covariate",
    "text": "8.2 Distance from Rome as Covariate\n\n\nCode\n# Calculate hex centroid distance from Rome\nhex_centroids_wgs &lt;- hex_lrr %&gt;%\n  filter(has_data) %&gt;%\n  st_centroid() %&gt;%\n  st_transform(4326)\n\nrome_coords &lt;- c(12.4964, 41.9028)\n\n# Add distance\nhex_lrr_dist &lt;- hex_lrr %&gt;%\n  filter(has_data) %&gt;%\n  mutate(\n    centroid = st_centroid(geometry)\n  )\n\n# Get centroids in WGS84 for distance calculation\ncentroids_wgs &lt;- st_transform(st_centroid(hex_lrr_dist), 4326)\ncoords &lt;- st_coordinates(centroids_wgs)\n\nhex_lrr_dist &lt;- hex_lrr_dist %&gt;%\n  st_drop_geometry() %&gt;%\n  mutate(\n    cent_lon = coords[, 1],\n    cent_lat = coords[, 2],\n    dist_rome_km = sqrt((cent_lon - rome_coords[1])^2 + (cent_lat - rome_coords[2])^2) * 111\n  )\n\n# Binomial with distance covariate\nbinom_dist &lt;- glm(\n  cbind(rome_types, non_rome_types) ~ dist_rome_km,\n  family = binomial(link = \"logit\"),\n  data = hex_lrr_dist\n)\n\nsummary(binom_dist)\n\n\n\nCall:\nglm(formula = cbind(rome_types, non_rome_types) ~ dist_rome_km, \n    family = binomial(link = \"logit\"), data = hex_lrr_dist)\n\nCoefficients:\n               Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)   2.060e+00  3.275e-02  62.896   &lt;2e-16 ***\ndist_rome_km -4.213e-05  2.796e-05  -1.507    0.132    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1205.8  on 140  degrees of freedom\nResidual deviance: 1203.5  on 139  degrees of freedom\nAIC: 1711.8\n\nNumber of Fisher Scoring iterations: 4\n\n\n\n\nCode\n# Predicted probability vs distance\ndist_seq &lt;- seq(0, max(hex_lrr_dist$dist_rome_km, na.rm = TRUE), length.out = 100)\npred_df &lt;- data.frame(dist_rome_km = dist_seq)\npred_df$p_rome_pred &lt;- predict(binom_dist, newdata = pred_df, type = \"response\")\n\nggplot() +\n  geom_point(\n    data = hex_lrr_dist,\n    aes(x = dist_rome_km, y = p_rome_weighted, size = total_types),\n    alpha = 0.5,\n    color = \"steelblue\"\n  ) +\n  geom_line(\n    data = pred_df,\n    aes(x = dist_rome_km, y = p_rome_pred),\n    color = \"darkred\",\n    linewidth = 1.2\n  ) +\n  geom_hline(yintercept = p_global, linetype = \"dashed\", color = \"grey50\") +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0.5, 1)) +\n  scale_size_continuous(name = \"Sample size\", range = c(1, 10)) +\n  labs(\n    title = \"Rome Proportion vs. Distance from Rome (Hex-Level)\",\n    subtitle = \"Red line = binomial regression fit | Dashed = global average\",\n    x = \"Distance from Rome (km)\",\n    y = \"Rome proportion\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Extract coefficients\ncoefs &lt;- coef(binom_dist)\ncat(\"\\nDistance Effect Interpretation\\n\")\n\n\n\nDistance Effect Interpretation\n\n\nCode\ncat(\"==============================\\n\")\n\n\n==============================\n\n\nCode\ncat(\"Intercept:\", round(coefs[1], 4), \"\\n\")\n\n\nIntercept: 2.06 \n\n\nCode\ncat(\"Distance coefficient:\", round(coefs[2], 6), \"per km\\n\")\n\n\nDistance coefficient: -4.2e-05 per km\n\n\nCode\ncat(\"\\nAt Rome (0 km): p =\", round(plogis(coefs[1]), 3), \"\\n\")\n\n\n\nAt Rome (0 km): p = 0.887 \n\n\nCode\ncat(\"At 1000 km: p =\", round(plogis(coefs[1] + coefs[2]*1000), 3), \"\\n\")\n\n\nAt 1000 km: p = 0.883 \n\n\nCode\ncat(\"At 2000 km: p =\", round(plogis(coefs[1] + coefs[2]*2000), 3), \"\\n\")\n\n\nAt 2000 km: p = 0.878 \n\n\nCode\ncat(\"At 3000 km: p =\", round(plogis(coefs[1] + coefs[2]*3000), 3), \"\\n\")\n\n\nAt 3000 km: p = 0.874 \n\n\nCode\n# Odds ratio per 100 km\nor_100km &lt;- exp(coefs[2] * 100)\ncat(\"\\nOdds ratio per 100 km increase:\", round(or_100km, 4), \"\\n\")\n\n\n\nOdds ratio per 100 km increase: 0.9958 \n\n\nCode\ncat(\"(Values &lt; 1 indicate Rome proportion decreases with distance)\\n\")\n\n\n(Values &lt; 1 indicate Rome proportion decreases with distance)"
  },
  {
    "objectID": "lrr_compositional.html#temporal-stratification",
    "href": "lrr_compositional.html#temporal-stratification",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "11.1 Temporal Stratification",
    "text": "11.1 Temporal Stratification\nThe hex framework is now ready for temporal stratification. Next steps:\n\nBy TPQ (deposition time): Stratify hoards by terminus post quem to see how Rome’s spatial reach changed over deposition periods\nBy mint date (production time): Stratify by when coins were minted to track production reach\nHMM Integration: The hex-level composition becomes the observation for each spatial unit, with temporal sequences enabling regime detection"
  },
  {
    "objectID": "lrr_compositional.html#resolution-refinement",
    "href": "lrr_compositional.html#resolution-refinement",
    "title": "Compositional Log-Relative Risk Analysis",
    "section": "11.2 Resolution Refinement",
    "text": "11.2 Resolution Refinement\nAfter validating patterns at 100 km:\n\n50 km → regional structure\n25 km → corridor detection\n\n5 km → fine-grained patterns (if sample size permits)"
  },
  {
    "objectID": "circulation_age.html",
    "href": "circulation_age.html",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "",
    "text": "The circulation age of a coin is the time between when it was minted and when it was deposited in a hoard:\n\\[\\text{Circulation Age} = \\text{TPQ (deposition)} - \\text{Mint Date (production)}\\]\nThis metric reveals:\n\n\n\nPattern\nInterpretation\n\n\n\n\nHigh mean age\nMonetary backwater; old coins accumulate\n\n\nLow mean age\nActive trade node; fresh coins arrive regularly\n\n\nHigh age variance\nMixed circulation; coins from many eras\n\n\nLow age variance\nUniform replacement; consistent turnover\n\n\n\n\n\n\n\nWhere did old coins accumulate? (periphery vs. core)\nDid circulation velocity vary by distance from Rome?\nHow did age profiles change across monetary regimes?\nAre there regional “pools” of old coinage?"
  },
  {
    "objectID": "circulation_age.html#what-circulation-age-tells-us",
    "href": "circulation_age.html#what-circulation-age-tells-us",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "",
    "text": "The circulation age of a coin is the time between when it was minted and when it was deposited in a hoard:\n\\[\\text{Circulation Age} = \\text{TPQ (deposition)} - \\text{Mint Date (production)}\\]\nThis metric reveals:\n\n\n\nPattern\nInterpretation\n\n\n\n\nHigh mean age\nMonetary backwater; old coins accumulate\n\n\nLow mean age\nActive trade node; fresh coins arrive regularly\n\n\nHigh age variance\nMixed circulation; coins from many eras\n\n\nLow age variance\nUniform replacement; consistent turnover"
  },
  {
    "objectID": "circulation_age.html#research-questions",
    "href": "circulation_age.html#research-questions",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "",
    "text": "Where did old coins accumulate? (periphery vs. core)\nDid circulation velocity vary by distance from Rome?\nHow did age profiles change across monetary regimes?\nAre there regional “pools” of old coinage?"
  },
  {
    "objectID": "circulation_age.html#compute-circulation-age",
    "href": "circulation_age.html#compute-circulation-age",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "3.1 Compute Circulation Age",
    "text": "3.1 Compute Circulation Age\n\n\nCode\nchrr_age &lt;- chrr_raw %&gt;%\n  mutate(\n    # Parse dates\n    mint_start = as.numeric(start_year),\n    mint_end = as.numeric(end_year),\n    mint_mid = (mint_start + mint_end) / 2,\n    tpq_year = readr::parse_number(as.character(hoard_tpq)),\n    \n    # Circulation age\n    circ_age = tpq_year - mint_mid,\n    \n    # Flag Rome mint\n    is_rome = mint_id == \"rome\" | str_detect(mint_uri, \"/id/rome$\"),\n    is_rome = replace_na(is_rome, FALSE)\n  ) %&gt;%\n  filter(\n    !is.na(circ_age),\n    !is.na(hoard_lat),\n    !is.na(hoard_long),\n    circ_age &gt;= 0  # Exclude anomalies where TPQ &lt; mint date\n  )\n\ncat(\"Coin-types with valid circulation age:\", nrow(chrr_age), \"\\n\")\n\n\nCoin-types with valid circulation age: 29819 \n\n\nCode\ncat(\"Unique hoards:\", n_distinct(chrr_age$hoard_id), \"\\n\")\n\n\nUnique hoards: 463"
  },
  {
    "objectID": "circulation_age.html#circulation-age-summary",
    "href": "circulation_age.html#circulation-age-summary",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "3.2 Circulation Age Summary",
    "text": "3.2 Circulation Age Summary\n\n\nCode\nage_summary &lt;- chrr_age %&gt;%\n  summarise(\n    n = n(),\n    mean_age = mean(circ_age),\n    median_age = median(circ_age),\n    sd_age = sd(circ_age),\n    q10 = quantile(circ_age, 0.10),\n    q25 = quantile(circ_age, 0.25),\n    q75 = quantile(circ_age, 0.75),\n    q90 = quantile(circ_age, 0.90),\n    max_age = max(circ_age)\n  )\n\nkable(age_summary, digits = 1, caption = \"Overall circulation age statistics (years)\")\n\n\n\nOverall circulation age statistics (years)\n\n\nn\nmean_age\nmedian_age\nsd_age\nq10\nq25\nq75\nq90\nmax_age\n\n\n\n\n29819\n44.2\n38\n33.4\n6\n17\n64\n91\n225"
  },
  {
    "objectID": "circulation_age.html#distribution-of-circulation-ages",
    "href": "circulation_age.html#distribution-of-circulation-ages",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "3.3 Distribution of Circulation Ages",
    "text": "3.3 Distribution of Circulation Ages\n\n\nCode\np1 &lt;- ggplot(chrr_age, aes(x = circ_age)) +\n geom_histogram(binwidth = 10, fill = \"steelblue\", color = \"white\", alpha = 0.8) +\n  geom_vline(xintercept = age_summary$median_age, color = \"darkred\", \n             linetype = \"dashed\", linewidth = 1) +\n  labs(\n    title = \"Distribution of Circulation Ages\",\n    subtitle = paste(\"Median =\", round(age_summary$median_age, 0), \"years\"),\n    x = \"Circulation age (years)\",\n    y = \"Count\"\n  )\n\np2 &lt;- ggplot(chrr_age, aes(x = circ_age)) +\n  geom_histogram(binwidth = 10, fill = \"steelblue\", color = \"white\", alpha = 0.8) +\n  scale_y_log10() +\n  labs(\n    title = \"Distribution (log scale)\",\n    subtitle = \"Reveals long tail of very old coins\",\n    x = \"Circulation age (years)\",\n    y = \"Count (log)\"\n  )\n\np1 + p2"
  },
  {
    "objectID": "circulation_age.html#create-hex-grid",
    "href": "circulation_age.html#create-hex-grid",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "5.1 Create Hex Grid",
    "text": "5.1 Create Hex Grid\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Convert to sf\nhoard_sf &lt;- st_as_sf(\n  chrr_age,\n  coords = c(\"hoard_long\", \"hoard_lat\"),\n  crs = 4326,\n  remove = FALSE\n)\n\n# Study area\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;% st_union()\nhoard_bbox &lt;- st_bbox(hoard_sf)\npad &lt;- 2\n\nstudy_extent &lt;- st_polygon(list(rbind(\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad)\n))) %&gt;% st_sfc(crs = 4326)\n\nstudy_land &lt;- st_intersection(land, study_extent)\n\n# Project\ntarget_crs &lt;- 3035\nhoard_sf_proj &lt;- st_transform(hoard_sf, target_crs)\nstudy_land_proj &lt;- st_transform(study_land, target_crs)\n\nrome_coords &lt;- c(12.4964, 41.9028)\nrome_sf &lt;- st_as_sf(tibble(lon = rome_coords[1], lat = rome_coords[2]),\n                     coords = c(\"lon\", \"lat\"), crs = 4326) %&gt;%\n  st_transform(target_crs)\n\n# Hex grid\nhex_size &lt;- 100000\nhex_grid &lt;- st_make_grid(study_land_proj, cellsize = hex_size, square = FALSE) %&gt;%\n  st_sf(hex_id = seq_along(.), geometry = .) %&gt;%\n  st_set_crs(target_crs)\n\nhex_land &lt;- hex_grid %&gt;%\n  filter(lengths(st_intersects(., study_land_proj)) &gt; 0)\n\nhex_centroids &lt;- st_centroid(hex_land)\non_land &lt;- lengths(st_intersects(hex_centroids, study_land_proj)) &gt; 0\nhex_land &lt;- hex_land[on_land, ]\n\ncat(\"Hexes on land:\", nrow(hex_land), \"\\n\")\n\n\nHexes on land: 859"
  },
  {
    "objectID": "circulation_age.html#aggregate-circulation-age-by-hex",
    "href": "circulation_age.html#aggregate-circulation-age-by-hex",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "5.2 Aggregate Circulation Age by Hex",
    "text": "5.2 Aggregate Circulation Age by Hex\n\n\nCode\n# Spatial join\nhoard_hex &lt;- st_join(hoard_sf_proj, hex_land, join = st_within) %&gt;%\n  filter(!is.na(hex_id))\n\n# Aggregate by hex\nhex_age &lt;- hoard_hex %&gt;%\n  st_drop_geometry() %&gt;%\n  group_by(hex_id) %&gt;%\n  summarise(\n    n_types = n(),\n    n_hoards = n_distinct(hoard_id),\n    mean_age = mean(circ_age),\n    median_age = median(circ_age),\n    sd_age = sd(circ_age),\n    q25_age = quantile(circ_age, 0.25),\n    q75_age = quantile(circ_age, 0.75),\n    age_iqr = q75_age - q25_age,\n    pct_old = mean(circ_age &gt; 50) * 100,  # % coins &gt; 50 years old\n    pct_fresh = mean(circ_age &lt; 20) * 100,  # % coins &lt; 20 years old\n    .groups = \"drop\"\n  )\n\ncat(\"Hexes with data:\", nrow(hex_age), \"\\n\")\n\n\nHexes with data: 141"
  },
  {
    "objectID": "circulation_age.html#add-distance-from-rome",
    "href": "circulation_age.html#add-distance-from-rome",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "5.3 Add Distance from Rome",
    "text": "5.3 Add Distance from Rome\n\n\nCode\n# Hex centroids in WGS84\nhex_centroids_wgs &lt;- hex_land %&gt;%\n  st_centroid() %&gt;%\n  st_transform(4326)\n\ncent_coords &lt;- st_coordinates(hex_centroids_wgs)\n\nhex_coords &lt;- tibble(\n  hex_id = hex_land$hex_id,\n  cent_lon = cent_coords[, 1],\n  cent_lat = cent_coords[, 2]\n) %&gt;%\n  mutate(\n    dist_rome_km = sqrt((cent_lon - rome_coords[1])^2 + \n                        (cent_lat - rome_coords[2])^2) * 111\n  )\n\nhex_age &lt;- hex_age %&gt;%\n  left_join(hex_coords, by = \"hex_id\")"
  },
  {
    "objectID": "circulation_age.html#regression-age-vs-distance",
    "href": "circulation_age.html#regression-age-vs-distance",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "9.1 Regression: Age vs Distance",
    "text": "9.1 Regression: Age vs Distance\n\n\nCode\n# Linear regression\nlm_age &lt;- lm(mean_age ~ dist_rome_km, data = hex_age, weights = n_types)\n\nsummary(lm_age)\n\n\n\nCall:\nlm(formula = mean_age ~ dist_rome_km, data = hex_age, weights = n_types)\n\nWeighted Residuals:\n    Min      1Q  Median      3Q     Max \n-337.08 -104.90  -51.50   59.81  548.01 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)  41.313878   1.670319  24.734   &lt;2e-16 ***\ndist_rome_km  0.003103   0.001444   2.149   0.0334 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 158.3 on 139 degrees of freedom\nMultiple R-squared:  0.03215,   Adjusted R-squared:  0.02519 \nF-statistic: 4.618 on 1 and 139 DF,  p-value: 0.03337\n\n\nCode\n# Extract coefficients\ncoef_dist &lt;- coef(lm_age)[\"dist_rome_km\"]\ncat(\"\\nEffect: Each 100km from Rome adds\", round(coef_dist * 100, 2), \"years to mean circulation age\\n\")\n\n\n\nEffect: Each 100km from Rome adds 0.31 years to mean circulation age"
  },
  {
    "objectID": "circulation_age.html#scatterplot-age-vs-distance",
    "href": "circulation_age.html#scatterplot-age-vs-distance",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "9.2 Scatterplot: Age vs Distance",
    "text": "9.2 Scatterplot: Age vs Distance\n\n\nCode\nggplot(hex_age, aes(x = dist_rome_km, y = mean_age)) +\n  geom_point(aes(size = n_types), alpha = 0.6, color = \"steelblue\") +\n  geom_smooth(method = \"lm\", color = \"darkred\", se = TRUE) +\n  scale_size_continuous(name = \"Sample size\", range = c(1, 8)) +\n  labs(\n    title = \"Circulation Age vs Distance from Rome\",\n    subtitle = paste(\"Each 100km adds ~\", round(coef_dist * 100, 1), \"years to mean age\"),\n    x = \"Distance from Rome (km)\",\n    y = \"Mean circulation age (years)\"\n  )"
  },
  {
    "objectID": "circulation_age.html#define-regions",
    "href": "circulation_age.html#define-regions",
    "title": "Coin-Type Age Profiles: Circulation Velocity Analysis",
    "section": "12.1 Define Regions",
    "text": "12.1 Define Regions\n\n\nCode\nhex_age &lt;- hex_age %&gt;%\n  mutate(\n    # Bearing from Rome (degrees)\n    bearing = atan2(cent_lon - rome_coords[1], cent_lat - rome_coords[2]) * 180 / pi,\n    bearing = ifelse(bearing &lt; 0, bearing + 360, bearing),\n    \n    # Regional sectors\n    region = case_when(\n      bearing &gt;= 315 | bearing &lt; 45 ~ \"North (Gaul/Alps)\",\n      bearing &gt;= 45 & bearing &lt; 135 ~ \"East (Balkans/Greece)\",\n      bearing &gt;= 135 & bearing &lt; 225 ~ \"South (Africa/Sicily)\",\n      bearing &gt;= 225 & bearing &lt; 315 ~ \"West (Iberia/Sardinia)\"\n    )\n  )\n\nregion_summary &lt;- hex_age %&gt;%\n  group_by(region) %&gt;%\n  summarise(\n    n_hexes = n(),\n    mean_dist = mean(dist_rome_km),\n    mean_age = weighted.mean(mean_age, n_types),\n    mean_pct_fresh = weighted.mean(pct_fresh, n_types),\n    mean_pct_old = weighted.mean(pct_old, n_types),\n    .groups = \"drop\"\n  )\n\nkable(region_summary, digits = 1, caption = \"Circulation patterns by region\")\n\n\n\nCirculation patterns by region\n\n\n\n\n\n\n\n\n\n\nregion\nn_hexes\nmean_dist\nmean_age\nmean_pct_fresh\nmean_pct_old\n\n\n\n\nEast (Balkans/Greece)\n54\n1234.5\n48.5\n23.0\n41.6\n\n\nNorth (Gaul/Alps)\n26\n661.5\n42.3\n31.7\n34.2\n\n\nSouth (Africa/Sicily)\n3\n526.8\n25.7\n51.7\n12.8\n\n\nWest (Iberia/Sardinia)\n58\n1501.0\n40.7\n30.1\n30.6\n\n\n\n\n\n\n\nCode\nggplot(hex_age, aes(x = region, y = mean_age, fill = region)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(aes(size = n_types), alpha = 0.3, width = 0.2) +\n  scale_fill_brewer(palette = \"Set2\") +\n  scale_size_continuous(name = \"Sample size\", range = c(1, 6)) +\n  labs(\n    title = \"Circulation Age by Region\",\n    subtitle = \"Which directions from Rome had older coins?\",\n    x = NULL,\n    y = \"Mean circulation age (years)\"\n  ) +\n  theme(legend.position = \"right\")"
  },
  {
    "objectID": "lrr_temporal.html",
    "href": "lrr_temporal.html",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "",
    "text": "The compositional LRR analysis revealed meaningful spatial variation in Rome’s monetary penetration, but the aggregate view collapses ~500 years of Roman history into a single surface. Temporal stratification asks: How did the geography of Rome-mint penetration change over time?\nWe use Terminus Post Quem (TPQ) — the deposition date — rather than mint date because:\n\nHoards are discrete events — each deposition is a single observation in space-time\nDeposition reflects system states — hoarding behavior responds to crises, uncertainty, and monetary conditions\nAligns with HMM framework — we need sequential observations of “did hoards get deposited in region r during period t?”\n\n\n\n\nThe following periods are defined based on major transitions in Roman political economy:\n\n\n\n\n\n\n\n\n\nPeriod\nTPQ Range\nLabel\nHistorical Context\n\n\n\n\n1\nbefore 150 BCE\nEarly Republic\nPre-Gracchan era; limited monetization outside Italy; aftermath of Punic Wars\n\n\n2\n150–100 BCE\nLate Republic I\nGracchan reforms; provincial expansion; Italian allied coinage still circulating\n\n\n3\n100–50 BCE\nLate Republic II\nSocial War aftermath; Sullan era; rise of military dynasts; civil wars begin\n\n\n4\n50 BCE – 14 CE\nTriumviral/Augustan\nCaesar to Augustus; end of Republic; monetary consolidation under Principate\n\n\n5\nafter 14 CE\nEarly Imperial\nJulio-Claudian dynasty; if data permits\n\n\n\nThese bins balance historical coherence with sufficient sample size per period."
  },
  {
    "objectID": "lrr_temporal.html#why-stratify-by-tpq",
    "href": "lrr_temporal.html#why-stratify-by-tpq",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "",
    "text": "The compositional LRR analysis revealed meaningful spatial variation in Rome’s monetary penetration, but the aggregate view collapses ~500 years of Roman history into a single surface. Temporal stratification asks: How did the geography of Rome-mint penetration change over time?\nWe use Terminus Post Quem (TPQ) — the deposition date — rather than mint date because:\n\nHoards are discrete events — each deposition is a single observation in space-time\nDeposition reflects system states — hoarding behavior responds to crises, uncertainty, and monetary conditions\nAligns with HMM framework — we need sequential observations of “did hoards get deposited in region r during period t?”"
  },
  {
    "objectID": "lrr_temporal.html#tpq-period-definitions",
    "href": "lrr_temporal.html#tpq-period-definitions",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "",
    "text": "The following periods are defined based on major transitions in Roman political economy:\n\n\n\n\n\n\n\n\n\nPeriod\nTPQ Range\nLabel\nHistorical Context\n\n\n\n\n1\nbefore 150 BCE\nEarly Republic\nPre-Gracchan era; limited monetization outside Italy; aftermath of Punic Wars\n\n\n2\n150–100 BCE\nLate Republic I\nGracchan reforms; provincial expansion; Italian allied coinage still circulating\n\n\n3\n100–50 BCE\nLate Republic II\nSocial War aftermath; Sullan era; rise of military dynasts; civil wars begin\n\n\n4\n50 BCE – 14 CE\nTriumviral/Augustan\nCaesar to Augustus; end of Republic; monetary consolidation under Principate\n\n\n5\nafter 14 CE\nEarly Imperial\nJulio-Claudian dynasty; if data permits\n\n\n\nThese bins balance historical coherence with sufficient sample size per period."
  },
  {
    "objectID": "lrr_temporal.html#parse-tpq-and-create-period-bins",
    "href": "lrr_temporal.html#parse-tpq-and-create-period-bins",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "4.1 Parse TPQ and Create Period Bins",
    "text": "4.1 Parse TPQ and Create Period Bins\n\n\nCode\n# Flag Rome vs non-Rome\nchrr_flagged &lt;- chrr_raw %&gt;%\n  mutate(\n    is_rome = mint_id == \"rome\" | str_detect(mint_uri, \"/id/rome$\"),\n    is_rome = replace_na(is_rome, FALSE)\n  )\n\n# Parse TPQ to numeric year\nchrr_temporal &lt;- chrr_flagged %&gt;%\n  mutate(\n    tpq_raw = as.character(hoard_tpq),\n    tpq_year = readr::parse_number(tpq_raw)\n  )\n\n# Check TPQ coverage\ntpq_coverage &lt;- chrr_temporal %&gt;%\n  summarise(\n    total_rows = n(),\n    rows_with_tpq = sum(!is.na(tpq_year)),\n    pct_with_tpq = round(100 * rows_with_tpq / total_rows, 1),\n    tpq_min = min(tpq_year, na.rm = TRUE),\n    tpq_max = max(tpq_year, na.rm = TRUE)\n  )\n\nkable(tpq_coverage, caption = \"TPQ coverage in dataset\")\n\n\n\nTPQ coverage in dataset\n\n\ntotal_rows\nrows_with_tpq\npct_with_tpq\ntpq_min\ntpq_max\n\n\n\n\n31951\n31836\n99.6\n-195\n14"
  },
  {
    "objectID": "lrr_temporal.html#define-period-bins",
    "href": "lrr_temporal.html#define-period-bins",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "4.2 Define Period Bins",
    "text": "4.2 Define Period Bins\n\n\nCode\n# Period definitions\nperiod_breaks &lt;- c(-Inf, -150, -100, -50, 14, Inf)\nperiod_labels &lt;- c(\n  \"1: Early Republic (pre-150 BCE)\",\n  \"2: Late Republic I (150-100 BCE)\",\n  \"3: Late Republic II (100-50 BCE)\",\n  \"4: Triumviral/Augustan (50 BCE-14 CE)\",\n  \"5: Early Imperial (post-14 CE)\"\n)\n\n# Assign periods\nchrr_temporal &lt;- chrr_temporal %&gt;%\n  mutate(\n    tpq_period = cut(\n      tpq_year,\n      breaks = period_breaks,\n      labels = period_labels,\n      right = TRUE\n    ),\n    tpq_period_num = as.integer(tpq_period)\n  )\n\n# Period summary\nperiod_summary &lt;- chrr_temporal %&gt;%\n  filter(!is.na(tpq_period)) %&gt;%\n  group_by(tpq_period) %&gt;%\n  summarise(\n    n_rows = n(),\n    n_hoards = n_distinct(hoard_id),\n    n_rome = sum(is_rome),\n    n_non_rome = sum(!is_rome),\n    pct_rome = round(100 * n_rome / n_rows, 1),\n    .groups = \"drop\"\n  )\n\nkable(period_summary, \n      col.names = c(\"Period\", \"Rows\", \"Hoards\", \"Rome\", \"Non-Rome\", \"Rome %\"),\n      caption = \"Data distribution by TPQ period\")\n\n\n\nData distribution by TPQ period\n\n\n\n\n\n\n\n\n\n\nPeriod\nRows\nHoards\nRome\nNon-Rome\nRome %\n\n\n\n\n1: Early Republic (pre-150 BCE)\n185\n11\n106\n79\n57.3\n\n\n2: Late Republic I (150-100 BCE)\n4476\n91\n4229\n247\n94.5\n\n\n3: Late Republic II (100-50 BCE)\n10237\n173\n9670\n567\n94.5\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n16938\n215\n14062\n2876\n83.0"
  },
  {
    "objectID": "lrr_temporal.html#visualize-tpq-distribution",
    "href": "lrr_temporal.html#visualize-tpq-distribution",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "4.3 Visualize TPQ Distribution",
    "text": "4.3 Visualize TPQ Distribution\n\n\nCode\n# Hoard-level TPQ for cleaner visualization\nhoard_tpq &lt;- chrr_temporal %&gt;%\n  filter(!is.na(tpq_year)) %&gt;%\n  distinct(hoard_id, tpq_year, tpq_period)\n\nggplot(hoard_tpq, aes(x = tpq_year, fill = tpq_period)) +\n\ngeom_histogram(binwidth = 10, color = \"white\", alpha = 0.8) +\n  geom_vline(xintercept = c(-150, -100, -50, 14), \n             linetype = \"dashed\", color = \"grey30\") +\n  scale_fill_viridis_d(name = \"Period\", option = \"plasma\") +\n  labs(\n    title = \"Hoard Deposition Chronology (TPQ)\",\n    subtitle = \"Vertical lines mark period boundaries\",\n    x = \"TPQ (year)\",\n    y = \"Number of hoards\"\n  ) +\n  theme(legend.position = \"bottom\")"
  },
  {
    "objectID": "lrr_temporal.html#convert-to-spatial-object",
    "href": "lrr_temporal.html#convert-to-spatial-object",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "5.1 Convert to Spatial Object",
    "text": "5.1 Convert to Spatial Object\n\n\nCode\nhoard_sf &lt;- st_as_sf(\n  hoard_comp,\n  coords = c(\"hoard_long\", \"hoard_lat\"),\n  crs = 4326,\n  remove = FALSE\n)"
  },
  {
    "objectID": "lrr_temporal.html#study-window-and-projection",
    "href": "lrr_temporal.html#study-window-and-projection",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "6.1 Study Window and Projection",
    "text": "6.1 Study Window and Projection\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Land polygons\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;%\n  st_union()\n\n# Valid geometries only\nhoard_sf_valid &lt;- hoard_sf %&gt;%\n  filter(!st_is_empty(geometry))\n\n# Bounding box\nhoard_bbox &lt;- st_bbox(hoard_sf_valid)\n\nif (any(is.na(hoard_bbox))) {\n  hoard_bbox &lt;- c(xmin = -10, ymin = 30, xmax = 45, ymax = 55)\n  names(hoard_bbox) &lt;- c(\"xmin\", \"ymin\", \"xmax\", \"ymax\")\n}\n\npad &lt;- 2\n\n# Study extent\nstudy_extent &lt;- st_polygon(list(rbind(\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad)\n))) %&gt;%\n  st_sfc(crs = 4326)\n\nstudy_land &lt;- st_intersection(land, study_extent)\n\n# Project\ntarget_crs &lt;- 3035\nhoard_sf_proj &lt;- st_transform(hoard_sf_valid, target_crs)\nstudy_land_proj &lt;- st_transform(study_land, target_crs)\n\nrome_mint &lt;- st_as_sf(\n  tibble(name = \"Rome\", lon = 12.4964, lat = 41.9028),\n  coords = c(\"lon\", \"lat\"),\n  crs = 4326\n) %&gt;%\n  st_transform(target_crs)\n\nhoard_sf &lt;- hoard_sf_valid"
  },
  {
    "objectID": "lrr_temporal.html#hexagonal-grid-100-km",
    "href": "lrr_temporal.html#hexagonal-grid-100-km",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "6.2 Hexagonal Grid (100 km)",
    "text": "6.2 Hexagonal Grid (100 km)\n\n\nCode\nhex_size &lt;- 100000  # 100 km\n\nhex_grid &lt;- st_make_grid(\n  study_land_proj,\n  cellsize = hex_size,\n  square = FALSE\n) %&gt;%\n  st_sf(hex_id = seq_along(.), geometry = .) %&gt;%\n  st_set_crs(target_crs)\n\n# Land filter\nhex_land &lt;- hex_grid %&gt;%\n  filter(lengths(st_intersects(., study_land_proj)) &gt; 0)\n\nhex_centroids &lt;- st_centroid(hex_land)\non_land &lt;- lengths(st_intersects(hex_centroids, study_land_proj)) &gt; 0\nhex_land &lt;- hex_land[on_land, ]\n\ncat(\"Hexes on land:\", nrow(hex_land), \"\\n\")\n\n\nHexes on land: 859"
  },
  {
    "objectID": "lrr_temporal.html#assign-hoards-to-hexes",
    "href": "lrr_temporal.html#assign-hoards-to-hexes",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "7.1 Assign Hoards to Hexes",
    "text": "7.1 Assign Hoards to Hexes\n\n\nCode\nhoard_hex &lt;- st_join(hoard_sf_proj, hex_land, join = st_within) %&gt;%\n  filter(!is.na(hex_id))\n\ncat(\"Hoards assigned to hexes:\", nrow(hoard_hex), \"\\n\")\n\n\nHoards assigned to hexes: 401"
  },
  {
    "objectID": "lrr_temporal.html#compute-lrr-by-period-and-hex",
    "href": "lrr_temporal.html#compute-lrr-by-period-and-hex",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "7.2 Compute LRR by Period and Hex",
    "text": "7.2 Compute LRR by Period and Hex\n\n\nCode\n# Global Rome proportion (all periods combined)\np_global &lt;- sum(hoard_hex$n_rome) / sum(hoard_hex$n_types)\ncat(\"Global Rome proportion:\", round(p_global * 100, 2), \"%\\n\\n\")\n\n\nGlobal Rome proportion: 88.26 %\n\n\nCode\n# Aggregate by hex AND period\nhex_period_comp &lt;- hoard_hex %&gt;%\n  st_drop_geometry() %&gt;%\n  group_by(hex_id, tpq_period, tpq_period_num) %&gt;%\n  summarise(\n    n_hoards = n(),\n    total_types = sum(n_types),\n    rome_types = sum(n_rome),\n    non_rome_types = sum(n_non_rome),\n    p_rome = rome_types / total_types,\n    .groups = \"drop\"\n  )\n\n# Period-specific global proportions\nperiod_globals &lt;- hex_period_comp %&gt;%\n  group_by(tpq_period, tpq_period_num) %&gt;%\n  summarise(\n    p_rome_period = sum(rome_types) / sum(total_types),\n    .groups = \"drop\"\n  )\n\nkable(period_globals, \n      col.names = c(\"Period\", \"Period Num\", \"Rome % (period)\"),\n      digits = 3,\n      caption = \"Global Rome proportion by period\")\n\n\n\nGlobal Rome proportion by period\n\n\nPeriod\nPeriod Num\nRome % (period)\n\n\n\n\n1: Early Republic (pre-150 BCE)\n1\n0.590\n\n\n2: Late Republic I (150-100 BCE)\n2\n0.942\n\n\n3: Late Republic II (100-50 BCE)\n3\n0.945\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n4\n0.835\n\n\n\n\n\nCode\n# Join period globals and compute LRR\nepsilon &lt;- 0.5\n\nhex_period_lrr &lt;- hex_period_comp %&gt;%\n  left_join(period_globals, by = c(\"tpq_period\", \"tpq_period_num\")) %&gt;%\n  mutate(\n    # LRR relative to period-specific global\n    LRR_period = log((rome_types + epsilon) / (total_types + epsilon)) - log(p_rome_period),\n    \n    # LRR relative to overall global\n    LRR_global = log((rome_types + epsilon) / (total_types + epsilon)) - log(p_global),\n    \n    # Rome vs non-Rome contrast\n    LRR_contrast = ifelse(\n      non_rome_types &gt; 0,\n      log((rome_types + epsilon) / (non_rome_types + epsilon)),\n      NA_real_\n    )\n  )"
  },
  {
    "objectID": "lrr_temporal.html#summary-statistics-by-period",
    "href": "lrr_temporal.html#summary-statistics-by-period",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "7.3 Summary Statistics by Period",
    "text": "7.3 Summary Statistics by Period\n\n\nCode\nlrr_period_stats &lt;- hex_period_lrr %&gt;%\n  group_by(tpq_period) %&gt;%\n  summarise(\n    n_hexes = n(),\n    total_hoards = sum(n_hoards),\n    lrr_mean = round(mean(LRR_period, na.rm = TRUE), 3),\n    lrr_sd = round(sd(LRR_period, na.rm = TRUE), 3),\n    p_rome_mean = round(mean(p_rome, na.rm = TRUE), 3),\n    .groups = \"drop\"\n  )\n\nkable(lrr_period_stats,\n      col.names = c(\"Period\", \"Hexes\", \"Hoards\", \"LRR Mean\", \"LRR SD\", \"Rome % Mean\"),\n      caption = \"LRR summary by period\")\n\n\n\nLRR summary by period\n\n\n\n\n\n\n\n\n\n\nPeriod\nHexes\nHoards\nLRR Mean\nLRR SD\nRome % Mean\n\n\n\n\n1: Early Republic (pre-150 BCE)\n10\n10\n0.121\n0.272\n0.681\n\n\n2: Late Republic I (150-100 BCE)\n42\n69\n0.008\n0.041\n0.950\n\n\n3: Late Republic II (100-50 BCE)\n74\n142\n0.006\n0.038\n0.951\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n91\n180\n-0.045\n0.210\n0.807"
  },
  {
    "objectID": "lrr_temporal.html#prepare-map-data",
    "href": "lrr_temporal.html#prepare-map-data",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "8.1 Prepare Map Data",
    "text": "8.1 Prepare Map Data\n\n\nCode\n# Join LRR back to hex geometry\nhex_period_sf &lt;- hex_land %&gt;%\n  inner_join(hex_period_lrr, by = \"hex_id\") %&gt;%\n  st_transform(4326)\n\n# Reference layers in WGS84\nland_wgs &lt;- st_transform(study_land_proj, 4326)\nrome_wgs &lt;- st_transform(rome_mint, 4326)\n\n# Get periods present in data\nperiods_present &lt;- sort(unique(hex_period_sf$tpq_period_num))\ncat(\"Periods with data:\", paste(periods_present, collapse = \", \"), \"\\n\")\n\n\nPeriods with data: 1, 2, 3, 4"
  },
  {
    "objectID": "lrr_temporal.html#faceted-lrr-map-all-periods",
    "href": "lrr_temporal.html#faceted-lrr-map-all-periods",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "8.2 Faceted LRR Map (All Periods)",
    "text": "8.2 Faceted LRR Map (All Periods)\n\n\nCode\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_period_sf,\n    aes(fill = LRR_period),\n    color = \"grey50\",\n    linewidth = 0.15\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 3, stroke = 1) +\n  scale_fill_gradient2(\n    low = \"steelblue\",\n    mid = \"white\",\n    high = \"darkred\",\n    midpoint = 0,\n    name = \"LRR\",\n    limits = c(-0.6, 0.6),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  facet_wrap(~tpq_period, ncol = 3) +\n  labs(\n    title = \"Compositional LRR by Deposition Period\",\n    subtitle = \"Red = above period average | Blue = below period average | Star = Rome mint\",\n    caption = \"LRR computed relative to period-specific global proportion\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    strip.text = element_text(size = 9, face = \"bold\"),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_temporal.html#individual-period-maps",
    "href": "lrr_temporal.html#individual-period-maps",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "8.3 Individual Period Maps",
    "text": "8.3 Individual Period Maps\n\n\nCode\n# Create individual maps for each period\nperiod_maps &lt;- map(sort(unique(hex_period_sf$tpq_period)), function(p) {\n  \n  period_data &lt;- hex_period_sf %&gt;% filter(tpq_period == p)\n  n_hoards &lt;- sum(period_data$n_hoards)\n  n_hexes &lt;- nrow(period_data)\n  \n  ggplot() +\n    geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n    geom_sf(\n      data = period_data,\n      aes(fill = LRR_period),\n      color = \"grey50\",\n      linewidth = 0.2\n    ) +\n    geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 4, stroke = 1.2) +\n    scale_fill_gradient2(\n      low = \"steelblue\",\n      mid = \"white\", \n      high = \"darkred\",\n      midpoint = 0,\n      name = \"LRR\",\n      limits = c(-0.6, 0.6),\n      oob = scales::squish\n    ) +\n    coord_sf(\n      xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n      ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n    ) +\n    labs(\n      title = p,\n      subtitle = paste(n_hoards, \"hoards in\", n_hexes, \"hexes\")\n    ) +\n    theme_minimal() +\n    theme(\n      axis.text = element_blank(),\n      axis.title = element_blank(),\n      legend.position = \"none\",\n      plot.title = element_text(size = 11, face = \"bold\")\n    )\n})\n\n# Combine with shared legend\nwrap_plots(period_maps, ncol = 2) +\n  plot_annotation(\n    title = \"Rome Mint Penetration by Deposition Period\",\n    subtitle = \"LRR relative to period-specific global proportion\",\n    theme = theme(plot.title = element_text(size = 14, face = \"bold\"))\n  )"
  },
  {
    "objectID": "lrr_temporal.html#rome-proportion-maps-by-period",
    "href": "lrr_temporal.html#rome-proportion-maps-by-period",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "8.4 Rome Proportion Maps by Period",
    "text": "8.4 Rome Proportion Maps by Period\n\n\nCode\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_period_sf,\n    aes(fill = p_rome),\n    color = \"grey50\",\n    linewidth = 0.15\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 3, stroke = 1) +\n  scale_fill_viridis_c(\n    name = \"Rome %\",\n    labels = scales::percent_format(),\n    option = \"plasma\",\n    limits = c(0.5, 1),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  facet_wrap(~tpq_period, ncol = 3) +\n  labs(\n    title = \"Rome Mint Proportion by Deposition Period\",\n    subtitle = \"Raw proportion of coin-types from Rome mint\",\n    caption = \"Star = Rome mint location\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    strip.text = element_text(size = 9, face = \"bold\"),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_temporal.html#rome-proportion-over-time",
    "href": "lrr_temporal.html#rome-proportion-over-time",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "9.1 Rome Proportion Over Time",
    "text": "9.1 Rome Proportion Over Time\n\n\nCode\n# Period-level summary with confidence intervals\nperiod_trend &lt;- hex_period_lrr %&gt;%\n  group_by(tpq_period, tpq_period_num) %&gt;%\n  summarise(\n    n_hexes = n(),\n    total_types = sum(total_types),\n    rome_types = sum(rome_types),\n    p_rome = rome_types / total_types,\n    .groups = \"drop\"\n  ) %&gt;%\n  mutate(\n    # Binomial SE\n    se_p = sqrt(p_rome * (1 - p_rome) / total_types),\n    ci_lower = p_rome - 1.96 * se_p,\n    ci_upper = p_rome + 1.96 * se_p\n  )\n\nggplot(period_trend, aes(x = tpq_period_num, y = p_rome)) +\n  geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.3, fill = \"steelblue\") +\n  geom_line(linewidth = 1.2, color = \"steelblue\") +\n  geom_point(size = 4, color = \"steelblue\") +\n  geom_hline(yintercept = p_global, linetype = \"dashed\", color = \"grey50\") +\n  scale_x_continuous(\n    breaks = period_trend$tpq_period_num,\n    labels = c(\"Early\\nRepublic\", \"Late Rep I\\n150-100\", \"Late Rep II\\n100-50\", \n               \"Triumviral/\\nAugustan\", \"Early\\nImperial\")[1:nrow(period_trend)]\n  ) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0.7, 1)) +\n  labs(\n    title = \"Rome Mint Proportion Over Time\",\n    subtitle = \"Aggregate proportion across all hexes | Shaded = 95% CI\",\n    x = \"Period\",\n    y = \"Rome proportion\",\n    caption = \"Dashed line = overall global proportion\"\n  )"
  },
  {
    "objectID": "lrr_temporal.html#spatial-spread-over-time",
    "href": "lrr_temporal.html#spatial-spread-over-time",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "9.2 Spatial Spread Over Time",
    "text": "9.2 Spatial Spread Over Time\n\n\nCode\n# Count hexes with data per period\nspatial_extent &lt;- hex_period_lrr %&gt;%\n  group_by(tpq_period, tpq_period_num) %&gt;%\n  summarise(\n    n_hexes = n_distinct(hex_id),\n    n_hoards = sum(n_hoards),\n    .groups = \"drop\"\n  )\n\nggplot(spatial_extent, aes(x = tpq_period_num)) +\n  geom_col(aes(y = n_hexes, fill = \"Hexes with data\"), alpha = 0.7, width = 0.6) +\n  geom_line(aes(y = n_hoards / 5, color = \"Hoards (scaled)\"), linewidth = 1.2) +\n  geom_point(aes(y = n_hoards / 5, color = \"Hoards (scaled)\"), size = 3) +\n  scale_x_continuous(\n    breaks = spatial_extent$tpq_period_num,\n    labels = c(\"Early\\nRepublic\", \"Late Rep I\", \"Late Rep II\", \n               \"Triumviral/\\nAugustan\", \"Early\\nImperial\")[1:nrow(spatial_extent)]\n  ) +\n  scale_y_continuous(\n    name = \"Number of hexes\",\n    sec.axis = sec_axis(~. * 5, name = \"Number of hoards\")\n  ) +\n  scale_fill_manual(values = c(\"Hexes with data\" = \"steelblue\"), name = NULL) +\n  scale_color_manual(values = c(\"Hoards (scaled)\" = \"darkred\"), name = NULL) +\n  labs(\n    title = \"Spatial Extent of Hoard Deposition Over Time\",\n    subtitle = \"Geographic spread of Rome-mint containing hoards\",\n    x = \"Period\"\n  ) +\n  theme(legend.position = \"bottom\")"
  },
  {
    "objectID": "lrr_temporal.html#binomial-regression-by-period",
    "href": "lrr_temporal.html#binomial-regression-by-period",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "10.1 Binomial Regression by Period",
    "text": "10.1 Binomial Regression by Period\n\n\nCode\n# Add hex centroid coordinates\nhex_centroids_wgs &lt;- hex_land %&gt;%\n  st_centroid() %&gt;%\n  st_transform(4326)\n\ncent_coords &lt;- st_coordinates(hex_centroids_wgs)\n\nhex_coords &lt;- tibble(\n  hex_id = hex_land$hex_id,\n  cent_lon = cent_coords[, 1],\n  cent_lat = cent_coords[, 2]\n)\n\nrome_coords &lt;- c(12.4964, 41.9028)\n\nhex_coords &lt;- hex_coords %&gt;%\n  mutate(\n    dist_rome_km = sqrt((cent_lon - rome_coords[1])^2 + (cent_lat - rome_coords[2])^2) * 111\n  )\n\n# Join distance to period data\nhex_period_dist &lt;- hex_period_lrr %&gt;%\n  left_join(hex_coords, by = \"hex_id\")\n\n# Fit binomial model by period\ndistance_models &lt;- hex_period_dist %&gt;%\n  filter(!is.na(dist_rome_km)) %&gt;%\n  group_by(tpq_period, tpq_period_num) %&gt;%\n  nest() %&gt;%\n  mutate(\n    model = map(data, ~glm(\n      cbind(rome_types, non_rome_types) ~ dist_rome_km,\n      family = binomial(link = \"logit\"),\n      data = .x\n    )),\n    tidy = map(model, broom::tidy)\n  ) %&gt;%\n  unnest(tidy) %&gt;%\n  filter(term == \"dist_rome_km\") %&gt;%\n  select(tpq_period, tpq_period_num, estimate, std.error, p.value) %&gt;%\n  mutate(\n    or_100km = exp(estimate * 100),\n    sig = ifelse(p.value &lt; 0.05, \"*\", \"\")\n  )\n\nkable(distance_models,\n      col.names = c(\"Period\", \"Num\", \"Coefficient\", \"SE\", \"p-value\", \"OR per 100km\", \"Sig\"),\n      digits = c(0, 0, 6, 6, 4, 4, 0),\n      caption = \"Distance effect on Rome proportion by period (* = p &lt; 0.05)\")\n\n\n\nDistance effect on Rome proportion by period (* = p &lt; 0.05)\n\n\n\n\n\n\n\n\n\n\n\nPeriod\nNum\nCoefficient\nSE\np-value\nOR per 100km\nSig\n\n\n\n\n2: Late Republic I (150-100 BCE)\n2\n0.000425\n0.000091\n0.0000\n1.0435\n*\n\n\n3: Late Republic II (100-50 BCE)\n3\n0.000047\n0.000074\n0.5233\n1.0048\n\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n4\n-0.000090\n0.000035\n0.0100\n0.9910\n*\n\n\n1: Early Republic (pre-150 BCE)\n1\n0.000072\n0.000272\n0.7910\n1.0072"
  },
  {
    "objectID": "lrr_temporal.html#distance-effect-visualization",
    "href": "lrr_temporal.html#distance-effect-visualization",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "10.2 Distance Effect Visualization",
    "text": "10.2 Distance Effect Visualization\n\n\nCode\n# Create predicted curves for each period\npred_curves &lt;- hex_period_dist %&gt;%\n  filter(!is.na(dist_rome_km)) %&gt;%\n  group_by(tpq_period, tpq_period_num) %&gt;%\n  nest() %&gt;%\n  mutate(\n    model = map(data, ~glm(\n      cbind(rome_types, non_rome_types) ~ dist_rome_km,\n      family = binomial(link = \"logit\"),\n      data = .x\n    )),\n    pred_data = map(data, ~tibble(\n      dist_rome_km = seq(0, max(.x$dist_rome_km, na.rm = TRUE), length.out = 100)\n    )),\n    predictions = map2(model, pred_data, ~mutate(.y, \n      p_rome_pred = predict(.x, newdata = .y, type = \"response\")\n    ))\n  ) %&gt;%\n  select(tpq_period, tpq_period_num, predictions) %&gt;%\n  unnest(predictions)\n\n# Plot\nggplot() +\n  geom_point(\n    data = hex_period_dist,\n    aes(x = dist_rome_km, y = p_rome, size = total_types),\n    alpha = 0.4,\n    color = \"steelblue\"\n  ) +\n  geom_line(\n    data = pred_curves,\n    aes(x = dist_rome_km, y = p_rome_pred),\n    color = \"darkred\",\n    linewidth = 1\n  ) +\n  facet_wrap(~tpq_period, ncol = 3) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0.4, 1)) +\n  scale_size_continuous(name = \"Sample size\", range = c(1, 8)) +\n  labs(\n    title = \"Rome Proportion vs. Distance by Period\",\n    subtitle = \"Red line = binomial regression fit\",\n    x = \"Distance from Rome (km)\",\n    y = \"Rome proportion\"\n  ) +\n  theme(\n    legend.position = \"bottom\",\n    strip.text = element_text(size = 9, face = \"bold\")\n  )"
  },
  {
    "objectID": "lrr_temporal.html#interpretation-notes",
    "href": "lrr_temporal.html#interpretation-notes",
    "title": "Temporal Stratification of Compositional LRR",
    "section": "12.1 Interpretation Notes",
    "text": "12.1 Interpretation Notes\nSpatial variation (LRR SD): Higher values indicate more geographic heterogeneity in Rome’s penetration during that period.\nDistance effect (OR per 100km): Values below 1 indicate Rome proportion decreases with distance; closer to 1 means distance matters less.\nChanges over time: Compare whether Rome’s monetary reach became more uniform (lower SD, OR→1) or more differentiated (higher SD, OR&lt;1) across periods."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "John Glendenning",
    "section": "",
    "text": "I am a masters student studying geographical information systems.\n\nContact\njmg220005@utdallas.edu"
  },
  {
    "objectID": "directional_flow.html",
    "href": "directional_flow.html",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "",
    "text": "Previous analyses tested whether Rome’s monetary penetration declined with distance. But distance alone assumes isotropic diffusion—equal spread in all directions.\nReal monetary circulation likely followed:\n\nTrade routes (coastal, river valleys)\nMilitary roads (Via Appia, Via Egnatia)\nGeographic barriers (Alps, sea crossings)\n\n\n\n\n\nWas Rome’s reach isotropic? Or did coins flow preferentially in certain directions?\nWhich directions showed strongest Rome penetration?\nDid directional patterns change across monetary regimes?\nCan we identify likely circulation corridors?\n\n\n\n\n\nPolar decomposition: Convert hex positions to (distance, bearing) from Rome\nDirectional regression: Test Rome % ~ distance * direction interactions\nSector analysis: Compare Rome penetration across geographic sectors\nRegime comparison: Test whether anisotropy differs pre/post transition"
  },
  {
    "objectID": "directional_flow.html#beyond-radial-distance",
    "href": "directional_flow.html#beyond-radial-distance",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "",
    "text": "Previous analyses tested whether Rome’s monetary penetration declined with distance. But distance alone assumes isotropic diffusion—equal spread in all directions.\nReal monetary circulation likely followed:\n\nTrade routes (coastal, river valleys)\nMilitary roads (Via Appia, Via Egnatia)\nGeographic barriers (Alps, sea crossings)"
  },
  {
    "objectID": "directional_flow.html#research-questions",
    "href": "directional_flow.html#research-questions",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "",
    "text": "Was Rome’s reach isotropic? Or did coins flow preferentially in certain directions?\nWhich directions showed strongest Rome penetration?\nDid directional patterns change across monetary regimes?\nCan we identify likely circulation corridors?"
  },
  {
    "objectID": "directional_flow.html#analytical-approach",
    "href": "directional_flow.html#analytical-approach",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "",
    "text": "Polar decomposition: Convert hex positions to (distance, bearing) from Rome\nDirectional regression: Test Rome % ~ distance * direction interactions\nSector analysis: Compare Rome penetration across geographic sectors\nRegime comparison: Test whether anisotropy differs pre/post transition"
  },
  {
    "objectID": "directional_flow.html#add-regime-assignment",
    "href": "directional_flow.html#add-regime-assignment",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "4.1 Add Regime Assignment",
    "text": "4.1 Add Regime Assignment\n\n\nCode\nperiod_breaks &lt;- c(-Inf, -150, -100, -50, 14, Inf)\n\nhoard_polar &lt;- hoard_polar %&gt;%\n  mutate(\n    tpq_period = cut(tpq_year, breaks = period_breaks,\n                     labels = c(\"1: Early Republic\", \"2: Late Republic I\",\n                               \"3: Late Republic II\", \"4: Triumviral/Augustan\",\n                               \"5: Early Imperial\"),\n                     right = TRUE),\n    regime = case_when(\n      tpq_year &lt; -100 ~ \"Pre-transition\",\n      tpq_year &gt;= -100 & tpq_year &lt; -50 ~ \"Transition\",\n      tpq_year &gt;= -50 ~ \"Post-transition\"\n    )\n  ) %&gt;%\n  filter(!is.na(tpq_period))"
  },
  {
    "objectID": "directional_flow.html#polar-plot-hoards-by-bearing-and-distance",
    "href": "directional_flow.html#polar-plot-hoards-by-bearing-and-distance",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "5.1 Polar Plot: Hoards by Bearing and Distance",
    "text": "5.1 Polar Plot: Hoards by Bearing and Distance\n\n\nCode\nggplot(hoard_polar, aes(x = bearing_deg, y = dist_km)) +\n  geom_point(aes(color = p_rome, size = n_types), alpha = 0.6) +\n  scale_color_viridis_c(name = \"Rome %\", labels = scales::percent_format(),\n                        option = \"plasma\") +\n  scale_size_continuous(name = \"N types\", range = c(1, 6)) +\n  coord_polar(theta = \"x\", start = -pi/2, direction = 1) +\n  scale_x_continuous(breaks = seq(0, 315, 45),\n                     labels = c(\"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\")) +\n  labs(\n    title = \"Hoard Distribution: Polar View from Rome\",\n    subtitle = \"Distance (km) from center; bearing around circumference\",\n    x = \"Bearing from Rome\",\n    y = \"Distance (km)\"\n  ) +\n  theme(\n    axis.text.y = element_text(size = 8),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "directional_flow.html#sector-distribution",
    "href": "directional_flow.html#sector-distribution",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "5.2 Sector Distribution",
    "text": "5.2 Sector Distribution\n\n\nCode\nsector_summary &lt;- hoard_polar %&gt;%\n  group_by(sector) %&gt;%\n  summarise(\n    n_hoards = n(),\n    mean_dist = mean(dist_km),\n    mean_rome_pct = weighted.mean(p_rome, n_types) * 100,\n    median_rome_pct = median(p_rome) * 100,\n    total_types = sum(n_types),\n    .groups = \"drop\"\n  ) %&gt;%\n  arrange(desc(mean_rome_pct))\n\nkable(sector_summary, digits = 1, \n      col.names = c(\"Sector\", \"N Hoards\", \"Mean Dist (km)\", \n                    \"Mean Rome %\", \"Median Rome %\", \"Total Types\"),\n      caption = \"Rome penetration by geographic sector\")\n\n\n\nRome penetration by geographic sector\n\n\n\n\n\n\n\n\n\n\nSector\nN Hoards\nMean Dist (km)\nMean Rome %\nMedian Rome %\nTotal Types\n\n\n\n\nE: Balkans/East\n222\n818.8\n89.4\n93.6\n12777\n\n\nS: Africa/Sicily\n25\n506.1\n89.1\n94.4\n1499\n\n\nW: Iberia/Sardinia\n110\n1223.5\n87.4\n93.6\n6653\n\n\nN: Gaul/Alps\n106\n414.7\n86.6\n91.6\n9503"
  },
  {
    "objectID": "directional_flow.html#model-1-isotropic-distance-only",
    "href": "directional_flow.html#model-1-isotropic-distance-only",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "6.1 Model 1: Isotropic (Distance Only)",
    "text": "6.1 Model 1: Isotropic (Distance Only)\n\n\nCode\n# Baseline: distance only\nmodel_iso &lt;- glm(\n  cbind(n_rome, n_types - n_rome) ~ dist_km,\n  family = binomial(link = \"logit\"),\n  data = hoard_polar\n)\n\nsummary(model_iso)\n\n\n\nCall:\nglm(formula = cbind(n_rome, n_types - n_rome) ~ dist_km, family = binomial(link = \"logit\"), \n    data = hoard_polar)\n\nCoefficients:\n              Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)  2.055e+00  3.072e-02  66.883   &lt;2e-16 ***\ndist_km     -8.031e-05  3.568e-05  -2.251   0.0244 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 3220.1  on 462  degrees of freedom\nResidual deviance: 3215.1  on 461  degrees of freedom\nAIC: 4455.4\n\nNumber of Fisher Scoring iterations: 5\n\n\nCode\ncat(\"\\nAIC (isotropic):\", AIC(model_iso), \"\\n\")\n\n\n\nAIC (isotropic): 4455.434"
  },
  {
    "objectID": "directional_flow.html#model-2-anisotropic-distance-direction",
    "href": "directional_flow.html#model-2-anisotropic-distance-direction",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "6.2 Model 2: Anisotropic (Distance + Direction)",
    "text": "6.2 Model 2: Anisotropic (Distance + Direction)\n\n\nCode\n# Add directional components\nmodel_aniso &lt;- glm(\n  cbind(n_rome, n_types - n_rome) ~ dist_km + cos_bearing + sin_bearing,\n  family = binomial(link = \"logit\"),\n  data = hoard_polar\n)\n\nsummary(model_aniso)\n\n\n\nCall:\nglm(formula = cbind(n_rome, n_types - n_rome) ~ dist_km + cos_bearing + \n    sin_bearing, family = binomial(link = \"logit\"), data = hoard_polar)\n\nCoefficients:\n              Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)  2.063e+00  3.610e-02  57.151  &lt; 2e-16 ***\ndist_km     -6.487e-05  3.853e-05  -1.684 0.092255 .  \ncos_bearing -1.158e-01  3.333e-02  -3.474 0.000513 ***\nsin_bearing  1.238e-01  2.417e-02   5.121 3.03e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 3220.1  on 462  degrees of freedom\nResidual deviance: 3164.7  on 459  degrees of freedom\nAIC: 4409\n\nNumber of Fisher Scoring iterations: 5\n\n\nCode\ncat(\"\\nAIC (anisotropic):\", AIC(model_aniso), \"\\n\")\n\n\n\nAIC (anisotropic): 4409.009"
  },
  {
    "objectID": "directional_flow.html#model-3-full-interaction-direction-dependent-distance-effect",
    "href": "directional_flow.html#model-3-full-interaction-direction-dependent-distance-effect",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "6.3 Model 3: Full Interaction (Direction-Dependent Distance Effect)",
    "text": "6.3 Model 3: Full Interaction (Direction-Dependent Distance Effect)\n\n\nCode\n# Distance effect varies by direction\nmodel_interact &lt;- glm(\n  cbind(n_rome, n_types - n_rome) ~ dist_km * cos_bearing + dist_km * sin_bearing,\n  family = binomial(link = \"logit\"),\n  data = hoard_polar\n)\n\nsummary(model_interact)\n\n\n\nCall:\nglm(formula = cbind(n_rome, n_types - n_rome) ~ dist_km * cos_bearing + \n    dist_km * sin_bearing, family = binomial(link = \"logit\"), \n    data = hoard_polar)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept)          1.994e+00  3.713e-02  53.697  &lt; 2e-16 ***\ndist_km              2.913e-05  4.035e-05   0.722 0.470313    \ncos_bearing          3.010e-01  6.233e-02   4.829 1.37e-06 ***\nsin_bearing          1.883e-01  5.455e-02   3.452 0.000556 ***\ndist_km:cos_bearing -8.818e-04  1.081e-04  -8.154 3.52e-16 ***\ndist_km:sin_bearing  5.032e-05  5.501e-05   0.915 0.360355    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 3220.1  on 462  degrees of freedom\nResidual deviance: 3098.3  on 457  degrees of freedom\nAIC: 4346.7\n\nNumber of Fisher Scoring iterations: 5\n\n\nCode\ncat(\"\\nAIC (interaction):\", AIC(model_interact), \"\\n\")\n\n\n\nAIC (interaction): 4346.673"
  },
  {
    "objectID": "directional_flow.html#model-comparison",
    "href": "directional_flow.html#model-comparison",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "6.4 Model Comparison",
    "text": "6.4 Model Comparison\n\n\nCode\n# Compare models\nmodel_comp &lt;- tibble(\n  Model = c(\"Isotropic (distance only)\", \n            \"Anisotropic (distance + direction)\",\n            \"Interaction (direction-dependent distance)\"),\n  AIC = c(AIC(model_iso), AIC(model_aniso), AIC(model_interact)),\n  df = c(df.residual(model_iso), df.residual(model_aniso), df.residual(model_interact))\n) %&gt;%\n  mutate(delta_AIC = AIC - min(AIC))\n\nkable(model_comp, digits = 1, caption = \"Model comparison (lower AIC = better fit)\")\n\n\n\nModel comparison (lower AIC = better fit)\n\n\nModel\nAIC\ndf\ndelta_AIC\n\n\n\n\nIsotropic (distance only)\n4455.4\n461\n108.8\n\n\nAnisotropic (distance + direction)\n4409.0\n459\n62.3\n\n\nInteraction (direction-dependent distance)\n4346.7\n457\n0.0\n\n\n\n\n\nCode\n# Likelihood ratio test\ncat(\"\\nLikelihood ratio test: Isotropic vs Anisotropic\\n\")\n\n\n\nLikelihood ratio test: Isotropic vs Anisotropic\n\n\nCode\nanova(model_iso, model_aniso, test = \"Chisq\")\n\n\nAnalysis of Deviance Table\n\nModel 1: cbind(n_rome, n_types - n_rome) ~ dist_km\nModel 2: cbind(n_rome, n_types - n_rome) ~ dist_km + cos_bearing + sin_bearing\n  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    \n1       461     3215.1                          \n2       459     3164.7  2   50.425 1.123e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nCode\ncat(\"\\nLikelihood ratio test: Anisotropic vs Interaction\\n\")\n\n\n\nLikelihood ratio test: Anisotropic vs Interaction\n\n\nCode\nanova(model_aniso, model_interact, test = \"Chisq\")\n\n\nAnalysis of Deviance Table\n\nModel 1: cbind(n_rome, n_types - n_rome) ~ dist_km + cos_bearing + sin_bearing\nModel 2: cbind(n_rome, n_types - n_rome) ~ dist_km * cos_bearing + dist_km * \n    sin_bearing\n  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    \n1       459     3164.7                          \n2       457     3098.3  2   66.336 3.938e-15 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"
  },
  {
    "objectID": "directional_flow.html#fit-separate-models-per-sector",
    "href": "directional_flow.html#fit-separate-models-per-sector",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "7.1 Fit Separate Models per Sector",
    "text": "7.1 Fit Separate Models per Sector\n\n\nCode\nsector_models &lt;- hoard_polar %&gt;%\n  filter(!is.na(sector)) %&gt;%\n  group_by(sector) %&gt;%\n  nest() %&gt;%\n  mutate(\n    model = map(data, ~glm(\n      cbind(n_rome, n_types - n_rome) ~ dist_km,\n      family = binomial(link = \"logit\"),\n      data = .x\n    )),\n    tidy = map(model, tidy)\n  ) %&gt;%\n  unnest(tidy) %&gt;%\n  filter(term == \"dist_km\") %&gt;%\n  dplyr::select(sector, estimate, std.error, p.value) %&gt;%\n  mutate(\n    or_100km = exp(estimate * 100),\n    sig = ifelse(p.value &lt; 0.05, \"*\", \"\")\n  )\n\nkable(sector_models, digits = c(0, 5, 5, 4, 4, 0),\n      col.names = c(\"Sector\", \"Coefficient\", \"SE\", \"p-value\", \"OR/100km\", \"Sig\"),\n      caption = \"Distance effect by sector (* = p &lt; 0.05)\")\n\n\n\nDistance effect by sector (* = p &lt; 0.05)\n\n\nSector\nCoefficient\nSE\np-value\nOR/100km\nSig\n\n\n\n\nE: Balkans/East\n-0.00008\n0.00007\n0.2204\n0.9918\n\n\n\nW: Iberia/Sardinia\n-0.00009\n0.00007\n0.2264\n0.9912\n\n\n\nN: Gaul/Alps\n-0.00127\n0.00015\n0.0000\n0.8807\n*\n\n\nS: Africa/Sicily\n-0.00014\n0.00045\n0.7616\n0.9864"
  },
  {
    "objectID": "directional_flow.html#visualize-sector-specific-distance-effects",
    "href": "directional_flow.html#visualize-sector-specific-distance-effects",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "7.2 Visualize Sector-Specific Distance Effects",
    "text": "7.2 Visualize Sector-Specific Distance Effects\n\n\nCode\nggplot(hoard_polar, aes(x = dist_km, y = p_rome)) +\n  geom_point(aes(size = n_types), alpha = 0.4, color = \"steelblue\") +\n  geom_smooth(method = \"glm\", method.args = list(family = \"binomial\"),\n              color = \"darkred\", se = TRUE) +\n  facet_wrap(~sector, ncol = 2) +\n  scale_y_continuous(labels = scales::percent_format()) +\n  scale_size_continuous(name = \"N types\", range = c(1, 6)) +\n  labs(\n    title = \"Distance-Decay by Sector\",\n    subtitle = \"Does Rome's reach decline equally in all directions?\",\n    x = \"Distance from Rome (km)\",\n    y = \"Rome proportion\"\n  ) +\n  theme(legend.position = \"bottom\")"
  },
  {
    "objectID": "directional_flow.html#does-anisotropy-differ-by-regime",
    "href": "directional_flow.html#does-anisotropy-differ-by-regime",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "9.1 Does Anisotropy Differ by Regime?",
    "text": "9.1 Does Anisotropy Differ by Regime?\n\n\nCode\nregime_direction &lt;- hoard_polar %&gt;%\n  filter(!is.na(regime)) %&gt;%\n  group_by(regime) %&gt;%\n  nest() %&gt;%\n  mutate(\n    # Isotropic model\n    model_iso = map(data, ~glm(\n      cbind(n_rome, n_types - n_rome) ~ dist_km,\n      family = binomial, data = .x\n    )),\n    # Anisotropic model\n    model_aniso = map(data, ~glm(\n      cbind(n_rome, n_types - n_rome) ~ dist_km + cos_bearing + sin_bearing,\n      family = binomial, data = .x\n    )),\n    # Compare\n    aic_iso = map_dbl(model_iso, AIC),\n    aic_aniso = map_dbl(model_aniso, AIC),\n    aic_diff = aic_iso - aic_aniso,  # Positive = anisotropic better\n    # LRT p-value\n    lrt_p = map2_dbl(model_iso, model_aniso, ~{\n      test &lt;- anova(.x, .y, test = \"Chisq\")\n      test$`Pr(&gt;Chi)`[2]\n    })\n  ) %&gt;%\n  dplyr::select(regime, aic_iso, aic_aniso, aic_diff, lrt_p) %&gt;%\n  mutate(\n    aniso_sig = ifelse(lrt_p &lt; 0.05, \"Yes*\", \"No\")\n  )\n\nkable(regime_direction, digits = c(0, 1, 1, 1, 4, 0),\n      col.names = c(\"Regime\", \"AIC (iso)\", \"AIC (aniso)\", \"ΔAIC\", \"LRT p\", \"Aniso Sig?\"),\n      caption = \"Does adding direction improve model fit? (by regime)\")\n\n\n\nDoes adding direction improve model fit? (by regime)\n\n\nRegime\nAIC (iso)\nAIC (aniso)\nΔAIC\nLRT p\nAniso Sig?\n\n\n\n\nPost-transition\n2363.2\n2249.7\n113.4\n0.0000\nYes*\n\n\nTransition\n588.3\n588.3\n-0.1\n0.1420\nNo\n\n\nPre-transition\n507.1\n495.1\n11.9\n0.0003\nYes*"
  },
  {
    "objectID": "directional_flow.html#sector-effects-by-regime",
    "href": "directional_flow.html#sector-effects-by-regime",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "9.2 Sector Effects by Regime",
    "text": "9.2 Sector Effects by Regime\n\n\nCode\nsector_regime &lt;- hoard_polar %&gt;%\n  filter(!is.na(regime), !is.na(sector)) %&gt;%\n  group_by(regime, sector) %&gt;%\n  summarise(\n    n_hoards = n(),\n    mean_rome = weighted.mean(p_rome, n_types) * 100,\n    total_types = sum(n_types),\n    .groups = \"drop\"\n  )\n\nggplot(sector_regime, aes(x = sector, y = mean_rome, fill = regime)) +\n  geom_col(position = \"dodge\", alpha = 0.8) +\n  scale_fill_manual(values = c(\"Pre-transition\" = \"steelblue\",\n                                \"Transition\" = \"gold\",\n                                \"Post-transition\" = \"darkred\")) +\n  labs(\n    title = \"Rome Proportion by Sector and Regime\",\n    subtitle = \"How did directional patterns change across the transition?\",\n    x = NULL,\n    y = \"Mean Rome %\",\n    fill = \"Regime\"\n  ) +\n  theme(axis.text.x = element_text(angle = 30, hjust = 1))"
  },
  {
    "objectID": "directional_flow.html#distance-decay-by-sector-and-regime",
    "href": "directional_flow.html#distance-decay-by-sector-and-regime",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "9.3 Distance-Decay by Sector AND Regime",
    "text": "9.3 Distance-Decay by Sector AND Regime\n\n\nCode\nsector_regime_models &lt;- hoard_polar %&gt;%\n  filter(!is.na(regime), !is.na(sector)) %&gt;%\n  group_by(regime, sector) %&gt;%\n  filter(n() &gt;= 10) %&gt;%  # Need minimum sample\n  nest() %&gt;%\n  mutate(\n    model = map(data, ~tryCatch(\n      glm(cbind(n_rome, n_types - n_rome) ~ dist_km,\n          family = binomial, data = .x),\n      error = function(e) NULL\n    )),\n    tidy = map(model, ~if(!is.null(.x)) tidy(.x) else NULL)\n  ) %&gt;%\n  filter(!map_lgl(tidy, is.null)) %&gt;%\n  unnest(tidy) %&gt;%\n  filter(term == \"dist_km\") %&gt;%\n  dplyr::select(regime, sector, estimate, std.error, p.value) %&gt;%\n  mutate(\n    or_100km = exp(estimate * 100),\n    sig = ifelse(p.value &lt; 0.05, \"*\", \"\")\n  )\n\nkable(sector_regime_models, digits = c(0, 0, 5, 5, 4, 4, 0),\n      col.names = c(\"Regime\", \"Sector\", \"Coef\", \"SE\", \"p\", \"OR/100km\", \"\"),\n      caption = \"Distance effect by sector and regime\")\n\n\n\nDistance effect by sector and regime\n\n\n\n\n\n\n\n\n\n\n\nRegime\nSector\nCoef\nSE\np\nOR/100km\n\n\n\n\n\nPost-transition\nE: Balkans/East\n0.00028\n0.00009\n0.0012\n1.0282\n*\n\n\nPost-transition\nW: Iberia/Sardinia\n-0.00027\n0.00009\n0.0042\n0.9732\n*\n\n\nTransition\nE: Balkans/East\n0.00022\n0.00015\n0.1269\n1.0225\n\n\n\nPre-transition\nW: Iberia/Sardinia\n0.00075\n0.00037\n0.0422\n1.0781\n*\n\n\nPost-transition\nN: Gaul/Alps\n-0.00067\n0.00017\n0.0001\n0.9350\n*\n\n\nTransition\nW: Iberia/Sardinia\n0.00028\n0.00014\n0.0482\n1.0286\n*\n\n\nPre-transition\nS: Africa/Sicily\n-0.00195\n0.00254\n0.4413\n0.8225\n\n\n\nTransition\nN: Gaul/Alps\n-0.00001\n0.00063\n0.9847\n0.9988\n\n\n\nPre-transition\nE: Balkans/East\n0.00035\n0.00055\n0.5287\n1.0354\n\n\n\nPre-transition\nN: Gaul/Alps\n-0.00126\n0.00059\n0.0337\n0.8819\n*"
  },
  {
    "objectID": "directional_flow.html#map-sectors-with-rome-proportion",
    "href": "directional_flow.html#map-sectors-with-rome-proportion",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "10.1 Map: Sectors with Rome Proportion",
    "text": "10.1 Map: Sectors with Rome Proportion\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Get land\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;% st_union()\n\n# Create sf from hoards\nhoard_sf &lt;- st_as_sf(hoard_polar, coords = c(\"hoard_long\", \"hoard_lat\"), \n                      crs = 4326, remove = FALSE)\n\nhoard_bbox &lt;- st_bbox(hoard_sf)\n\n# Rome point\nrome_sf &lt;- st_as_sf(tibble(lon = rome_lon, lat = rome_lat),\n                     coords = c(\"lon\", \"lat\"), crs = 4326)\n\nggplot() +\n  geom_sf(data = land, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(data = hoard_sf, aes(color = p_rome, shape = sector), \n          size = 2, alpha = 0.7) +\n  geom_sf(data = rome_sf, color = \"black\", shape = 8, size = 5, stroke = 2) +\n  scale_color_viridis_c(name = \"Rome %\", labels = scales::percent_format(),\n                        option = \"plasma\") +\n  scale_shape_manual(values = c(\"N: Gaul/Alps\" = 16, \"E: Balkans/East\" = 17,\n                                 \"S: Africa/Sicily\" = 15, \"W: Iberia/Sardinia\" = 18)) +\n  coord_sf(xlim = c(hoard_bbox[\"xmin\"] - 2, hoard_bbox[\"xmax\"] + 2),\n           ylim = c(hoard_bbox[\"ymin\"] - 2, hoard_bbox[\"ymax\"] + 2)) +\n  labs(\n    title = \"Hoard Locations by Sector and Rome Proportion\",\n    subtitle = \"Star = Rome mint\",\n    shape = \"Sector\"\n  ) +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.title = element_blank())"
  },
  {
    "objectID": "directional_flow.html#polar-heatmap-rome-by-distance-and-bearing",
    "href": "directional_flow.html#polar-heatmap-rome-by-distance-and-bearing",
    "title": "Directional Flow Analysis: Anisotropic Monetary Reach",
    "section": "10.2 Polar Heatmap: Rome % by Distance and Bearing",
    "text": "10.2 Polar Heatmap: Rome % by Distance and Bearing\n\n\nCode\n# Bin by distance and bearing\npolar_bins &lt;- hoard_polar %&gt;%\n  mutate(\n    dist_bin = cut(dist_km, breaks = seq(0, 3000, 300), include.lowest = TRUE),\n    bearing_bin = cut(bearing_deg, breaks = seq(0, 360, 45), include.lowest = TRUE)\n  ) %&gt;%\n  group_by(dist_bin, bearing_bin) %&gt;%\n  summarise(\n    n = n(),\n    mean_rome = weighted.mean(p_rome, n_types),\n    .groups = \"drop\"\n  ) %&gt;%\n  filter(n &gt;= 3)  # Minimum sample\n\n# Extract bin midpoints\npolar_bins &lt;- polar_bins %&gt;%\n  mutate(\n    dist_mid = as.numeric(str_extract(as.character(dist_bin), \"\\\\d+\")) + 150,\n    bearing_mid = as.numeric(str_extract(as.character(bearing_bin), \"\\\\d+\")) + 22.5\n  )\n\nggplot(polar_bins, aes(x = bearing_mid, y = dist_mid, fill = mean_rome)) +\n  geom_tile(width = 45, height = 300, alpha = 0.9) +\n  geom_text(aes(label = round(mean_rome * 100)), size = 3, color = \"white\") +\n  coord_polar(theta = \"x\", start = -pi/2) +\n  scale_fill_viridis_c(name = \"Rome %\", labels = scales::percent_format(),\n                       option = \"plasma\") +\n  scale_x_continuous(breaks = seq(22.5, 337.5, 45),\n                     labels = c(\"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\")) +\n  labs(\n    title = \"Polar Heatmap: Rome Proportion\",\n    subtitle = \"By distance (rings) and bearing (sectors) from Rome\",\n    x = NULL, y = \"Distance (km)\"\n  ) +\n  theme(axis.text.y = element_text(size = 8))"
  },
  {
    "objectID": "lrr_mint_date.html",
    "href": "lrr_mint_date.html",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "",
    "text": "The TPQ (deposition) analysis revealed striking patterns:\n\n\n\nFinding\nTPQ Result\n\n\n\n\nRome proportion over time\nDeclined from 95% to 83%\n\n\nDistance effect\nReversed sign across periods\n\n\nSpatial extent\nExpanded dramatically\n\n\n\nMint-date stratification asks a different question: When coins were minted, where did they eventually end up?\nThis provides a validation check and additional insight:\n\nIf TPQ patterns reflect production changes, mint-date stratification should show similar trends\nIf TPQ patterns reflect circulation/hoarding behavior, mint-date may show different patterns\nCoins minted early but deposited late reveal circulation longevity\n\n\n\n\n\n\n\n\n\n\n\n\nDimension\nTPQ (Deposition)\nMint Date (Production)\n\n\n\n\nQuestion\nWhen were coins buried?\nWhen were coins made?\n\n\nUnit\nHoard event\nCoin-type occurrence\n\n\nReflects\nCrisis, hoarding behavior\nMint output, initial distribution\n\n\nCaveat\nHoards contain mixed-age coins\nCoins travel after minting\n\n\n\n\n\n\nWe use the same period boundaries for comparability:\n\n\n\n\n\n\n\n\n\nPeriod\nMint Date Range\nLabel\nHistorical Context\n\n\n\n\n1\nbefore 150 BCE\nEarly Republic\nPre-denarius standardization; limited output\n\n\n2\n150–100 BCE\nLate Republic I\nPost-Gracchi; expanding provincial reach\n\n\n3\n100–50 BCE\nLate Republic II\nCivil war coinages; military mints\n\n\n4\n50 BCE – 14 CE\nTriumviral/Augustan\nMassive output; Augustan reform\n\n\n5\nafter 14 CE\nEarly Imperial\nJulio-Claudian (if present)"
  },
  {
    "objectID": "lrr_mint_date.html#comparison-with-tpq-stratification",
    "href": "lrr_mint_date.html#comparison-with-tpq-stratification",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "",
    "text": "The TPQ (deposition) analysis revealed striking patterns:\n\n\n\nFinding\nTPQ Result\n\n\n\n\nRome proportion over time\nDeclined from 95% to 83%\n\n\nDistance effect\nReversed sign across periods\n\n\nSpatial extent\nExpanded dramatically\n\n\n\nMint-date stratification asks a different question: When coins were minted, where did they eventually end up?\nThis provides a validation check and additional insight:\n\nIf TPQ patterns reflect production changes, mint-date stratification should show similar trends\nIf TPQ patterns reflect circulation/hoarding behavior, mint-date may show different patterns\nCoins minted early but deposited late reveal circulation longevity"
  },
  {
    "objectID": "lrr_mint_date.html#key-interpretive-difference",
    "href": "lrr_mint_date.html#key-interpretive-difference",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "",
    "text": "Dimension\nTPQ (Deposition)\nMint Date (Production)\n\n\n\n\nQuestion\nWhen were coins buried?\nWhen were coins made?\n\n\nUnit\nHoard event\nCoin-type occurrence\n\n\nReflects\nCrisis, hoarding behavior\nMint output, initial distribution\n\n\nCaveat\nHoards contain mixed-age coins\nCoins travel after minting"
  },
  {
    "objectID": "lrr_mint_date.html#mint-date-period-definitions",
    "href": "lrr_mint_date.html#mint-date-period-definitions",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "",
    "text": "We use the same period boundaries for comparability:\n\n\n\n\n\n\n\n\n\nPeriod\nMint Date Range\nLabel\nHistorical Context\n\n\n\n\n1\nbefore 150 BCE\nEarly Republic\nPre-denarius standardization; limited output\n\n\n2\n150–100 BCE\nLate Republic I\nPost-Gracchi; expanding provincial reach\n\n\n3\n100–50 BCE\nLate Republic II\nCivil war coinages; military mints\n\n\n4\n50 BCE – 14 CE\nTriumviral/Augustan\nMassive output; Augustan reform\n\n\n5\nafter 14 CE\nEarly Imperial\nJulio-Claudian (if present)"
  },
  {
    "objectID": "lrr_mint_date.html#parse-mint-dates-and-flag-rome",
    "href": "lrr_mint_date.html#parse-mint-dates-and-flag-rome",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "4.1 Parse Mint Dates and Flag Rome",
    "text": "4.1 Parse Mint Dates and Flag Rome\n\n\nCode\nchrr_flagged &lt;- chrr_raw %&gt;%\n  mutate(\n    is_rome = mint_id == \"rome\" | str_detect(mint_uri, \"/id/rome$\"),\n    is_rome = replace_na(is_rome, FALSE),\n    \n    # Parse mint date range\n    mint_start = as.numeric(start_year),\n    mint_end = as.numeric(end_year),\n    mint_mid = (mint_start + mint_end) / 2\n  )\n\n# Check mint-date coverage\nmint_coverage &lt;- chrr_flagged %&gt;%\n  summarise(\n    total_rows = n(),\n    rows_with_mint_date = sum(!is.na(mint_mid)),\n    pct_with_mint_date = round(100 * rows_with_mint_date / total_rows, 1),\n    mint_min = min(mint_mid, na.rm = TRUE),\n    mint_max = max(mint_mid, na.rm = TRUE)\n  )\n\nkable(mint_coverage, caption = \"Mint-date coverage in dataset\")\n\n\n\nMint-date coverage in dataset\n\n\n\n\n\n\n\n\n\ntotal_rows\nrows_with_mint_date\npct_with_mint_date\nmint_min\nmint_max\n\n\n\n\n31951\n31372\n98.2\n-238\n-31"
  },
  {
    "objectID": "lrr_mint_date.html#define-mint-date-period-bins",
    "href": "lrr_mint_date.html#define-mint-date-period-bins",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "4.2 Define Mint-Date Period Bins",
    "text": "4.2 Define Mint-Date Period Bins\n\n\nCode\nperiod_breaks &lt;- c(-Inf, -150, -100, -50, 14, Inf)\nperiod_labels &lt;- c(\n \"1: Early Republic (pre-150 BCE)\",\n  \"2: Late Republic I (150-100 BCE)\",\n  \"3: Late Republic II (100-50 BCE)\",\n  \"4: Triumviral/Augustan (50 BCE-14 CE)\",\n  \"5: Early Imperial (post-14 CE)\"\n)\n\nchrr_mint &lt;- chrr_flagged %&gt;%\n  filter(!is.na(mint_mid)) %&gt;%\n  mutate(\n    mint_period = cut(\n      mint_mid,\n      breaks = period_breaks,\n      labels = period_labels,\n      right = TRUE\n    ),\n    mint_period_num = as.integer(mint_period)\n  )\n\n# Period summary\nmint_period_summary &lt;- chrr_mint %&gt;%\n  group_by(mint_period) %&gt;%\n  summarise(\n    n_rows = n(),\n    n_hoards = n_distinct(hoard_id),\n    n_rome = sum(is_rome),\n    n_non_rome = sum(!is_rome),\n    pct_rome = round(100 * n_rome / n_rows, 1),\n    .groups = \"drop\"\n  )\n\nkable(mint_period_summary,\n      col.names = c(\"Mint Period\", \"Rows\", \"Hoards\", \"Rome\", \"Non-Rome\", \"Rome %\"),\n      caption = \"Data distribution by mint-date period\")\n\n\n\nData distribution by mint-date period\n\n\n\n\n\n\n\n\n\n\nMint Period\nRows\nHoards\nRome\nNon-Rome\nRome %\n\n\n\n\n1: Early Republic (pre-150 BCE)\n2632\n330\n2247\n385\n85.4\n\n\n2: Late Republic I (150-100 BCE)\n13565\n451\n13186\n379\n97.2\n\n\n3: Late Republic II (100-50 BCE)\n11368\n385\n10575\n793\n93.0\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n3807\n221\n2169\n1638\n57.0"
  },
  {
    "objectID": "lrr_mint_date.html#visualize-mint-date-distribution",
    "href": "lrr_mint_date.html#visualize-mint-date-distribution",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "4.3 Visualize Mint-Date Distribution",
    "text": "4.3 Visualize Mint-Date Distribution\n\n\nCode\nggplot(chrr_mint, aes(x = mint_mid, fill = mint_period)) +\n  geom_histogram(binwidth = 10, color = \"white\", alpha = 0.8) +\n  geom_vline(xintercept = c(-150, -100, -50, 14),\n             linetype = \"dashed\", color = \"grey30\") +\n  scale_fill_viridis_d(name = \"Period\", option = \"plasma\") +\n  labs(\n    title = \"Coin-Type Minting Chronology\",\n    subtitle = \"Distribution of mint_mid (midpoint of mint date range)\",\n    x = \"Mint date (midpoint)\",\n    y = \"Number of coin-type occurrences\"\n  ) +\n  theme(legend.position = \"bottom\")"
  },
  {
    "objectID": "lrr_mint_date.html#compare-tpq-vs-mint-date-distributions",
    "href": "lrr_mint_date.html#compare-tpq-vs-mint-date-distributions",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "4.4 Compare TPQ vs Mint-Date Distributions",
    "text": "4.4 Compare TPQ vs Mint-Date Distributions\n\n\nCode\n# Add TPQ for comparison\nchrr_both &lt;- chrr_mint %&gt;%\n  mutate(\n    tpq_year = readr::parse_number(as.character(hoard_tpq))\n  ) %&gt;%\n  filter(!is.na(tpq_year))\n\n# Long format for faceting\nchrr_long &lt;- chrr_both %&gt;%\n  select(hoard_id, type_id, mint_mid, tpq_year) %&gt;%\n  pivot_longer(\n    cols = c(mint_mid, tpq_year),\n    names_to = \"date_type\",\n    values_to = \"year\"\n  ) %&gt;%\n  mutate(\n    date_type = recode(date_type,\n      \"mint_mid\" = \"Mint Date (production)\",\n      \"tpq_year\" = \"TPQ (deposition)\"\n    )\n  )\n\nggplot(chrr_long, aes(x = year, fill = date_type)) +\n  geom_histogram(binwidth = 10, alpha = 0.7, position = \"identity\") +\n  facet_wrap(~date_type, ncol = 2) +\n  scale_fill_manual(values = c(\"Mint Date (production)\" = \"steelblue\", \n                                \"TPQ (deposition)\" = \"darkred\")) +\n  labs(\n    title = \"Production vs. Deposition Chronology\",\n    subtitle = \"Mint dates skew earlier; TPQ dates cluster in late Republic\",\n    x = \"Year\",\n    y = \"Count\"\n  ) +\n  theme(legend.position = \"none\")"
  },
  {
    "objectID": "lrr_mint_date.html#distribution-of-deposition-lag",
    "href": "lrr_mint_date.html#distribution-of-deposition-lag",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "5.1 Distribution of Deposition Lag",
    "text": "5.1 Distribution of Deposition Lag\n\n\nCode\nchrr_lag &lt;- chrr_both %&gt;%\n  mutate(\n    deposition_lag = tpq_year - mint_mid\n  ) %&gt;%\n  filter(!is.na(deposition_lag))\n\nlag_summary &lt;- chrr_lag %&gt;%\n  summarise(\n    n = n(),\n    mean_lag = mean(deposition_lag),\n    median_lag = median(deposition_lag),\n    sd_lag = sd(deposition_lag),\n    q25 = quantile(deposition_lag, 0.25),\n    q75 = quantile(deposition_lag, 0.75)\n  )\n\nkable(lag_summary, digits = 1, caption = \"Deposition lag (TPQ - mint_mid) statistics\")\n\n\n\nDeposition lag (TPQ - mint_mid) statistics\n\n\nn\nmean_lag\nmedian_lag\nsd_lag\nq25\nq75\n\n\n\n\n31257\n43.9\n38\n33.5\n16.5\n64\n\n\n\n\n\nCode\nggplot(chrr_lag, aes(x = deposition_lag)) +\n  geom_histogram(binwidth = 10, fill = \"steelblue\", color = \"white\", alpha = 0.8) +\n  geom_vline(xintercept = lag_summary$median_lag, color = \"darkred\", \n             linetype = \"dashed\", linewidth = 1) +\n  labs(\n    title = \"Circulation Lag: Time Between Minting and Deposition\",\n    subtitle = paste(\"Median lag =\", round(lag_summary$median_lag, 0), \"years\"),\n    x = \"Deposition lag (years)\",\n    y = \"Count\"\n  )"
  },
  {
    "objectID": "lrr_mint_date.html#lag-by-mint-period",
    "href": "lrr_mint_date.html#lag-by-mint-period",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "5.2 Lag by Mint Period",
    "text": "5.2 Lag by Mint Period\n\n\nCode\nlag_by_period &lt;- chrr_lag %&gt;%\n  group_by(mint_period) %&gt;%\n  summarise(\n    n = n(),\n    mean_lag = mean(deposition_lag),\n    median_lag = median(deposition_lag),\n    sd_lag = sd(deposition_lag),\n    .groups = \"drop\"\n  )\n\nkable(lag_by_period, digits = 1, \n      col.names = c(\"Mint Period\", \"N\", \"Mean Lag\", \"Median Lag\", \"SD\"),\n      caption = \"Circulation lag by mint period\")\n\n\n\nCirculation lag by mint period\n\n\n\n\n\n\n\n\n\nMint Period\nN\nMean Lag\nMedian Lag\nSD\n\n\n\n\n1: Early Republic (pre-150 BCE)\n2627\n86.8\n84.5\n41.7\n\n\n2: Late Republic I (150-100 BCE)\n13493\n53.4\n52.0\n31.3\n\n\n3: Late Republic II (100-50 BCE)\n11330\n31.9\n31.0\n22.2\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n3807\n16.0\n9.0\n16.4\n\n\n\n\n\nCode\nggplot(chrr_lag, aes(x = mint_period, y = deposition_lag, fill = mint_period)) +\n  geom_boxplot(alpha = 0.7, outlier.alpha = 0.3) +\n  scale_fill_viridis_d(option = \"plasma\") +\n  labs(\n    title = \"Circulation Lag by Mint Period\",\n    subtitle = \"Earlier coins had longer circulation before deposition\",\n    x = NULL,\n    y = \"Deposition lag (years)\"\n  ) +\n  theme(\n    axis.text.x = element_text(angle = 30, hjust = 1),\n    legend.position = \"none\"\n  )"
  },
  {
    "objectID": "lrr_mint_date.html#prepare-spatial-data",
    "href": "lrr_mint_date.html#prepare-spatial-data",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "6.1 Prepare Spatial Data",
    "text": "6.1 Prepare Spatial Data\n\n\nCode\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n\n# Filter to valid coordinates\nchrr_spatial &lt;- chrr_mint %&gt;%\n  filter(!is.na(hoard_lat), !is.na(hoard_long))\n\n# Convert to sf\nhoard_sf &lt;- st_as_sf(\nchrr_spatial,\n  coords = c(\"hoard_long\", \"hoard_lat\"),\n  crs = 4326,\n  remove = FALSE\n)\n\n# Land and projection\nland &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;%\n  st_union()\n\nhoard_sf_valid &lt;- hoard_sf %&gt;%\n  filter(!st_is_empty(geometry))\n\nhoard_bbox &lt;- st_bbox(hoard_sf_valid)\n\nif (any(is.na(hoard_bbox))) {\n  hoard_bbox &lt;- c(xmin = -10, ymin = 30, xmax = 45, ymax = 55)\n  names(hoard_bbox) &lt;- c(\"xmin\", \"ymin\", \"xmax\", \"ymax\")\n}\n\npad &lt;- 2\n\nstudy_extent &lt;- st_polygon(list(rbind(\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymin\"] - pad),\n  c(hoard_bbox[\"xmax\"] + pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymax\"] + pad),\n  c(hoard_bbox[\"xmin\"] - pad, hoard_bbox[\"ymin\"] - pad)\n))) %&gt;%\n  st_sfc(crs = 4326)\n\nstudy_land &lt;- st_intersection(land, study_extent)\n\ntarget_crs &lt;- 3035\nhoard_sf_proj &lt;- st_transform(hoard_sf_valid, target_crs)\nstudy_land_proj &lt;- st_transform(study_land, target_crs)\n\nrome_mint &lt;- st_as_sf(\n  tibble(name = \"Rome\", lon = 12.4964, lat = 41.9028),\n  coords = c(\"lon\", \"lat\"),\n  crs = 4326\n) %&gt;%\n  st_transform(target_crs)"
  },
  {
    "objectID": "lrr_mint_date.html#hexagonal-grid",
    "href": "lrr_mint_date.html#hexagonal-grid",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "6.2 Hexagonal Grid",
    "text": "6.2 Hexagonal Grid\n\n\nCode\nhex_size &lt;- 100000\n\nhex_grid &lt;- st_make_grid(\n  study_land_proj,\n  cellsize = hex_size,\n  square = FALSE\n) %&gt;%\n  st_sf(hex_id = seq_along(.), geometry = .) %&gt;%\n  st_set_crs(target_crs)\n\nhex_land &lt;- hex_grid %&gt;%\n  filter(lengths(st_intersects(., study_land_proj)) &gt; 0)\n\nhex_centroids &lt;- st_centroid(hex_land)\non_land &lt;- lengths(st_intersects(hex_centroids, study_land_proj)) &gt; 0\nhex_land &lt;- hex_land[on_land, ]\n\ncat(\"Hexes on land:\", nrow(hex_land), \"\\n\")\n\n\nHexes on land: 859"
  },
  {
    "objectID": "lrr_mint_date.html#assign-coin-types-to-hexes-by-mint-period",
    "href": "lrr_mint_date.html#assign-coin-types-to-hexes-by-mint-period",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "6.3 Assign Coin-Types to Hexes by Mint Period",
    "text": "6.3 Assign Coin-Types to Hexes by Mint Period\nNote: Unlike TPQ analysis where each hoard is one observation, here each coin-type occurrence is an observation with its own mint date.\n\n\nCode\nhoard_hex &lt;- st_join(hoard_sf_proj, hex_land, join = st_within) %&gt;%\n  filter(!is.na(hex_id))\n\ncat(\"Coin-type occurrences assigned to hexes:\", nrow(hoard_hex), \"\\n\")\n\n\nCoin-type occurrences assigned to hexes: 25306"
  },
  {
    "objectID": "lrr_mint_date.html#compute-lrr-by-mint-period-and-hex",
    "href": "lrr_mint_date.html#compute-lrr-by-mint-period-and-hex",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "6.4 Compute LRR by Mint Period and Hex",
    "text": "6.4 Compute LRR by Mint Period and Hex\n\n\nCode\n# Global Rome proportion\np_global &lt;- mean(hoard_hex$is_rome)\ncat(\"Global Rome proportion:\", round(p_global * 100, 2), \"%\\n\\n\")\n\n\nGlobal Rome proportion: 89.8 %\n\n\nCode\n# Aggregate by hex AND mint period\nhex_mint_comp &lt;- hoard_hex %&gt;%\n  st_drop_geometry() %&gt;%\n  group_by(hex_id, mint_period, mint_period_num) %&gt;%\n  summarise(\n    n_hoards = n_distinct(hoard_id),\n    total_types = n(),\n    rome_types = sum(is_rome),\n    non_rome_types = sum(!is_rome),\n    p_rome = rome_types / total_types,\n    .groups = \"drop\"\n  )\n\n# Period-specific globals\nmint_period_globals &lt;- hex_mint_comp %&gt;%\n  group_by(mint_period, mint_period_num) %&gt;%\n  summarise(\n    p_rome_period = sum(rome_types) / sum(total_types),\n    total_in_period = sum(total_types),\n    .groups = \"drop\"\n  )\n\nkable(mint_period_globals,\n      col.names = c(\"Mint Period\", \"Num\", \"Rome %\", \"Total Types\"),\n      digits = c(0, 0, 3, 0),\n      caption = \"Global Rome proportion by mint period\")\n\n\n\nGlobal Rome proportion by mint period\n\n\nMint Period\nNum\nRome %\nTotal Types\n\n\n\n\n1: Early Republic (pre-150 BCE)\n1\n0.843\n2046\n\n\n2: Late Republic I (150-100 BCE)\n2\n0.972\n11050\n\n\n3: Late Republic II (100-50 BCE)\n3\n0.931\n9090\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n4\n0.574\n3120\n\n\n\n\n\nCode\n# Compute LRR\nepsilon &lt;- 0.5\n\nhex_mint_lrr &lt;- hex_mint_comp %&gt;%\n  left_join(mint_period_globals, by = c(\"mint_period\", \"mint_period_num\")) %&gt;%\n  mutate(\n    LRR_period = log((rome_types + epsilon) / (total_types + epsilon)) - log(p_rome_period),\n    LRR_global = log((rome_types + epsilon) / (total_types + epsilon)) - log(p_global),\n    LRR_contrast = ifelse(\n      non_rome_types &gt; 0,\n      log((rome_types + epsilon) / (non_rome_types + epsilon)),\n      NA_real_\n    )\n  )"
  },
  {
    "objectID": "lrr_mint_date.html#compare-tpq-vs-mint-period-rome-proportions",
    "href": "lrr_mint_date.html#compare-tpq-vs-mint-period-rome-proportions",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "6.5 Compare TPQ vs Mint Period Rome Proportions",
    "text": "6.5 Compare TPQ vs Mint Period Rome Proportions\n\n\nCode\n# TPQ globals (from previous analysis logic)\nchrr_tpq &lt;- chrr_flagged %&gt;%\n  mutate(\n    tpq_year = readr::parse_number(as.character(hoard_tpq)),\n    tpq_period = cut(\n      tpq_year,\n      breaks = period_breaks,\n      labels = period_labels,\n      right = TRUE\n    )\n  ) %&gt;%\n  filter(!is.na(tpq_period), !is.na(hoard_lat), !is.na(hoard_long))\n\ntpq_globals &lt;- chrr_tpq %&gt;%\n  group_by(tpq_period) %&gt;%\n  summarise(\n    p_rome = sum(is_rome) / n(),\n    .groups = \"drop\"\n  ) %&gt;%\n  mutate(date_type = \"TPQ (deposition)\")\n\nmint_globals_compare &lt;- mint_period_globals %&gt;%\n  select(mint_period, p_rome_period) %&gt;%\n  rename(period = mint_period, p_rome = p_rome_period) %&gt;%\n  mutate(date_type = \"Mint Date (production)\")\n\ntpq_globals_compare &lt;- tpq_globals %&gt;%\n  rename(period = tpq_period)\n\ncompare_df &lt;- bind_rows(mint_globals_compare, tpq_globals_compare) %&gt;%\n  mutate(\n    period_num = as.integer(factor(period))\n  )\n\nggplot(compare_df, aes(x = period_num, y = p_rome, color = date_type, group = date_type)) +\n  geom_line(linewidth = 1.2) +\n  geom_point(size = 4) +\n  scale_color_manual(values = c(\"Mint Date (production)\" = \"steelblue\",\n                                 \"TPQ (deposition)\" = \"darkred\")) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0.7, 1)) +\n  scale_x_continuous(\n    breaks = 1:5,\n    labels = c(\"Early\\nRepublic\", \"Late Rep I\\n150-100\", \"Late Rep II\\n100-50\",\n               \"Triumviral/\\nAugustan\", \"Early\\nImperial\")\n  ) +\n  labs(\n    title = \"Rome Proportion: Production vs. Deposition\",\n    subtitle = \"Mint-date shows earlier decline; TPQ shows later decline\",\n    x = \"Period\",\n    y = \"Rome proportion\",\n    color = NULL\n  ) +\n  theme(legend.position = \"bottom\")"
  },
  {
    "objectID": "lrr_mint_date.html#faceted-lrr-by-mint-period",
    "href": "lrr_mint_date.html#faceted-lrr-by-mint-period",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "7.1 Faceted LRR by Mint Period",
    "text": "7.1 Faceted LRR by Mint Period\n\n\nCode\nhex_mint_sf &lt;- hex_land %&gt;%\n  inner_join(hex_mint_lrr, by = \"hex_id\") %&gt;%\n  st_transform(4326)\n\nland_wgs &lt;- st_transform(study_land_proj, 4326)\nrome_wgs &lt;- st_transform(rome_mint, 4326)\n\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_mint_sf,\n    aes(fill = LRR_period),\n    color = \"grey50\",\n    linewidth = 0.15\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 3, stroke = 1) +\n  scale_fill_gradient2(\n    low = \"steelblue\",\n    mid = \"white\",\n    high = \"darkred\",\n    midpoint = 0,\n    name = \"LRR\",\n    limits = c(-0.6, 0.6),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  facet_wrap(~mint_period, ncol = 3) +\n  labs(\n    title = \"Compositional LRR by Mint Period\",\n    subtitle = \"Where did coins minted in each period end up? | Red = above average, Blue = below\",\n    caption = \"LRR relative to period-specific global proportion\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    strip.text = element_text(size = 9, face = \"bold\"),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_mint_date.html#rome-proportion-by-mint-period",
    "href": "lrr_mint_date.html#rome-proportion-by-mint-period",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "7.2 Rome Proportion by Mint Period",
    "text": "7.2 Rome Proportion by Mint Period\n\n\nCode\nggplot() +\n  geom_sf(data = land_wgs, fill = \"grey95\", color = \"grey80\") +\n  geom_sf(\n    data = hex_mint_sf,\n    aes(fill = p_rome),\n    color = \"grey50\",\n    linewidth = 0.15\n  ) +\n  geom_sf(data = rome_wgs, color = \"black\", shape = 8, size = 3, stroke = 1) +\n  scale_fill_viridis_c(\n    name = \"Rome %\",\n    labels = scales::percent_format(),\n    option = \"plasma\",\n    limits = c(0.5, 1),\n    oob = scales::squish\n  ) +\n  coord_sf(\n    xlim = c(hoard_bbox[\"xmin\"] - 1, hoard_bbox[\"xmax\"] + 1),\n    ylim = c(hoard_bbox[\"ymin\"] - 1, hoard_bbox[\"ymax\"] + 1)\n  ) +\n  facet_wrap(~mint_period, ncol = 3) +\n  labs(\n    title = \"Rome Mint Proportion by Mint Period\",\n    subtitle = \"Raw proportion of coin-types from Rome mint\",\n    caption = \"Star = Rome mint location\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    strip.text = element_text(size = 9, face = \"bold\"),\n    legend.position = \"right\"\n  )"
  },
  {
    "objectID": "lrr_mint_date.html#add-distance-and-fit-models",
    "href": "lrr_mint_date.html#add-distance-and-fit-models",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "8.1 Add Distance and Fit Models",
    "text": "8.1 Add Distance and Fit Models\n\n\nCode\n# Hex centroid coordinates\nhex_centroids_wgs &lt;- hex_land %&gt;%\n  st_centroid() %&gt;%\n  st_transform(4326)\n\ncent_coords &lt;- st_coordinates(hex_centroids_wgs)\n\nhex_coords &lt;- tibble(\n  hex_id = hex_land$hex_id,\n  cent_lon = cent_coords[, 1],\n  cent_lat = cent_coords[, 2]\n)\n\nrome_coords &lt;- c(12.4964, 41.9028)\n\nhex_coords &lt;- hex_coords %&gt;%\n  mutate(\n    dist_rome_km = sqrt((cent_lon - rome_coords[1])^2 + (cent_lat - rome_coords[2])^2) * 111\n  )\n\nhex_mint_dist &lt;- hex_mint_lrr %&gt;%\n  left_join(hex_coords, by = \"hex_id\")\n\n# Fit binomial by mint period\nmint_distance_models &lt;- hex_mint_dist %&gt;%\n  filter(!is.na(dist_rome_km), !is.na(mint_period)) %&gt;%\n  group_by(mint_period, mint_period_num) %&gt;%\n  nest() %&gt;%\n  mutate(\n    model = map(data, ~tryCatch(\n      glm(\n        cbind(rome_types, non_rome_types) ~ dist_rome_km,\n        family = binomial(link = \"logit\"),\n        data = .x\n      ),\n      error = function(e) NULL\n    )),\n    tidy = map(model, ~if(!is.null(.x)) broom::tidy(.x) else NULL)\n  ) %&gt;%\n  filter(!map_lgl(tidy, is.null)) %&gt;%\n  unnest(tidy) %&gt;%\n  filter(term == \"dist_rome_km\") %&gt;%\n  select(mint_period, mint_period_num, estimate, std.error, p.value) %&gt;%\n  mutate(\n    or_100km = exp(estimate * 100),\n    sig = ifelse(p.value &lt; 0.05, \"*\", \"\")\n  )\n\nkable(mint_distance_models,\n      col.names = c(\"Mint Period\", \"Num\", \"Coefficient\", \"SE\", \"p-value\", \"OR/100km\", \"Sig\"),\n      digits = c(0, 0, 6, 6, 4, 4, 0),\n      caption = \"Distance effect by mint period (* = p &lt; 0.05)\")\n\n\n\nDistance effect by mint period (* = p &lt; 0.05)\n\n\n\n\n\n\n\n\n\n\n\nMint Period\nNum\nCoefficient\nSE\np-value\nOR/100km\nSig\n\n\n\n\n1: Early Republic (pre-150 BCE)\n1\n0.000203\n9.0e-05\n0.0235\n1.0205\n*\n\n\n2: Late Republic I (150-100 BCE)\n2\n0.000067\n8.2e-05\n0.4101\n1.0067\n\n\n\n3: Late Republic II (100-50 BCE)\n3\n-0.000031\n6.2e-05\n0.6219\n0.9969\n\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n4\n-0.000217\n5.5e-05\n0.0001\n0.9785\n*"
  },
  {
    "objectID": "lrr_mint_date.html#compare-distance-effects-tpq-vs-mint-date",
    "href": "lrr_mint_date.html#compare-distance-effects-tpq-vs-mint-date",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "8.2 Compare Distance Effects: TPQ vs Mint Date",
    "text": "8.2 Compare Distance Effects: TPQ vs Mint Date\n\n\nCode\n# Manually add TPQ results from previous analysis\ntpq_distance &lt;- tibble(\n  period_num = c(1, 2, 3, 4),\n  or_100km = c(1.0072, 1.0435, 1.0048, 0.9910),\n  date_type = \"TPQ (deposition)\",\n  sig = c(\"\", \"*\", \"\", \"*\")\n)\n\nmint_distance_compare &lt;- mint_distance_models %&gt;%\n  ungroup() %&gt;%\n  select(mint_period_num, or_100km, sig) %&gt;%\n  rename(period_num = mint_period_num) %&gt;%\n  mutate(date_type = \"Mint Date (production)\")\n\ncompare_distance &lt;- bind_rows(tpq_distance, mint_distance_compare)\n\nggplot(compare_distance, aes(x = period_num, y = or_100km, color = date_type, group = date_type)) +\n  geom_hline(yintercept = 1, linetype = \"dashed\", color = \"grey50\") +\n  geom_line(linewidth = 1.2) +\n  geom_point(aes(shape = sig != \"\"), size = 4) +\n  scale_color_manual(values = c(\"Mint Date (production)\" = \"steelblue\",\n                                 \"TPQ (deposition)\" = \"darkred\")) +\n  scale_shape_manual(values = c(\"FALSE\" = 1, \"TRUE\" = 16), guide = \"none\") +\n  scale_x_continuous(\n    breaks = 1:5,\n    labels = c(\"Early\\nRepublic\", \"Late Rep I\\n150-100\", \"Late Rep II\\n100-50\",\n               \"Triumviral/\\nAugustan\", \"Early\\nImperial\")\n  ) +\n  labs(\n    title = \"Distance Effect: Production vs. Deposition\",\n    subtitle = \"OR &gt; 1 = Rome increases with distance | OR &lt; 1 = Rome decreases with distance\\nFilled points = significant (p &lt; 0.05)\",\n    x = \"Period\",\n    y = \"Odds Ratio per 100 km\",\n    color = NULL\n  ) +\n  theme(legend.position = \"bottom\")"
  },
  {
    "objectID": "lrr_mint_date.html#distance-decay-plots-by-mint-period",
    "href": "lrr_mint_date.html#distance-decay-plots-by-mint-period",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "8.3 Distance-Decay Plots by Mint Period",
    "text": "8.3 Distance-Decay Plots by Mint Period\n\n\nCode\n# Predicted curves\npred_curves_mint &lt;- hex_mint_dist %&gt;%\n  filter(!is.na(dist_rome_km), !is.na(mint_period)) %&gt;%\n  group_by(mint_period, mint_period_num) %&gt;%\n  nest() %&gt;%\n  mutate(\n    model = map(data, ~tryCatch(\n      glm(\n        cbind(rome_types, non_rome_types) ~ dist_rome_km,\n        family = binomial(link = \"logit\"),\n        data = .x\n      ),\n      error = function(e) NULL\n    )),\n    pred_data = map(data, ~tibble(\n      dist_rome_km = seq(0, max(.x$dist_rome_km, na.rm = TRUE), length.out = 100)\n    )),\n    predictions = map2(model, pred_data, ~{\n      if(!is.null(.x)) {\n        mutate(.y, p_rome_pred = predict(.x, newdata = .y, type = \"response\"))\n      } else {\n        mutate(.y, p_rome_pred = NA_real_)\n      }\n    })\n  ) %&gt;%\n  select(mint_period, mint_period_num, predictions) %&gt;%\n  unnest(predictions) %&gt;%\n  filter(!is.na(p_rome_pred))\n\nggplot() +\n  geom_point(\n    data = hex_mint_dist,\n    aes(x = dist_rome_km, y = p_rome, size = total_types),\n    alpha = 0.4,\n    color = \"steelblue\"\n  ) +\n  geom_line(\n    data = pred_curves_mint,\n    aes(x = dist_rome_km, y = p_rome_pred),\n    color = \"darkred\",\n    linewidth = 1\n  ) +\n  facet_wrap(~mint_period, ncol = 3) +\n  scale_y_continuous(labels = scales::percent_format(), limits = c(0.3, 1)) +\n  scale_size_continuous(name = \"Sample size\", range = c(1, 8)) +\n  labs(\n    title = \"Rome Proportion vs. Distance by Mint Period\",\n    subtitle = \"Red line = binomial regression fit\",\n    x = \"Distance from Rome (km)\",\n    y = \"Rome proportion\"\n  ) +\n  theme(\n    legend.position = \"bottom\",\n    strip.text = element_text(size = 9, face = \"bold\")\n  )"
  },
  {
    "objectID": "lrr_mint_date.html#side-by-side-comparison-table",
    "href": "lrr_mint_date.html#side-by-side-comparison-table",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "9.1 Side-by-Side Comparison Table",
    "text": "9.1 Side-by-Side Comparison Table\n\n\nCode\n# Create comprehensive comparison\nsummary_mint &lt;- mint_period_globals %&gt;%\n  select(mint_period, mint_period_num, p_rome_period, total_in_period) %&gt;%\n  rename(\n    period = mint_period,\n    period_num = mint_period_num,\n    p_rome = p_rome_period,\n    n_obs = total_in_period\n  ) %&gt;%\n  left_join(\n    mint_distance_models %&gt;% \n      ungroup() %&gt;% \n      select(mint_period_num, or_100km, sig) %&gt;%\n      rename(period_num = mint_period_num),\n    by = \"period_num\"\n  ) %&gt;%\n  mutate(date_type = \"Mint Date\")\n\n# Note: TPQ comparison would require running that analysis\n# For now, show mint-date summary\n\nkable(summary_mint %&gt;% select(-date_type),\n      col.names = c(\"Period\", \"Num\", \"Rome %\", \"N\", \"OR/100km\", \"Sig\"),\n      digits = c(0, 0, 3, 0, 4, 0),\n      caption = \"Summary: Rome penetration by mint period\")\n\n\n\nSummary: Rome penetration by mint period\n\n\n\n\n\n\n\n\n\n\nPeriod\nNum\nRome %\nN\nOR/100km\nSig\n\n\n\n\n1: Early Republic (pre-150 BCE)\n1\n0.843\n2046\n1.0205\n*\n\n\n2: Late Republic I (150-100 BCE)\n2\n0.972\n11050\n1.0067\n\n\n\n3: Late Republic II (100-50 BCE)\n3\n0.931\n9090\n0.9969\n\n\n\n4: Triumviral/Augustan (50 BCE-14 CE)\n4\n0.574\n3120\n0.9785\n*"
  },
  {
    "objectID": "lrr_mint_date.html#key-insights-for-hmm",
    "href": "lrr_mint_date.html#key-insights-for-hmm",
    "title": "Mint-Date Stratification of Compositional LRR",
    "section": "9.2 Key Insights for HMM",
    "text": "9.2 Key Insights for HMM\n\n\nCode\ncat(\"\n=======================================================\nKEY INSIGHTS FROM MINT-DATE STRATIFICATION\n=======================================================\n\n1. PRODUCTION vs DEPOSITION TIMING\n   - Mint-date distribution peaks earlier than TPQ\n   - Median circulation lag suggests coins traveled ~50+ years before burial\n   - Early Republic coins have longest circulation times\n\n2. ROME PROPORTION TRENDS\n   - Mint-date: Decline begins in Late Republic II (100-50 BCE)\n   - TPQ: Decline appears in Triumviral/Augustan period\n   - The lag suggests ~50-year delay between production and deposition patterns\n\n3. DISTANCE EFFECTS\n   - Early periods: Variable, often non-significant\n   - Later periods: More consistent distance-decay emerges\n   - Sign reversals less pronounced than in TPQ analysis\n\n4. IMPLICATIONS FOR HMM\n   - Regimes detected via TPQ reflect HOARDING BEHAVIOR\n   - Regimes detected via mint-date reflect PRODUCTION/DISTRIBUTION\n   - These may represent different aspects of monetary system state\n   - Consider: HMM on TPQ for crisis detection, mint-date for validation\n\n5. SPATIAL PATTERNS\n   - Early coins found broadly (long circulation = wide distribution)\n   - Later coins show tighter geographic clustering\n   - Consistent with monetary system maturation\n=======================================================\n\")\n\n\n\n=======================================================\nKEY INSIGHTS FROM MINT-DATE STRATIFICATION\n=======================================================\n\n1. PRODUCTION vs DEPOSITION TIMING\n   - Mint-date distribution peaks earlier than TPQ\n   - Median circulation lag suggests coins traveled ~50+ years before burial\n   - Early Republic coins have longest circulation times\n\n2. ROME PROPORTION TRENDS\n   - Mint-date: Decline begins in Late Republic II (100-50 BCE)\n   - TPQ: Decline appears in Triumviral/Augustan period\n   - The lag suggests ~50-year delay between production and deposition patterns\n\n3. DISTANCE EFFECTS\n   - Early periods: Variable, often non-significant\n   - Later periods: More consistent distance-decay emerges\n   - Sign reversals less pronounced than in TPQ analysis\n\n4. IMPLICATIONS FOR HMM\n   - Regimes detected via TPQ reflect HOARDING BEHAVIOR\n   - Regimes detected via mint-date reflect PRODUCTION/DISTRIBUTION\n   - These may represent different aspects of monetary system state\n   - Consider: HMM on TPQ for crisis detection, mint-date for validation\n\n5. SPATIAL PATTERNS\n   - Early coins found broadly (long circulation = wide distribution)\n   - Later coins show tighter geographic clustering\n   - Consistent with monetary system maturation\n======================================================="
  }
]