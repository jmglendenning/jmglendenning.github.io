<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Glendenning">

<title>AE Analysis Code – John Glendenning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a78bc22c21c5275f96438b53095d57b2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="robots" content="noindex, nofollow">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">John Glendenning</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./SPARQL.html"> 
<span class="menu-text">SPARQL</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assignments</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="./assignment01.html">
 <span class="dropdown-text">Assignment 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./comparison01.html">
 <span class="dropdown-text">Shmueli &amp; Breiman Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Lab01.html">
 <span class="dropdown-text">Lab 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Lab02.html">
 <span class="dropdown-text">Lab 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assignment02.html">
 <span class="dropdown-text">Assignment 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare04.pdf">
 <span class="dropdown-text">Class 04 Presentation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare05.html">
 <span class="dropdown-text">Prepare for Class 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare06.html">
 <span class="dropdown-text">Prepare for Class 06</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assignment03.html">
 <span class="dropdown-text">Assignment 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare07.html">
 <span class="dropdown-text">Prepare for Class 07</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assignment04.html">
 <span class="dropdown-text">Assignment 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare08.html">
 <span class="dropdown-text">Prepare for Class 08</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare09.html">
 <span class="dropdown-text">Prepare for Class 09</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assignment05.html">
 <span class="dropdown-text">Assignment 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare10.html">
 <span class="dropdown-text">Prepare for Class 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare11.html">
 <span class="dropdown-text">Prepare for Class 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Prepare12.html">
 <span class="dropdown-text">Prepare for Class 12</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-project" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Project</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-project">    
        <li>
    <a class="dropdown-item" href="./project01.html">
 <span class="dropdown-text">Brainstorming</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./project02.html">
 <span class="dropdown-text">Proposal</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./project03.pdf">
 <span class="dropdown-text">Presentation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./project04.html">
 <span class="dropdown-text">Progress Report I</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./project05.html">
 <span class="dropdown-text">Progress Report II</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./current_code.html">
 <span class="dropdown-text">Previous R Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Finley15.html">
 <span class="dropdown-text">Current Project Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./project06.html">
 <span class="dropdown-text">Presentation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#program-flowchart" id="toc-program-flowchart" class="nav-link active" data-scroll-target="#program-flowchart">Program Flowchart</a></li>
  <li><a href="#python-code-chunks" id="toc-python-code-chunks" class="nav-link" data-scroll-target="#python-code-chunks">Python Code Chunks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AE Analysis Code</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Glendenning </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="program-flowchart" class="level1">
<h1>Program Flowchart</h1>
</section>
<section id="python-code-chunks" class="level1">
<h1>Python Code Chunks</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the following libraries before running</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymupdf4llm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unicodedata</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fitz  <span class="co"># PyMuPDF</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ================================</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization Configuration</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ================================</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment the following for full DataFrame display and styled plots</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.set_option('display.max_columns', None)   # Show all DataFrame columns</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.style.use('seaborn')                     # Use seaborn plot style</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.set_palette('viridis')                   # Set seaborn color palette</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.set(style="whitegrid")                     # Set seaborn background style</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ================================</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Path Configuration</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ================================</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the root folder for the entire project</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> <span class="st">"/Volumes/VirtMach/GIS/AE_Project"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load exclusion words from file</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"/Volumes/VirtMach/GIS/AE_Project/data/exclusion.txt"</span>, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    exclusion_words <span class="op">=</span> {line.strip().lower() <span class="cf">for</span> line <span class="kw">in</span> f <span class="cf">if</span> line.strip()}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace ligatures</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_private_use_char(text):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    replacements <span class="op">=</span> {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Private Use Area ligatures (PUA)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\uf001</span><span class="st">'</span>: <span class="st">'fi'</span>,  <span class="co">#  (U+F001)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\uf002</span><span class="st">'</span>: <span class="st">'fl'</span>,  <span class="co">#  (U+F002)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Standard Unicode ligatures</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb00</span><span class="st">'</span>: <span class="st">'ff'</span>,   <span class="co"># ﬀ (U+FB00)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb01</span><span class="st">'</span>: <span class="st">'fi'</span>,   <span class="co"># ﬁ (U+FB01)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb02</span><span class="st">'</span>: <span class="st">'fl'</span>,   <span class="co"># ﬂ (U+FB02)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb03</span><span class="st">'</span>: <span class="st">'ffi'</span>,  <span class="co"># ﬃ (U+FB03)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb04</span><span class="st">'</span>: <span class="st">'ffl'</span>,  <span class="co"># ﬄ (U+FB04)</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb05</span><span class="st">'</span>: <span class="st">'ft'</span>,   <span class="co"># ﬅ (U+FB05)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="ch">\ufb06</span><span class="st">'</span>: <span class="st">'st'</span>,   <span class="co"># ﬆ (U+FB06)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First, manual replacements for known ligatures</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char, replacement <span class="kw">in</span> replacements.items():</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> text.replace(char, replacement)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Then normalize text (NFKC will separate common ligatures too)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> unicodedata.normalize(<span class="st">'NFKC'</span>, text)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unwanted text from document using regex</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_patterns_from_text(text, patterns):</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">    Removes multiple regex patterns from text.</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co">        text (str): The input document text.</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co">        patterns (list): List of regex strings to remove.</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">        str: Cleaned text.</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pattern <span class="kw">in</span> patterns:</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> re.sub(pattern, <span class="st">''</span>, text, flags<span class="op">=</span>re.MULTILINE).strip()</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Regex patterns for processing to remove from document</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>patterns <span class="op">=</span> [</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'\[\d+\]'</span>,                                <span class="co"># Square bracket numbers like [109]</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'BIBLIOGRAPHY[\s\S]*'</span>,                    <span class="co"># Remove bibliography to end</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'This content downloaded from[\s\S]*?[-]{5,}'</span>  <span class="co"># Footer block with dashed line</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Regex patterns for post-processing (mostly removal)</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>patterns_post <span class="op">=</span> [</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'#{2,}'</span>,                                                   <span class="co"># Remove extra markdown headers</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'\n\n\n'</span>,                                                  <span class="co"># Remove triple newlines</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^.*(Author|Source|Stable URL|Published by|Accessed).*$'</span>,  <span class="co"># Metadata like Author(s), Source</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)JSTOR is a not-for-profit service.*?trusted digital archive\.'</span>,  <span class="co"># JSTOR general statement</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)Your use of the JSTOR archive.*?about.jstor.org/terms'</span>,  <span class="co"># JSTOR terms notice</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^(abstract|introduction|acknowledgements|references|notes)\s*[:]?.*$'</span>,  <span class="co"># Section headers</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^Britannia\s\d+\s\(\d</span><span class="sc">{4}</span><span class="vs">\),\s\d+-\d+$'</span>,                <span class="co"># Journal marking: Britannia</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^Ancient Society\s\d+\s\(\d</span><span class="sc">{4}</span><span class="vs">\),\s\d+-\d+$'</span>,          <span class="co"># Journal marking: Ancient Society</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^Papers of the British School at Rome\s\d+\s\(\d</span><span class="sc">{4}</span><span class="vs">\),\s\d+-\d+$'</span>,  <span class="co"># Journal marking: BSR</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^fig\.?\s?\d+.*$'</span>,                                     <span class="co"># Figure captions</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^table\s?\d+.*$'</span>,                                      <span class="co"># Table captions</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+'</span>,           <span class="co"># Email addresses</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'doi:10\.\d{4,9}/[-._;()/:A-Z0-9]+'</span>,                        <span class="co"># DOIs</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'#{1,6}\s.*$'</span>,                                              <span class="co"># Headers with hash symbols</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Author\(s\):.*$'</span>,                                         <span class="co"># Author lines</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Source:.*$'</span>,                                              <span class="co"># Source lines</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Stable URL:.*$'</span>,                                          <span class="co"># JSTOR stable URLs</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Published by:.*$'</span>,                                        <span class="co"># Published by notices</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^REFERENCES Linked references.*$'</span>,                        <span class="co"># JSTOR reference notices</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^JSTOR is a not-for-profit service.*$'</span>,                   <span class="co"># JSTOR disclaimers</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?&lt;=\w)\d{1,2}(?=\s)'</span>,                                     <span class="co"># Superscript footnote numbers</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Fig\. \d+.*$'</span>,                                            <span class="co"># Figure captions</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^[A-Z\s]{10,}\d{1,4}$'</span>,                                    <span class="co"># Page header/footer</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^[A-Z\s]{10,}$'</span>,                                           <span class="co"># Section titles in all caps</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r'^\s*[-*]\s+.*$',                                           # Bullet points</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^.*(downloaded from|accessed on|terms and conditions).*$'</span>,                 <span class="co"># Download and access lines</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)This content downloaded from .* on .*$'</span>,                               <span class="co"># Common JSTOR download line</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^.*JSTOR.*?(archive|terms|preserve|digitize|not-for-profit).*$'</span>,           <span class="co"># General JSTOR boilerplate</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^.*(Cambridge University Press|Oxford University Press|Johns Hopkins).*$'</span>, <span class="co"># Publisher lines</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^The (Classical Association|Johns Hopkins University Press|.*JSTOR).*$'</span>,   <span class="co"># Institutional names</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^REFERENCES Linked references.*$'</span>,                                         <span class="co"># JSTOR reference links</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Your use of the JSTOR archive.*$'</span>,                                        <span class="co"># JSTOR usage statement</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^For more information about JSTOR.*$'</span>,                                     <span class="co"># JSTOR support lines</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^https?://.*$'</span>,                                                            <span class="co"># Bare links (often in boilerplate)</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^Greece &amp; Rome, Vol\..*$'</span>,                                                 <span class="co"># Journal citation footers</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^\s*doi:\s?10\.\d{4,9}/[-._;()/:A-Z0-9]+$'</span>,                                 <span class="co"># DOIs (variant pattern)</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^.*conference.*(version|paper|audience|presented).*$'</span>,                 <span class="co"># Conference version metadata</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^.*(manuscript|remarks|thanks|acknowledgements|editorial).*$'</span>,         <span class="co"># Dedications and editorial notes</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(?i)^.*(on behalf of the).*$'</span>,                                             <span class="co"># “On behalf of...” organization</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^[=*_~#\-\s]{5,}$'</span>,                                                        <span class="co"># Lines with only symbols (markdown artifacts)</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'^.{0,4}Page \d{1,3}.{0,4}$'</span>,                                               <span class="co"># Page number headers/footers</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Patterns that require a specific replacement (rather than blank removal)</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>patterns_with_replacement <span class="op">=</span> {</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>    <span class="vs">r'(\w+)-\n(\w+)'</span>: <span class="vs">r'\1\2'</span>,  <span class="co"># Merge hyphenated line breaks</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Crawl directory and process all PDFs</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip file groups with existing TXT files</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crawl_and_process_pdfs(root_dir, patterns, skip_existing<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                            input_base<span class="op">=</span><span class="st">"data"</span>, output_base<span class="op">=</span><span class="st">"output/cleaned"</span>, log_base<span class="op">=</span><span class="st">"output/logs"</span>):</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"=== Processing started: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> ===</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construct full path to input data</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    input_path <span class="op">=</span> os.path.join(root_dir, input_base)</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> decade_folder <span class="kw">in</span> os.listdir(input_path):</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>        folder_path <span class="op">=</span> os.path.join(input_path, decade_folder)</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(folder_path):</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Output and log paths</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>        output_dir <span class="op">=</span> os.path.join(output_base, decade_folder)</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>        log_path <span class="op">=</span> os.path.join(log_base, <span class="ss">f"</span><span class="sc">{</span>decade_folder<span class="sc">}</span><span class="ss">_removed_words.txt"</span>)</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        os.makedirs(log_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(log_path, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> log_file:</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(folder_path):</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">file</span>.lower().endswith(<span class="st">".pdf"</span>):</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>                input_pdf <span class="op">=</span> os.path.join(folder_path, <span class="bu">file</span>)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>                out_txt_name <span class="op">=</span> os.path.splitext(<span class="bu">file</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">".txt"</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>                output_txt <span class="op">=</span> os.path.join(output_dir, out_txt_name)</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> skip_existing <span class="kw">and</span> os.path.exists(output_txt):</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> SKIPPED: </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> PROCESSING: </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Step 1: Convert PDF to markdown-style text</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>                md_text <span class="op">=</span> pymupdf4llm.to_markdown(input_pdf)</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Step 2: Clean text</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>                cleaned_text <span class="op">=</span> replace_private_use_char(md_text)</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>                cleaned_text <span class="op">=</span> remove_patterns_from_text(cleaned_text, patterns)</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Step 3: Save cleaned text</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(output_txt, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> out_file:</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>                    out_file.write(cleaned_text)</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Step 4: Log removal (placeholder)</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>                log_file.write(<span class="ss">f"[</span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">] cleaned and saved.</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Processing completed: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> ==="</span>)</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> post_process_txt(root_dir, patterns, replacement_patterns,</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>                     input_base<span class="op">=</span><span class="st">"output/cleaned"</span>, log_base<span class="op">=</span><span class="st">"output/logs"</span>):</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"=== Post-processing started: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> ===</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construct full input path</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    input_path <span class="op">=</span> os.path.join(root_dir, input_base)</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>    os.makedirs(log_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> decade_folder <span class="kw">in</span> os.listdir(input_path):</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>        folder_path <span class="op">=</span> os.path.join(input_path, decade_folder)</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(folder_path):</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>        log_path <span class="op">=</span> os.path.join(log_base, <span class="ss">f"</span><span class="sc">{</span>decade_folder<span class="sc">}</span><span class="ss">_postprocess_log.txt"</span>)</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>        os.makedirs(os.path.dirname(log_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(log_path, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> log_file:</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(folder_path):</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">file</span>.lower().endswith(<span class="st">".txt"</span>):</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>                input_txt <span class="op">=</span> os.path.join(folder_path, <span class="bu">file</span>)</span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Step 1: Read existing text</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(input_txt, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>                        text <span class="op">=</span> f.read()</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="kw">not</span> text.strip():</span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f"[SKIP EMPTY FILE] </span><span class="sc">{</span>input_txt<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>                        log_file.write(<span class="ss">f"[SKIP EMPTY FILE] </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> POST-PROCESSING: </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Step 2: Clean the text</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> pattern <span class="kw">in</span> patterns:</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>                        replacement <span class="op">=</span> replacement_patterns.get(pattern, <span class="st">''</span>)  <span class="co"># Replace or remove</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>                        text <span class="op">=</span> re.sub(pattern, replacement, text)</span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Step 3: Overwrite cleaned text</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(input_txt, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>                        f.write(text)</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>                    log_file.write(<span class="ss">f"[SUCCESS] </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"[ERROR] Could not process file: </span><span class="sc">{</span>input_txt<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Reason: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>                    log_file.write(<span class="ss">f"[ERROR] </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Post-processing completed: </span><span class="sc">{</span>datetime<span class="sc">.</span>now()<span class="sc">}</span><span class="ss"> ==="</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # All python processing skipped</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # This will process PDFs inside ../data/*</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># crawl_and_process_pdfs(</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     root_dir=root,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     input_base="data",</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     patterns=patterns,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     output_base=os.path.join(root, "output/cleaned"),</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     log_base=os.path.join(root, "output/logs")</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Post PDF processing</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # This will process PDFs inside /Volumes/VirtMach/GIS/Corpus/data/*</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># post_process_txt(</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     root_dir=root,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     patterns=patterns_post,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     replacement_patterns=patterns_with_replacement,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     input_base="output/cleaned",</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     log_base="output/logs"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># === Note All Post Processing was done manually</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Set Path to Cleaned Text Files ===</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#text_dir &lt;- "/Volumes/VirtMach/GIS/AE_Project/output/cleaned"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>processed_dir <span class="ot">&lt;-</span> <span class="st">"/Volumes/VirtMach/GIS/AE_Project/output/processed"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)             <span class="co"># NLP corpus + DFM tools  </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)   <span class="co"># Text visualizations  </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)   <span class="co"># Text statistics  </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)  <span class="co"># Text models (e.g., Wordfish)  </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)            <span class="co"># Data wrangling + plots  </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)             <span class="co"># Tidy NLP tools  </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)              <span class="co"># Custom plotting  </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)         <span class="co"># Color palettes  </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)                  <span class="co"># Structural topic models </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(LDAvis)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(servr)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># === Set Paths ===</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>processed_dir <span class="ot">&lt;-</span> <span class="st">"/Volumes/VirtMach/GIS/AE_Project/output/processed"</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>excluded_words <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"/Volumes/VirtMach/GIS/AE_Project/data/exclusion.txt"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>replace_words <span class="ot">&lt;-</span> <span class="st">"/Volumes/VirtMach/GIS/AE_Project/data/replace.txt"</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># === Load Texts from Disk ===</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>file_paths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(processed_dir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.txt$"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>doc_ids <span class="ot">&lt;-</span> <span class="fu">basename</span>(file_paths)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>doc_decades <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(file_paths, <span class="st">"/"</span>), <span class="cf">function</span>(x) x[<span class="fu">length</span>(x) <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>texts <span class="ot">&lt;-</span> <span class="fu">setNames</span>(file_paths, doc_ids)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>texts <span class="ot">&lt;-</span> <span class="fu">sapply</span>(texts, <span class="cf">function</span>(path) <span class="fu">paste</span>(<span class="fu">readLines</span>(path, <span class="at">warn =</span> <span class="cn">FALSE</span>), <span class="at">collapse =</span> <span class="st">" "</span>))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># === Build Corpus and Add Decade ===</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(texts)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(corpus, <span class="st">"decade"</span>) <span class="ot">&lt;-</span> doc_decades</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># === Tokenize and Normalize ===</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>()</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create Replacement Dictionary</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>replace_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(replace_words, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Create named vector</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>replace_words <span class="ot">&lt;-</span> <span class="fu">setNames</span>(replace_df<span class="sc">$</span>replacement, replace_df<span class="sc">$</span>pattern)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Now apply</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">tokens_replace</span>(tokens, <span class="at">pattern =</span> <span class="fu">names</span>(replace_words), <span class="at">replacement =</span> replace_words)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co"># === Normalize target words ===</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">tokens_replace</span>(tokens, <span class="at">pattern =</span> <span class="fu">names</span>(replace_words), <span class="at">replacement =</span> replace_words)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co"># === Remove stopwords and excluded terms ===</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">tokens_remove</span>(tokens, <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), excluded_words))</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co"># === Build and Trim DFM ===</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(tokens)</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(dfm, <span class="at">min_termfreq =</span> <span class="dv">100</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co"># === List all significant words ===</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>significant_words <span class="ot">&lt;-</span> <span class="fu">featnames</span>(dfm)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(significant_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "public"      "political"   "system"      "different"   "urban"      
 [6] "large"       "important"   "legal"       "military"    "state"      
[11] "population"  "society"     "production"  "labor"       "slave"      
[16] "status"      "family"      "men"         "free"        "market"     
[21] "manumission" "law"         "peculium"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Group DFM by decade ===</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List words per decade</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (decade <span class="cf">in</span> <span class="fu">docnames</span>(dfm_decade)) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Significant words for"</span>, decade, <span class="st">"===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  dfm_one <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(dfm_decade, <span class="fu">docnames</span>(dfm_decade) <span class="sc">==</span> decade)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  words <span class="ot">&lt;-</span> <span class="fu">featnames</span>(dfm_one)[<span class="fu">colSums</span>(dfm_one) <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(words, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Significant words for 1970 ===
public
political
system
different
urban
large
important
legal
military
state
population
society
production
labor
slave
status
family
men
free
market
manumission
law
peculium 

=== Significant words for 1980 ===
public
political
system
different
urban
large
important
legal
military
state
population
society
production
labor
slave
status
family
men
free
market
manumission
law
peculium 

=== Significant words for 1990 ===
public
political
system
different
urban
large
important
legal
military
state
population
society
production
labor
slave
status
family
men
free
market
manumission
law
peculium 

=== Significant words for 2000 ===
public
political
system
different
urban
large
important
legal
military
state
population
society
production
labor
slave
status
family
men
free
market
manumission
law
peculium 

=== Significant words for 2010 ===
public
political
system
different
urban
large
important
legal
military
state
population
society
production
labor
slave
status
family
men
free
market
manumission
law
peculium 

=== Significant words for Original ===
public
political
system
different
urban
large
important
legal
military
state
population
society
production
labor
slave
status
family
men
free
market
manumission
law
peculium </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Group DFM by Decade and Plot ===</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(dfm_decade, <span class="at">comparison =</span> <span class="cn">TRUE</span>, <span class="at">max_words =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## === Plot by Decade</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === Loop through each decade and plot ===</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (dec <span class="cf">in</span> <span class="fu">docnames</span>(dfm_decade)) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">textplot_wordcloud</span>(dfm_decade[dec, ],</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">random_order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">rotation =</span> <span class="fl">0.25</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(<span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Top Words in"</span>, dec), <span class="at">line =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Generic lexical dispersion plot</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === Define Target Words ===</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>target_words <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"slave"</span>, <span class="st">"labor"</span>, <span class="st">"freedom"</span>, <span class="st">"law"</span>, <span class="st">"production"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a kwic object (keyword in context) ===</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>kwic_data <span class="ot">&lt;-</span> <span class="fu">kwic</span>(tokens, <span class="at">pattern =</span> target_words)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># === Generate Lexical Dispersion Plot ===</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_xray</span>(kwic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get unique decades from the corpus (not grouped DFM) ===</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>decades <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">docvars</span>(corpus, <span class="st">"decade"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># === Loop over each decade and generate dispersion plot ===</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># === Loop over unique decades and generate dispersion plots ===</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (dec <span class="cf">in</span> <span class="fu">unique</span>(<span class="fu">docvars</span>(corpus, <span class="st">"decade"</span>))) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"📘 Plotting for decade:"</span>, dec, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># === Subset the corpus for just this decade ===</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  corpus_decade <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(corpus, decade <span class="sc">==</span> dec)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># === Tokenize and clean the subset ===</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  tokens_decade <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_decade,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tokens_tolower</span>()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># === Apply spelling replacements and exclusions ===</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  tokens_decade <span class="ot">&lt;-</span> <span class="fu">tokens_replace</span>(tokens_decade, <span class="at">pattern =</span> <span class="fu">names</span>(replace_words), <span class="at">replacement =</span> replace_words)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  tokens_decade <span class="ot">&lt;-</span> <span class="fu">tokens_remove</span>(tokens_decade, <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), excluded_words))</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># === KWIC and plot for 'slave' ===</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  kwic_data <span class="ot">&lt;-</span> <span class="fu">kwic</span>(tokens_decade, <span class="at">pattern =</span> <span class="st">"slave"</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(kwic_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">textplot_xray</span>(kwic_data) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Lexical Dispersion of 'slave' in"</span>, dec)))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"⚠️ No instances of 'slave' in decade:"</span>, dec, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>📘 Plotting for decade: 1970 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📘 Plotting for decade: 1980 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📘 Plotting for decade: 1990 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📘 Plotting for decade: 2000 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📘 Plotting for decade: 2010 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📘 Plotting for decade: Original </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Frequency Plot</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get top N most frequent features ===</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>freq_df <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm, <span class="at">n =</span> <span class="dv">20</span>)  <span class="co"># You can increase n as needed</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot with ggplot2 ===</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(freq_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, frequency), <span class="at">y =</span> frequency)) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 Most Frequent Words"</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Feature"</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Frequency Plot by Decade</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === Group dfm by decade if not already ===</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get top N frequent features per decade ===</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>freq_by_decade <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm_decade, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">groups =</span> <span class="fu">docnames</span>(dfm_decade))  <span class="co"># e.g. top 10</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot with ggplot2, faceted by decade ===</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(freq_by_decade, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_within</span>(feature, frequency, group), </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> frequency, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> group, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span>  <span class="co"># from ggh4x or tidytext</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 Most Frequent Words by Decade"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Feature"</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get frequency grouped by decade ===</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>freq_by_decade <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># === Filter to only the term 'slave' ===</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>freq_slave <span class="ot">&lt;-</span> <span class="fu">subset</span>(freq_by_decade, feature <span class="sc">==</span> <span class="st">"slave"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot ===</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(freq_slave, <span class="fu">aes</span>(<span class="at">x =</span> frequency, <span class="at">y =</span> group)) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'Frequency of "slave" by Decade'</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Get raw frequencies grouped by decade ===</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>freq_by_decade <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Total tokens per decade ===</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>total_tokens <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ntoken</span>(<span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>total_tokens<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">rownames</span>(total_tokens)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(total_tokens)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"total"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Filter only for "slave" ===</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>freq_slave <span class="ot">&lt;-</span> <span class="fu">subset</span>(freq_by_decade, feature <span class="sc">==</span> <span class="st">"slave"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Merge total token counts into frequency data ===</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>freq_slave <span class="ot">&lt;-</span> <span class="fu">merge</span>(freq_slave, total_tokens, <span class="at">by =</span> <span class="st">"group"</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 5: Calculate percentage ===</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>freq_slave<span class="sc">$</span>percent <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> freq_slave<span class="sc">$</span>frequency <span class="sc">/</span> freq_slave<span class="sc">$</span>total</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 6: Plot percentage per decade ===</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(freq_slave, <span class="fu">aes</span>(<span class="at">x =</span> percent, <span class="at">y =</span> group)) <span class="sc">+</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percentage of Tokens"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'Relative Frequency of "slave" by Decade'</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a proportionally weighted dfm grouped by decade ===</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>dfm_weighted_decade <span class="ot">&lt;-</span> <span class="fu">dfm</span>(tokens) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> <span class="fu">docvars</span>(tokens, <span class="st">"decade"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_weight</span>(<span class="at">scheme =</span> <span class="st">"prop"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get top 10 words by relative frequency per decade ===</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>freq_weighted <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm_weighted_decade, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">groups =</span> <span class="fu">docnames</span>(dfm_weighted_decade))</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot: Relative frequency (proportional) by decade ===</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(freq_weighted, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_within</span>(feature, frequency, group),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> frequency)) <span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> group, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Relative frequency (proportion)"</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 Proportional Words by Decade"</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Choose your target decade (as character to match docvars) ===</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>target_decade <span class="ot">&lt;-</span> <span class="st">"1970"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a DFM grouped by decade ===</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute keyness: target vs. all other decades ===</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>tstat_keyness <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_decade, <span class="at">target =</span> target_decade)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the top keyness words for the target decade ===</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_keyness, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Keyness: Top Words in"</span>, target_decade, <span class="st">"vs. Other Decades"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Choose your target decade (as character to match docvars) ===</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>target_decade <span class="ot">&lt;-</span> <span class="st">"1980"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a DFM grouped by decade ===</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute keyness: target vs. all other decades ===</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>tstat_keyness <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_decade, <span class="at">target =</span> target_decade)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the top keyness words for the target decade ===</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_keyness, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Keyness: Top Words in"</span>, target_decade, <span class="st">"vs. Other Decades"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Choose your target decade (as character to match docvars) ===</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>target_decade <span class="ot">&lt;-</span> <span class="st">"1990"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a DFM grouped by decade ===</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute keyness: target vs. all other decades ===</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>tstat_keyness <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_decade, <span class="at">target =</span> target_decade)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the top keyness words for the target decade ===</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_keyness, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Keyness: Top Words in"</span>, target_decade, <span class="st">"vs. Other Decades"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Choose your target decade (as character to match docvars) ===</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>target_decade <span class="ot">&lt;-</span> <span class="st">"2000"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a DFM grouped by decade ===</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute keyness: target vs. all other decades ===</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>tstat_keyness <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_decade, <span class="at">target =</span> target_decade)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the top keyness words for the target decade ===</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_keyness, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Keyness: Top Words in"</span>, target_decade, <span class="st">"vs. Other Decades"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Choose your target decade (as character to match docvars) ===</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>target_decade <span class="ot">&lt;-</span> <span class="st">"2010"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a DFM grouped by decade ===</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute keyness: target vs. all other decades ===</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>tstat_keyness <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_decade, <span class="at">target =</span> target_decade)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the top keyness words for the target decade ===</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_keyness, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Keyness: Top Words in"</span>, target_decade, <span class="st">"vs. Other Decades"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Choose your target decade (as character to match docvars) ===</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>target_decade <span class="ot">&lt;-</span> <span class="st">"Original"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create a DFM grouped by decade ===</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute keyness: target vs. all other decades ===</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>tstat_keyness <span class="ot">&lt;-</span> <span class="fu">textstat_keyness</span>(dfm_decade, <span class="at">target =</span> target_decade)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the top keyness words for the target decade ===</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_keyness</span>(tstat_keyness, <span class="at">n =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Keyness: Top Words in"</span>, target_decade, <span class="st">"vs. Other Decades"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Create dfm grouped by decade (or another label)</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>dfm_ws <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Assign reference scores (NA = unknown group)</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Match these to the docnames(dfm_ws) order</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>ref_labels <span class="ot">&lt;-</span> <span class="fu">docnames</span>(dfm_ws)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>refscores <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ref_labels <span class="sc">==</span> <span class="st">"Original"</span>, <span class="dv">1</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(ref_labels <span class="sc">==</span> <span class="st">"1970"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Fit Wordscore model</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>ws_model <span class="ot">&lt;-</span> <span class="fu">textmodel_wordscores</span>(dfm_ws, <span class="at">y =</span> refscores, <span class="at">smooth =</span> <span class="dv">1</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Plot estimated word positions</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(ws_model,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted =</span> <span class="fu">c</span>(<span class="st">"slave"</span>),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted_color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Word Positions Based on Wordscore Model - 1970"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Create dfm grouped by decade (or another label)</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>dfm_ws <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Assign reference scores (NA = unknown group)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Match these to the docnames(dfm_ws) order</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>ref_labels <span class="ot">&lt;-</span> <span class="fu">docnames</span>(dfm_ws)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>refscores <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ref_labels <span class="sc">==</span> <span class="st">"Original"</span>, <span class="dv">1</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(ref_labels <span class="sc">==</span> <span class="st">"2010"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Fit Wordscore model</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>ws_model <span class="ot">&lt;-</span> <span class="fu">textmodel_wordscores</span>(dfm_ws, <span class="at">y =</span> refscores, <span class="at">smooth =</span> <span class="dv">1</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Plot estimated word positions</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(ws_model,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted =</span> <span class="fu">c</span>(<span class="st">"slave"</span>),</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted_color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Word Positions Based on Wordscore Model - Original"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === 1. Create grouped DFM and wordscore model</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>dfm_decade <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Hardcoded decades: label one as +1, one as -1; rest are neutral (NA)</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ref_labels <span class="ot">&lt;-</span> <span class="fu">docnames</span>(dfm_decade)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>refscores <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ref_labels <span class="sc">==</span> <span class="st">"Original"</span>, <span class="dv">1</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(ref_labels <span class="sc">==</span> <span class="st">"2010"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the wordscore model</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>ws_model <span class="ot">&lt;-</span> <span class="fu">textmodel_wordscores</span>(dfm_decade, <span class="at">y =</span> refscores, <span class="at">smooth =</span> <span class="dv">1</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># === 2. Get top 10 words by frequency in each of the selected decades</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>selected_decades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Original"</span>, </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"1970"</span>, </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"1980"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"1990"</span>, </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"2000"</span>, </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"2010"</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>dfm_tokens <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(dfm, <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>top_words_by_decade <span class="ot">&lt;-</span> <span class="fu">lapply</span>(selected_decades, <span class="cf">function</span>(dec) {</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  freq <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm_tokens[dec, ], <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  freq<span class="sc">$</span>decade <span class="ot">&lt;-</span> dec</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(freq[, <span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"decade"</span>)])</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>top_words <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(top_words_by_decade)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co"># === 3. Extract word scores and frequencies from model and dfm</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>ws_scores <span class="ot">&lt;-</span> <span class="fu">coef</span>(ws_model)  <span class="co"># Named vector of word scores</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>word_freqs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(dfm_decade)  <span class="co"># total term frequency across all decades</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>ws_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">feature =</span> <span class="fu">names</span>(ws_scores),</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> ws_scores,</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> word_freqs[<span class="fu">names</span>(ws_scores)],</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co"># === 4. Join to top_words for plotting</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(top_words, ws_data, <span class="at">by =</span> <span class="st">"feature"</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="co"># === 5. Plot with ggplot2</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> score, <span class="at">y =</span> <span class="fu">log</span>(freq), <span class="at">label =</span> feature, <span class="at">color =</span> decade)) <span class="sc">+</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Wordscore Positions of Top Words by Decade"</span>,</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Word score (Original → 2010)"</span>,</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Log Word Frequency"</span>) <span class="sc">+</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Original"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"1970"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"1980"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"1990"</span> <span class="ot">=</span> <span class="st">"pink"</span>,</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"2000"</span> <span class="ot">=</span> <span class="st">"purple"</span>,</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"2010"</span> <span class="ot">=</span> <span class="st">"cornflowerblue"</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>                                ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Use full (ungrouped) dfm for document-level prediction</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>dfm_pred <span class="ot">&lt;-</span> <span class="fu">dfm</span>(tokens)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Create reference scores (some known, some unknown)</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, assign Original = 1, 2010 = -1, others = NA</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>ref_decades <span class="ot">&lt;-</span> <span class="fu">docvars</span>(dfm_pred, <span class="st">"decade"</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>refscores <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ref_decades <span class="sc">==</span> <span class="st">"Original"</span>, <span class="dv">1</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ifelse</span>(ref_decades <span class="sc">==</span> <span class="st">"2010"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Fit Wordscore model using known labels</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>tmod_ws <span class="ot">&lt;-</span> <span class="fu">textmodel_wordscores</span>(dfm_pred, <span class="at">y =</span> refscores, <span class="at">smooth =</span> <span class="dv">1</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Predict document positions</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>pred_ws <span class="ot">&lt;-</span> <span class="fu">predict</span>(tmod_ws, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 5: Plot predicted document positions by decade</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(pred_ws, <span class="at">margin =</span> <span class="st">"documents"</span>, <span class="at">groups =</span> ref_decades) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted Document Positions (Wordscore Model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Optional: Apply LBG rescaling and plot</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>pred_lbg <span class="ot">&lt;-</span> <span class="fu">predict</span>(tmod_ws, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">rescaling =</span> <span class="st">"lbg"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(pred_lbg, <span class="at">margin =</span> <span class="st">"documents"</span>, <span class="at">groups =</span> ref_decades) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted Document Positions (LBG Rescaled)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">########</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Predict positions</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>pred_ws <span class="ot">&lt;-</span> <span class="fu">predict</span>(tmod_ws, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Convert to data frame</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">docname =</span> <span class="fu">names</span>(pred_ws<span class="sc">$</span>fit),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> pred_ws<span class="sc">$</span>fit,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">se =</span> pred_ws<span class="sc">$</span>se.fit,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Add decade info from docvars</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>decade <span class="ot">&lt;-</span> <span class="fu">docvars</span>(dfm_pred, <span class="st">"decade"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Sort by decade</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>pred_df_sorted <span class="ot">&lt;-</span> pred_df[<span class="fu">order</span>(pred_df<span class="sc">$</span>decade), ]</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 5: View</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pred_df_sorted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                        docname
Crawford-PublicBuildingRome-1977.txt                       Crawford-PublicBuildingRome-1977.txt
Konstan-MARXISMROMANSLAVERY-1975.txt                       Konstan-MARXISMROMANSLAVERY-1975.txt
MacMullen-LateRomanSlavery-1987.txt                         MacMullen-LateRomanSlavery-1987.txt
Millar-CondemnationHardLabour-1984.txt                   Millar-CondemnationHardLabour-1984.txt
Saller-TombstonesRomanFamily-1984.txt                     Saller-TombstonesRomanFamily-1984.txt
Erdkamp-AgricultureUnderemploymentCost-1999.txt Erdkamp-AgricultureUnderemploymentCost-1999.txt
MEIKLE-MODERNISMECONOMICSANCIENT-1995.txt             MEIKLE-MODERNISMECONOMICSANCIENT-1995.txt
North-PoliticsAristocracyRoman-1990.txt                 North-PoliticsAristocracyRoman-1990.txt
EBERLE-LandedTradersTrading-2017.txt                       EBERLE-LandedTradersTrading-2017.txt
Morley-TransformationItaly22528-2001.txt               Morley-TransformationItaly22528-2001.txt
Scheidel_Human_Mobility_2005.txt                               Scheidel_Human_Mobility_2005.txt
Scheidel_Real_Slave_Prices_2005.txt                         Scheidel_Real_Slave_Prices_2005.txt
Lewis_Varro_Think_Slaves_2013.txt                             Lewis_Varro_Think_Slaves_2013.txt
Roth_Peculium_Freedom_Citizenship_2010.txt           Roth_Peculium_Freedom_Citizenship_2010.txt
WARRY-LegionaryTileProduction-2010.txt                   WARRY-LegionaryTileProduction-2010.txt
The Ancient Economy.txt                                                 The Ancient Economy.txt
                                                      score          se
Crawford-PublicBuildingRome-1977.txt            -0.38056267 0.007701757
Konstan-MARXISMROMANSLAVERY-1975.txt            -0.19461924 0.007549413
MacMullen-LateRomanSlavery-1987.txt             -0.25959783 0.007277434
Millar-CondemnationHardLabour-1984.txt          -0.36934499 0.005512482
Saller-TombstonesRomanFamily-1984.txt           -0.33963450 0.005490632
Erdkamp-AgricultureUnderemploymentCost-1999.txt -0.19285174 0.007853351
MEIKLE-MODERNISMECONOMICSANCIENT-1995.txt       -0.25740987 0.012050471
North-PoliticsAristocracyRoman-1990.txt         -0.27139985 0.010097986
EBERLE-LandedTradersTrading-2017.txt            -0.32895135 0.006673125
Morley-TransformationItaly22528-2001.txt        -0.23347174 0.007862567
Scheidel_Human_Mobility_2005.txt                -0.26999329 0.007042409
Scheidel_Real_Slave_Prices_2005.txt             -0.30134971 0.008942180
Lewis_Varro_Think_Slaves_2013.txt               -0.55727712 0.008041155
Roth_Peculium_Freedom_Citizenship_2010.txt      -0.55534229 0.004635440
WARRY-LegionaryTileProduction-2010.txt          -0.67194534 0.005215235
The Ancient Economy.txt                         -0.08776669 0.002184711
                                                  decade
Crawford-PublicBuildingRome-1977.txt                1970
Konstan-MARXISMROMANSLAVERY-1975.txt                1970
MacMullen-LateRomanSlavery-1987.txt                 1980
Millar-CondemnationHardLabour-1984.txt              1980
Saller-TombstonesRomanFamily-1984.txt               1980
Erdkamp-AgricultureUnderemploymentCost-1999.txt     1990
MEIKLE-MODERNISMECONOMICSANCIENT-1995.txt           1990
North-PoliticsAristocracyRoman-1990.txt             1990
EBERLE-LandedTradersTrading-2017.txt                2000
Morley-TransformationItaly22528-2001.txt            2000
Scheidel_Human_Mobility_2005.txt                    2000
Scheidel_Real_Slave_Prices_2005.txt                 2000
Lewis_Varro_Think_Slaves_2013.txt                   2010
Roth_Peculium_Freedom_Citizenship_2010.txt          2010
WARRY-LegionaryTileProduction-2010.txt              2010
The Ancient Economy.txt                         Original</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pred_df_sorted <span class="ot">&lt;-</span> pred_df_sorted <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">docname =</span> <span class="fu">fct_reorder</span>(docname, score))  <span class="co"># requires forcats from tidyverse</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_df_sorted, <span class="fu">aes</span>(<span class="at">x =</span> docname, <span class="at">y =</span> score, <span class="at">color =</span> decade)) <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> score <span class="sc">-</span> se, <span class="at">ymax =</span> score <span class="sc">+</span> se), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted Document Positions by Decade"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Document"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Score"</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Top words by decade ===</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>selected_decades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"1970"</span>, <span class="st">"1980"</span>, <span class="st">"1990"</span>, <span class="st">"2000"</span>, <span class="st">"2010"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>top_words_by_decade <span class="ot">&lt;-</span> <span class="fu">lapply</span>(selected_decades, <span class="cf">function</span>(dec) {</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  freq <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfm_decade[dec, ], <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  freq<span class="sc">$</span>decade <span class="ot">&lt;-</span> dec</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  freq[, <span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"decade"</span>)]</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>top_words <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(top_words_by_decade)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Extract word scores and total frequency ===</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>ws_scores <span class="ot">&lt;-</span> <span class="fu">coef</span>(ws_model)  <span class="co"># from your model</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>word_freqs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(dfm_decade)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>ws_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">feature =</span> <span class="fu">names</span>(ws_scores),</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> ws_scores,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> word_freqs[<span class="fu">names</span>(ws_scores)],</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Join top words with scores and frequency</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(top_words, ws_data, <span class="at">by =</span> <span class="st">"feature"</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Plot — annotate Wordscores by Decade</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> score, <span class="at">y =</span> <span class="fu">log</span>(freq), <span class="at">label =</span> feature, <span class="at">color =</span> decade)) <span class="sc">+</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top Words by Decade in Wordscores Space"</span>,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Word Score (Original → 2010)"</span>,</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log Frequency"</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original"</span> <span class="ot">=</span> <span class="st">"magenta"</span>,</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1970"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1980"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1990"</span> <span class="ot">=</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2000"</span> <span class="ot">=</span> <span class="st">"blue"</span>,</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2010"</span> <span class="ot">=</span> <span class="st">"black"</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert decade to factor to ensure proper order</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>pred_df_sorted<span class="sc">$</span>decade <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_df_sorted<span class="sc">$</span>decade, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"1970"</span>, <span class="st">"1980"</span>, <span class="st">"1990"</span>, <span class="st">"2000"</span>, <span class="st">"2010"</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a combined label for better readability</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>pred_df_sorted<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(pred_df_sorted<span class="sc">$</span>decade, pred_df_sorted<span class="sc">$</span>docname, <span class="at">sep =</span> <span class="st">" — "</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort documents by decade (y-axis ordering)</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>pred_df_sorted<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_df_sorted<span class="sc">$</span>label, </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> pred_df_sorted<span class="sc">$</span>label[<span class="fu">order</span>(pred_df_sorted<span class="sc">$</span>decade)])</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_df_sorted, <span class="fu">aes</span>(<span class="at">x =</span> score, <span class="at">y =</span> label, <span class="at">color =</span> decade)) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> score <span class="sc">-</span> se, <span class="at">xmax =</span> score <span class="sc">+</span> se), <span class="at">height =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted Document Positions Grouped by Decade"</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predicted Score"</span>,</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Document"</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)  <span class="co"># or use your custom colors</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Choose two reference documents (by row index in dfm)</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Here: use one Original-era and one from 2010 as anchors</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)  <span class="co"># use this to find index numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1970"     "1970"     "1980"     "1980"     "1980"     "1990"    
 [7] "1990"     "1990"     "2000"     "2000"     "2000"     "2000"    
[13] "2010"     "2010"     "2010"     "Original"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">docnames</span>(dfm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Crawford-PublicBuildingRome-1977.txt"           
 [2] "Konstan-MARXISMROMANSLAVERY-1975.txt"           
 [3] "MacMullen-LateRomanSlavery-1987.txt"            
 [4] "Millar-CondemnationHardLabour-1984.txt"         
 [5] "Saller-TombstonesRomanFamily-1984.txt"          
 [6] "Erdkamp-AgricultureUnderemploymentCost-1999.txt"
 [7] "MEIKLE-MODERNISMECONOMICSANCIENT-1995.txt"      
 [8] "North-PoliticsAristocracyRoman-1990.txt"        
 [9] "EBERLE-LandedTradersTrading-2017.txt"           
[10] "Morley-TransformationItaly22528-2001.txt"       
[11] "Scheidel_Human_Mobility_2005.txt"               
[12] "Scheidel_Real_Slave_Prices_2005.txt"            
[13] "Lewis_Varro_Think_Slaves_2013.txt"              
[14] "Roth_Peculium_Freedom_Citizenship_2010.txt"     
[15] "WARRY-LegionaryTileProduction-2010.txt"         
[16] "The Ancient Economy.txt"                        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices for a specific decade</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get integer indices for reference documents ===</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>index_first <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>) <span class="sc">==</span> <span class="st">"Original"</span>)[<span class="dv">1</span>]  <span class="co"># First match for "Original"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>index_second <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>) <span class="sc">==</span> <span class="st">"1990"</span>)[<span class="dv">1</span>]     <span class="co"># First match for "1980"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Fit the Wordfish model ===</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>tmod_wf <span class="ot">&lt;-</span> <span class="fu">textmodel_wordfish</span>(dfm, <span class="at">dir =</span> <span class="fu">c</span>(index_first, index_second))</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Plot word positions</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(tmod_wf, </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">margin =</span> <span class="st">"features"</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted =</span> <span class="fu">c</span>(<span class="st">"slave"</span>, <span class="st">"market"</span>, <span class="st">"law"</span>, <span class="st">"labor"</span>, <span class="st">"family"</span>),</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">highlighted_color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Word Positions from Wordfish Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">########</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get the index for an "Original" document ===</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>original_index <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>) <span class="sc">==</span> <span class="st">"Original"</span>)[<span class="dv">1</span>]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Get all unique decades excluding "Original" ===</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>other_decades <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(<span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)), <span class="st">"Original"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Define highlighted terms ===</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>highlighted_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"slave"</span>, <span class="st">"market"</span>, <span class="st">"law"</span>, <span class="st">"labor"</span>, <span class="st">"family"</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Loop through decades and plot Wordfish word positions ===</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (decade <span class="cf">in</span> other_decades) {</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get index of one document from this decade</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  comp_index <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>) <span class="sc">==</span> decade)[<span class="dv">1</span>]</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit Wordfish model</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  tmod_wf <span class="ot">&lt;-</span> <span class="fu">textmodel_wordfish</span>(dfm, <span class="at">dir =</span> <span class="fu">c</span>(original_index, comp_index))</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot word positions</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">textplot_scale1d</span>(</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    tmod_wf,</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="st">"features"</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlighted =</span> highlighted_terms,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlighted_color =</span> <span class="st">"red"</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Word Positions: Original vs"</span>, decade))</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plot)</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Run Correspondence Analysis on your DFM</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>tmod_ca <span class="ot">&lt;-</span> <span class="fu">textmodel_ca</span>(dfm)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot document positions grouped by decade</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(tmod_ca, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">margin =</span> <span class="st">"documents"</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">groups =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)) <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Correspondence Analysis: Document Positions by Decade"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract document coordinates from CA model</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ca_docs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc_id =</span> <span class="fu">docnames</span>(dfm),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">CA1 =</span> tmod_ca<span class="sc">$</span>rowcoord[, <span class="dv">1</span>],  <span class="co"># First CA dimension</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">CA2 =</span> tmod_ca<span class="sc">$</span>rowcoord[, <span class="dv">2</span>],  <span class="co"># Second CA dimension</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">decade =</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom ggplot</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ca_docs, <span class="fu">aes</span>(<span class="at">x =</span> CA1, <span class="at">y =</span> CA2, <span class="at">color =</span> decade)) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> doc_id), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add document labels</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"2D Correspondence Analysis: Documents Colored by Decade"</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"CA1"</span>, <span class="at">y =</span> <span class="st">"CA2"</span>, <span class="at">color =</span> <span class="st">"Decade"</span>) <span class="sc">+</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume dfm is already created and trimmed</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (based on your previous workflow)</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Run LSA model ===</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>lsa_model <span class="ot">&lt;-</span> <span class="fu">textmodel_lsa</span>(dfm, <span class="at">nd =</span> <span class="dv">2</span>)  <span class="co"># reduce to 2D for plotting</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Extract coordinates for documents ===</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>lsa_coords <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lsa_model<span class="sc">$</span>docs[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>lsa_coords<span class="sc">$</span>doc <span class="ot">&lt;-</span> <span class="fu">docnames</span>(dfm)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>lsa_coords<span class="sc">$</span>decade <span class="ot">&lt;-</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Plot documents in LSA space ===</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lsa_coords, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">label =</span> doc, <span class="at">color =</span> decade)) <span class="sc">+</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"LSA: Document Positions in Semantic Space"</span>,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Dimension 1 (LSA)"</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Dimension 2 (LSA)"</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">########</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume dfm is already built and trimmed</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run LSA with 2 dimensions</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>lsa_model <span class="ot">&lt;-</span> <span class="fu">textmodel_lsa</span>(dfm, <span class="at">nd =</span> <span class="dv">2</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># === Extract word (feature) coordinates ===</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>lsa_terms <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lsa_model<span class="sc">$</span>features[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>lsa_terms<span class="sc">$</span>term <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lsa_terms)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the terms ===</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lsa_terms, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">label =</span> term)) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"LSA: Term Positions in Semantic Space"</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Dimension 1 (LSA)"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Dimension 2 (LSA)"</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Could subset with</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#top_terms &lt;- names(topfeatures(dfm, 50))</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#lsa_terms &lt;- subset(lsa_terms, term %in% top_terms)</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># === Run LSA on the dfm ===</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>lsa_model <span class="ot">&lt;-</span> <span class="fu">textmodel_lsa</span>(dfm, <span class="at">nd =</span> <span class="dv">2</span>)  <span class="co"># 2D for plotting</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># === Extract document coordinates in LSA space ===</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>lsa_docs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lsa_model<span class="sc">$</span>docs[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>lsa_docs<span class="sc">$</span>doc <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lsa_docs)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Run k-means clustering (e.g., k = 3)</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(lsa_docs[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">centers =</span> <span class="dv">3</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster assignments to dataframe</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>lsa_docs<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(kmeans_result<span class="sc">$</span>cluster)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, add decade metadata</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>lsa_docs<span class="sc">$</span>decade <span class="ot">&lt;-</span> <span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot clustered documents ===</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lsa_docs, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">label =</span> doc, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"K-Means Clustering of Documents in LSA Space"</span>,</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"LSA Dimension 1"</span>,</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"LSA Dimension 2"</span>,</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Cluster"</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: LSA model (2D is enough for plotting but not for clustering)</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>lsa_model <span class="ot">&lt;-</span> <span class="fu">textmodel_lsa</span>(dfm, <span class="at">nd =</span> <span class="dv">10</span>)  <span class="co"># Use more dimensions for better structure</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>lsa_docs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lsa_model<span class="sc">$</span>docs)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>lsa_docs<span class="sc">$</span>doc <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lsa_docs)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Compute WSS for 1 to 10 clusters</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(lsa_docs[, <span class="sc">-</span><span class="fu">ncol</span>(lsa_docs)], <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">10</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Plot the Elbow</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>elbow_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elbow_df, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Elbow Method for Optimal K"</span>,</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters (k)"</span>,</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Within-Cluster Sum of Squares"</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-45.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose a fixed number of clusters, say k = 3</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(lsa_docs[, <span class="sc">-</span><span class="fu">ncol</span>(lsa_docs)], <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>sil <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(km<span class="sc">$</span>cluster, <span class="fu">dist</span>(lsa_docs[, <span class="sc">-</span><span class="fu">ncol</span>(lsa_docs)]))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot silhouette width</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sil, <span class="at">border =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-46.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(lsa_docs[, <span class="sc">-</span><span class="fu">ncol</span>(lsa_docs)])</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dendrogram</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">labels =</span> lsa_docs<span class="sc">$</span>doc, <span class="at">main =</span> <span class="st">"Hierarchical Clustering Dendrogram"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut into k clusters</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(hc, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">border =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-47.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dfm to STM format</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>stm_input <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm, <span class="at">to =</span> <span class="st">"stm"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare metadata (decade in this case)</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>meta_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">decade =</span> <span class="fu">as.factor</span>(<span class="fu">docvars</span>(dfm, <span class="st">"decade"</span>)))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit STM with 10 topics (adjust K as needed)</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>stm_model <span class="ot">&lt;-</span> <span class="fu">stm</span>(</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">documents =</span> stm_input<span class="sc">$</span>documents,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">vocab =</span> stm_input<span class="sc">$</span>vocab,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> meta_data,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">10</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">prevalence =</span> <span class="sc">~</span> decade,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.em.its =</span> <span class="dv">75</span>,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">init.type =</span> <span class="st">"Spectral"</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ..........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.376) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.347, relative change = 1.213e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.338, relative change = 3.831e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.333, relative change = 2.306e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.328, relative change = 1.786e-03) 
Topic 1: slave, free, urban, legal, system 
 Topic 2: family, important, society, urban, different 
 Topic 3: political, system, important, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, law, status, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.325, relative change = 1.559e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.322, relative change = 1.256e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.318, relative change = 1.520e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.314, relative change = 1.944e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.312, relative change = 8.988e-04) 
Topic 1: slave, free, legal, large, system 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, law, status, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.311, relative change = 2.843e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.311, relative change = 1.391e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.311, relative change = 9.380e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.310, relative change = 7.195e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.310, relative change = 5.735e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.310, relative change = 5.115e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.310, relative change = 4.374e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.310, relative change = 3.884e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.310, relative change = 3.501e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.310, relative change = 3.162e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.310, relative change = 2.863e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.310, relative change = 2.596e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.310, relative change = 2.423e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.310, relative change = 2.169e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.310, relative change = 1.952e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.310, relative change = 1.829e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.309, relative change = 1.645e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.309, relative change = 1.481e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.309, relative change = 1.407e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.309, relative change = 1.256e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.309, relative change = 1.181e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.309, relative change = 1.041e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of topic prevalence</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stm_model, <span class="at">type =</span> <span class="st">"summary"</span>, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-48.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Topic correlation map</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stm_model, <span class="at">type =</span> <span class="st">"labels"</span>, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-49.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate effect of decade on topic prevalence</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>prep <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">~</span> decade, stm_model, <span class="at">meta =</span> meta_data)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot effect for a topic</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prep, <span class="at">covariate =</span> <span class="st">"decade"</span>, <span class="at">topics =</span> <span class="dv">1</span>, </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">model =</span> stm_model, <span class="at">method =</span> <span class="st">"difference"</span>, </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">cov.value1 =</span> <span class="st">"2010"</span>, <span class="at">cov.value2 =</span> <span class="st">"Original"</span>, </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Difference in Topic Prevalence"</span>, </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Topic 1: 2010 vs Original"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-50.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dfm to STM format</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(dfm, <span class="at">min_termfreq =</span> <span class="dv">5</span>)  <span class="co"># Optional: reduce noise</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>stm_input <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm, <span class="at">to =</span> <span class="st">"stm"</span>)   <span class="co"># Converts to list with $documents, $vocab, $meta</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune number of topics</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>k_result <span class="ot">&lt;-</span> <span class="fu">searchK</span>(<span class="at">documents =</span> stm_input<span class="sc">$</span>documents,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">vocab =</span> stm_input<span class="sc">$</span>vocab,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> stm_input<span class="sc">$</span>meta,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .....
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.535) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.505, relative change = 1.154e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.489, relative change = 6.472e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.472, relative change = 6.913e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.456, relative change = 6.329e-03) 
Topic 1: slave, free, labor, men, society 
 Topic 2: family, military, different, men, urban 
 Topic 3: political, system, large, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, different, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.446, relative change = 4.156e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.439, relative change = 2.994e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.434, relative change = 2.071e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.430, relative change = 1.428e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.428, relative change = 1.020e-03) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, population 
 Topic 3: political, public, men, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, different, society 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.426, relative change = 7.662e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.424, relative change = 5.988e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.423, relative change = 4.798e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.422, relative change = 3.901e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.422, relative change = 3.173e-04) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, public, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.421, relative change = 2.558e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.421, relative change = 2.039e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.420, relative change = 1.629e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.420, relative change = 1.316e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.420, relative change = 1.082e-04) 
Topic 1: slave, free, labor, men, system 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.419, relative change = 9.052e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.419, relative change = 7.440e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.419, relative change = 6.574e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.419, relative change = 5.374e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.419, relative change = 4.495e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.419, relative change = 3.890e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.419, relative change = 3.131e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.419, relative change = 2.623e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.418, relative change = 2.134e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.418, relative change = 1.820e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.418, relative change = 1.469e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.418, relative change = 1.278e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.418, relative change = 1.069e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.418, relative change = 1.073e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.418, relative change = 1.254e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.418, relative change = 1.398e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.418, relative change = 1.920e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.418, relative change = 2.294e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.418, relative change = 3.007e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.418, relative change = 2.857e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.418, relative change = 2.386e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.418, relative change = 2.240e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.418, relative change = 1.810e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.418, relative change = 1.613e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.418, relative change = 1.442e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.418, relative change = 1.449e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.418, relative change = 1.217e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.418, relative change = 1.146e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.418, relative change = 1.131e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ..........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.366) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.341, relative change = 1.073e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.333, relative change = 3.222e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.329, relative change = 1.699e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.327, relative change = 1.041e-03) 
Topic 1: slave, free, urban, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, law, status, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.325, relative change = 6.511e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.324, relative change = 4.197e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.324, relative change = 2.878e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.323, relative change = 2.092e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.323, relative change = 1.634e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.322, relative change = 1.366e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.322, relative change = 1.207e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.322, relative change = 1.138e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.322, relative change = 1.117e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.321, relative change = 1.106e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.321, relative change = 1.070e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.321, relative change = 9.875e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.321, relative change = 8.727e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.320, relative change = 7.816e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.320, relative change = 7.526e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.320, relative change = 7.718e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.320, relative change = 8.284e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.320, relative change = 8.962e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.319, relative change = 9.496e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.319, relative change = 1.012e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.319, relative change = 1.025e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.319, relative change = 1.021e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.318, relative change = 9.775e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.318, relative change = 9.334e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.318, relative change = 9.613e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.318, relative change = 1.208e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.317, relative change = 2.079e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.316, relative change = 3.614e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.316, relative change = 3.509e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.315, relative change = 1.363e-04) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.315, relative change = 5.982e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.315, relative change = 4.945e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.315, relative change = 4.621e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.315, relative change = 4.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.315, relative change = 4.417e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.315, relative change = 4.205e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.315, relative change = 3.807e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.314, relative change = 3.490e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.314, relative change = 3.042e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.314, relative change = 2.561e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.314, relative change = 2.118e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.314, relative change = 1.775e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.314, relative change = 1.424e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.314, relative change = 1.212e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.314, relative change = 1.037e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ...............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.351) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.321, relative change = 1.267e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.313, relative change = 3.566e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.309, relative change = 1.736e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.307, relative change = 1.005e-03) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, status, legal 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.305, relative change = 6.113e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.304, relative change = 3.925e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.304, relative change = 2.699e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.303, relative change = 1.978e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.303, relative change = 1.531e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.303, relative change = 1.228e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.302, relative change = 1.020e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.302, relative change = 8.614e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.302, relative change = 7.350e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.302, relative change = 6.409e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.302, relative change = 5.702e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.302, relative change = 5.064e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.302, relative change = 4.528e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.301, relative change = 4.137e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.301, relative change = 3.815e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.301, relative change = 3.494e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.301, relative change = 3.290e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.301, relative change = 3.091e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.301, relative change = 2.888e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.301, relative change = 2.758e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.301, relative change = 2.735e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.301, relative change = 2.624e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.301, relative change = 2.592e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.301, relative change = 2.518e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.301, relative change = 2.501e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, important, law, free 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.301, relative change = 2.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.301, relative change = 2.484e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.301, relative change = 2.520e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.301, relative change = 2.435e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.300, relative change = 2.533e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, important, law, free 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.300, relative change = 2.530e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.300, relative change = 2.511e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.300, relative change = 2.508e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.300, relative change = 2.480e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.300, relative change = 2.525e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, law, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.300, relative change = 2.488e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.300, relative change = 2.574e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.300, relative change = 2.526e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.300, relative change = 2.688e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.300, relative change = 2.938e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, law, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.300, relative change = 3.814e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.300, relative change = 5.615e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.299, relative change = 8.887e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.299, relative change = 1.244e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.299, relative change = 1.196e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, important, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, law, state, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.299, relative change = 7.138e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.299, relative change = 3.590e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.299, relative change = 2.159e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.299, relative change = 1.723e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.299, relative change = 1.530e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, state 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, law, state, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.298, relative change = 1.353e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 57 (approx. per word bound = -2.298, relative change = 1.255e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 58 (approx. per word bound = -2.298, relative change = 1.108e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 59 (approx. per word bound = -2.298, relative change = 1.071e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ....................
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.360) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.320, relative change = 1.695e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.309, relative change = 4.904e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.304, relative change = 2.314e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.301, relative change = 1.342e-03) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, legal, free, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.299, relative change = 8.369e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.297, relative change = 5.440e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.297, relative change = 3.703e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.296, relative change = 2.640e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.295, relative change = 2.022e-04) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, legal, free, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.295, relative change = 1.575e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.295, relative change = 1.267e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.295, relative change = 1.067e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.294, relative change = 8.856e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.294, relative change = 7.600e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.294, relative change = 6.628e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.294, relative change = 5.864e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.294, relative change = 5.110e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.294, relative change = 4.605e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.294, relative change = 4.158e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.294, relative change = 3.713e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.293, relative change = 3.406e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.293, relative change = 3.111e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.293, relative change = 2.834e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.293, relative change = 2.573e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.293, relative change = 2.408e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.293, relative change = 2.205e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.293, relative change = 2.065e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.293, relative change = 2.005e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.293, relative change = 1.794e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.293, relative change = 1.691e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.293, relative change = 1.606e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.293, relative change = 1.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.293, relative change = 1.408e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.293, relative change = 1.351e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, legal, manumission, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.293, relative change = 1.245e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.293, relative change = 1.250e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.293, relative change = 1.129e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.293, relative change = 1.106e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot diagnostics</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-51.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Convert quanteda dfm to stm format</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>stm_input <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm, <span class="at">to =</span> <span class="st">"stm"</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Search for optimal number of topics (if not already done)</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (Optional) Adjust range of K values as needed</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>k_result <span class="ot">&lt;-</span> <span class="fu">searchK</span>(<span class="at">documents =</span> stm_input<span class="sc">$</span>documents,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">vocab =</span> stm_input<span class="sc">$</span>vocab,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> stm_input<span class="sc">$</span>meta,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .....
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.535) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.505, relative change = 1.154e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.489, relative change = 6.472e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.472, relative change = 6.913e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.456, relative change = 6.329e-03) 
Topic 1: slave, free, labor, men, society 
 Topic 2: family, military, different, men, urban 
 Topic 3: political, system, large, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, different, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.446, relative change = 4.156e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.439, relative change = 2.994e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.434, relative change = 2.071e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.430, relative change = 1.428e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.428, relative change = 1.020e-03) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, population 
 Topic 3: political, public, men, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, different, society 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.426, relative change = 7.662e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.424, relative change = 5.988e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.423, relative change = 4.798e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.422, relative change = 3.901e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.422, relative change = 3.173e-04) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, public, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.421, relative change = 2.558e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.421, relative change = 2.039e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.420, relative change = 1.629e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.420, relative change = 1.316e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.420, relative change = 1.082e-04) 
Topic 1: slave, free, labor, men, system 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.419, relative change = 9.052e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.419, relative change = 7.440e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.419, relative change = 6.574e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.419, relative change = 5.374e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.419, relative change = 4.495e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.419, relative change = 3.890e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.419, relative change = 3.131e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.419, relative change = 2.623e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.418, relative change = 2.134e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.418, relative change = 1.820e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.418, relative change = 1.469e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.418, relative change = 1.278e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.418, relative change = 1.069e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.418, relative change = 1.073e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.418, relative change = 1.254e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.418, relative change = 1.398e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.418, relative change = 1.920e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.418, relative change = 2.294e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.418, relative change = 3.007e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.418, relative change = 2.857e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.418, relative change = 2.386e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.418, relative change = 2.240e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.418, relative change = 1.810e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.418, relative change = 1.613e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.418, relative change = 1.442e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.418, relative change = 1.449e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.418, relative change = 1.217e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.418, relative change = 1.146e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.418, relative change = 1.131e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ..........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.366) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.341, relative change = 1.073e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.333, relative change = 3.222e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.329, relative change = 1.699e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.327, relative change = 1.041e-03) 
Topic 1: slave, free, urban, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, law, status, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.325, relative change = 6.511e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.324, relative change = 4.197e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.324, relative change = 2.878e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.323, relative change = 2.092e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.323, relative change = 1.634e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.322, relative change = 1.366e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.322, relative change = 1.207e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.322, relative change = 1.138e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.322, relative change = 1.117e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.321, relative change = 1.106e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.321, relative change = 1.070e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.321, relative change = 9.875e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.321, relative change = 8.727e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.320, relative change = 7.816e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.320, relative change = 7.526e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.320, relative change = 7.718e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.320, relative change = 8.284e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.320, relative change = 8.962e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.319, relative change = 9.496e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.319, relative change = 1.012e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.319, relative change = 1.025e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.319, relative change = 1.021e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.318, relative change = 9.775e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.318, relative change = 9.334e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.318, relative change = 9.613e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.318, relative change = 1.208e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.317, relative change = 2.079e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.316, relative change = 3.614e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.316, relative change = 3.509e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.315, relative change = 1.363e-04) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.315, relative change = 5.982e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.315, relative change = 4.945e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.315, relative change = 4.621e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.315, relative change = 4.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.315, relative change = 4.417e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.315, relative change = 4.205e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.315, relative change = 3.807e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.314, relative change = 3.490e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.314, relative change = 3.042e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.314, relative change = 2.561e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.314, relative change = 2.118e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.314, relative change = 1.775e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.314, relative change = 1.424e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.314, relative change = 1.212e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.314, relative change = 1.037e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ...............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.351) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.321, relative change = 1.267e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.313, relative change = 3.566e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.309, relative change = 1.736e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.307, relative change = 1.005e-03) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, status, legal 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.305, relative change = 6.113e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.304, relative change = 3.925e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.304, relative change = 2.699e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.303, relative change = 1.978e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.303, relative change = 1.531e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.303, relative change = 1.228e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.302, relative change = 1.020e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.302, relative change = 8.614e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.302, relative change = 7.350e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.302, relative change = 6.409e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.302, relative change = 5.702e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.302, relative change = 5.064e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.302, relative change = 4.528e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.301, relative change = 4.137e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.301, relative change = 3.815e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.301, relative change = 3.494e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.301, relative change = 3.290e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.301, relative change = 3.091e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.301, relative change = 2.888e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.301, relative change = 2.758e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.301, relative change = 2.735e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.301, relative change = 2.624e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.301, relative change = 2.592e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.301, relative change = 2.518e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.301, relative change = 2.501e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, important, law, free 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.301, relative change = 2.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.301, relative change = 2.484e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.301, relative change = 2.520e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.301, relative change = 2.435e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.300, relative change = 2.533e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, important, law, free 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.300, relative change = 2.530e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.300, relative change = 2.511e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.300, relative change = 2.508e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.300, relative change = 2.480e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.300, relative change = 2.525e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, law, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.300, relative change = 2.488e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.300, relative change = 2.574e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.300, relative change = 2.526e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.300, relative change = 2.688e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.300, relative change = 2.938e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, law, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.300, relative change = 3.814e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.300, relative change = 5.615e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.299, relative change = 8.887e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.299, relative change = 1.244e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.299, relative change = 1.196e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, important, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, law, state, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.299, relative change = 7.138e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.299, relative change = 3.590e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.299, relative change = 2.159e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.299, relative change = 1.723e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.299, relative change = 1.530e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, state 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, law, state, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.298, relative change = 1.353e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 57 (approx. per word bound = -2.298, relative change = 1.255e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 58 (approx. per word bound = -2.298, relative change = 1.108e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 59 (approx. per word bound = -2.298, relative change = 1.071e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ....................
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.360) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.320, relative change = 1.695e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.309, relative change = 4.904e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.304, relative change = 2.314e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.301, relative change = 1.342e-03) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, legal, free, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.299, relative change = 8.369e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.297, relative change = 5.440e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.297, relative change = 3.703e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.296, relative change = 2.640e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.295, relative change = 2.022e-04) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, legal, free, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.295, relative change = 1.575e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.295, relative change = 1.267e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.295, relative change = 1.067e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.294, relative change = 8.856e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.294, relative change = 7.600e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.294, relative change = 6.628e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.294, relative change = 5.864e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.294, relative change = 5.110e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.294, relative change = 4.605e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.294, relative change = 4.158e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.294, relative change = 3.713e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.293, relative change = 3.406e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.293, relative change = 3.111e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.293, relative change = 2.834e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.293, relative change = 2.573e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.293, relative change = 2.408e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.293, relative change = 2.205e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.293, relative change = 2.065e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.293, relative change = 2.005e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.293, relative change = 1.794e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.293, relative change = 1.691e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.293, relative change = 1.606e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.293, relative change = 1.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.293, relative change = 1.408e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.293, relative change = 1.351e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, legal, manumission, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.293, relative change = 1.245e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.293, relative change = 1.250e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.293, relative change = 1.129e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.293, relative change = 1.106e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit STM with chosen K and 'decade' as a covariate</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace K = 10 with your chosen number</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>stm_model <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> stm_input<span class="sc">$</span>documents,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vocab =</span> stm_input<span class="sc">$</span>vocab,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> stm_input<span class="sc">$</span>meta,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">K =</span> <span class="dv">10</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">prevalence =</span> <span class="sc">~</span> decade,  <span class="co"># covariate for topic proportions</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">max.em.its =</span> <span class="dv">75</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">init.type =</span> <span class="st">"Spectral"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ..........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.376) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.347, relative change = 1.213e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.338, relative change = 3.831e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.333, relative change = 2.306e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.328, relative change = 1.786e-03) 
Topic 1: slave, free, urban, legal, system 
 Topic 2: family, important, society, urban, different 
 Topic 3: political, system, important, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, law, status, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.325, relative change = 1.559e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.322, relative change = 1.256e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.318, relative change = 1.520e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.314, relative change = 1.944e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.312, relative change = 8.988e-04) 
Topic 1: slave, free, legal, large, system 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, law, status, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.311, relative change = 2.843e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.311, relative change = 1.391e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.311, relative change = 9.380e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.310, relative change = 7.195e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.310, relative change = 5.735e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.310, relative change = 5.115e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.310, relative change = 4.374e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.310, relative change = 3.884e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.310, relative change = 3.501e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.310, relative change = 3.162e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.310, relative change = 2.863e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.310, relative change = 2.596e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.310, relative change = 2.423e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.310, relative change = 2.169e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.310, relative change = 1.952e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.310, relative change = 1.829e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.309, relative change = 1.645e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.309, relative change = 1.481e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.309, relative change = 1.407e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.309, relative change = 1.256e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, different 
 Topic 6: production, different, military, large, society 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.309, relative change = 1.181e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.309, relative change = 1.041e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualize summary of topics</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-52.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Estimate and plot effect of decade on topic prevalence</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>prep <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">~</span> decade, stm_model, <span class="at">metadata =</span> stm_input<span class="sc">$</span>meta)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prep, <span class="at">covariate =</span> <span class="st">"decade"</span>, <span class="at">topics =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)  <span class="co"># adjust topics as needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-53.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect top 10 words per topic</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labelTopics</span>(stm_model, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Topic 1 Top Words:
     Highest Prob: slave, free, large, legal, manumission, system, state, urban, status, society 
     FREX: slave, free, large, legal, manumission, system, state, urban, status, different 
     Lift: slave, free, large, legal, manumission, system, state, urban, status, society 
     Score: slave, free, legal, large, manumission, system, urban, state, status, society 
Topic 2 Top Words:
     Highest Prob: family, military, different, society, important, urban, legal, large, status, state 
     FREX: family, military, different, important, society, urban, legal, large, status, state 
     Lift: family, military, different, important, society, urban, legal, large, status, state 
     Score: family, military, urban, important, legal, different, large, society, status, state 
Topic 3 Top Words:
     Highest Prob: political, important, system, different, status, state, law, society, free, manumission 
     FREX: political, important, system, different, status, state, law, legal, free, society 
     Lift: political, important, system, different, status, state, law, society, free, manumission 
     Score: political, important, system, status, different, state, law, family, labor, market 
Topic 4 Top Words:
     Highest Prob: manumission, peculium, legal, law, status, system, different, state, society, important 
     FREX: manumission, peculium, legal, law, status, system, different, state, society, important 
     Lift: peculium, manumission, legal, law, system, status, different, state, society, important 
     Score: peculium, manumission, legal, system, status, law, state, different, society, important 
Topic 5 Top Words:
     Highest Prob: population, urban, large, free, different, important, manumission, society, state, status 
     FREX: population, urban, large, free, different, important, state, status, legal, society 
     Lift: population, urban, large, free, different, important, manumission, society, state, status 
     Score: population, urban, large, free, different, important, manumission, military, family, labor 
Topic 6 Top Words:
     Highest Prob: production, different, military, large, society, system, law, important, free, manumission 
     FREX: production, different, military, large, system, legal, important, law, society, status 
     Lift: production, different, military, large, society, system, law, important, free, manumission 
     Score: production, military, different, large, system, society, law, family, labor, market 
Topic 7 Top Words:
     Highest Prob: society, market, system, state, law, important, large, free, military, different 
     FREX: market, society, system, state, law, important, large, legal, different, military 
     Lift: market, society, system, state, law, important, large, free, military, different 
     Score: market, system, society, state, law, important, large, military, family, labor 
Topic 8 Top Words:
     Highest Prob: labor, large, important, legal, free, status, state, system, different, society 
     FREX: labor, important, large, legal, free, status, system, state, different, urban 
     Lift: labor, important, large, legal, free, status, state, system, different, society 
     Score: labor, important, large, legal, free, status, state, system, urban, family 
Topic 9 Top Words:
     Highest Prob: public, large, state, urban, system, status, different, legal, important, free 
     FREX: public, large, state, urban, system, status, different, legal, important, free 
     Lift: public, state, large, urban, system, status, legal, different, important, free 
     Score: public, urban, large, state, system, status, legal, important, free, different 
Topic 10 Top Words:
     Highest Prob: men, free, status, law, legal, state, society, large, different, manumission 
     FREX: men, free, law, status, legal, state, society, system, different, urban 
     Lift: men, law, status, free, legal, state, society, large, different, manumission 
     Score: men, status, free, law, legal, state, society, large, different, manumission </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show frex terms by topic</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>topic_labels <span class="ot">&lt;-</span> <span class="fu">labelTopics</span>(stm_model, <span class="at">n =</span> <span class="dv">7</span>)<span class="sc">$</span>frex</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print topic labels</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(topic_labels[,<span class="dv">1</span>])) {</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">" Topic "</span>, i, <span class="st">": "</span>), <span class="fu">paste</span>(topic_labels[i, ], <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Topic 1:  slave, free, large, legal, manumission, system, state 
 Topic 2:  family, military, different, important, society, urban, legal 
 Topic 3:  political, important, system, different, status, state, law 
 Topic 4:  manumission, peculium, legal, law, status, system, different 
 Topic 5:  population, urban, large, free, different, important, state 
 Topic 6:  production, different, military, large, system, legal, important 
 Topic 7:  market, society, system, state, law, important, large 
 Topic 8:  labor, important, large, legal, free, status, system 
 Topic 9:  public, large, state, urban, system, status, different 
 Topic 10:  men, free, law, status, legal, state, society </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # You can manually create a named vector of labels:</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># topic_names &lt;- c(</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   "Slavery &amp; Labor",</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   "Military &amp; Administration",</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   "Economy &amp; Markets"</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot.estimateEffect(effect_model, covariate = "decade",</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                     topics = 1:3,</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                     model = stm_model,</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                     labeltype = "custom",</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                     custom.labels = topic_names)</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>keyword <span class="ot">&lt;-</span> <span class="st">"slave"</span>  <span class="co"># or any other word you're targeting</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="do">## === 1. 2-Word Collocations ===</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>colloc_2gram <span class="ot">&lt;-</span> <span class="fu">textstat_collocations</span>(</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  tokens,</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_count =</span> <span class="dv">5</span>,</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolower =</span> <span class="cn">FALSE</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(collocation, <span class="fu">regex</span>(keyword, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="co"># === 2. 3-Word Collocations ===</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>colloc_3gram <span class="ot">&lt;-</span> <span class="fu">textstat_collocations</span>(</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>  tokens,</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_count =</span> <span class="dv">3</span>,  <span class="co"># Lower threshold for 3-word combinations</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolower =</span> <span class="cn">FALSE</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(collocation, <span class="fu">regex</span>(keyword, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a><span class="co"># === 3. View Results ===</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 2-word collocations</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(colloc_2gram[<span class="fu">order</span>(<span class="sc">-</span>colloc_2gram<span class="sc">$</span>lambda), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         collocation count count_nested length   lambda         z
338    chattel slave    19            0      2 7.837241  5.470964
52  slave's peculium    10            0      2 6.660130 15.172828
323       slave aged     5            0      2 4.950880  6.486145
294     female slave     7            0      2 4.163958  8.051229
295   imported slave     7            0      2 4.038782  8.048772
205    decline slave    15            0      2 3.890624 11.517317
184 slave manumitted    16            0      2 3.775651 11.808160
299       male slave     7            0      2 3.736464  7.946304
141     slave prices    20            0      2 3.398876 12.660511
277      freed slave    10            0      2 3.167568  8.747011</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 3-word collocations</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(colloc_3gram[<span class="fu">order</span>(<span class="sc">-</span>colloc_3gram<span class="sc">$</span>lambda), ], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   collocation count count_nested length   lambda        z
1         theory natural slave     3            0      3 5.764372 2.578802
2       category slave society     3            0      3 4.158959 1.988446
3          million rural slave     3            0      3 3.121247 1.868232
20 internal organisation slave     4            0      3 3.077789 1.190160
7         notion slave society     3            0      3 2.812030 1.610430
14        feature slave system     3            0      3 2.694592 1.282036
9       sex distribution slave     3            0      3 2.689250 1.492771
19         slave talking tools     3            0      3 2.653853 1.205515
18           real slave prices     3            0      3 2.596756 1.236976
12     decline slave antiquity     3            0      3 2.413277 1.372297</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === 4. Visualization ===</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2-word collocations</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>colloc_2gram <span class="sc">%&gt;%</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lambda)) <span class="sc">%&gt;%</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(collocation, lambda), <span class="at">y =</span> lambda)) <span class="sc">+</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 20 Collocations with '"</span>, keyword, <span class="st">"' (2-grams)"</span>),</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Collocation"</span>,</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Association Strength (λ)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-54.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3-word collocations</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>colloc_3gram <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lambda)) <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(collocation, lambda), <span class="at">y =</span> lambda)) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top 20 Collocations with '"</span>, keyword, <span class="st">"' (3-grams)"</span>),</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Collocation"</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Association Strength (λ)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-55.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. First ensure we have the KWIC data</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>keyword <span class="ot">&lt;-</span> <span class="st">"slave"</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>window_size <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>kw <span class="ot">&lt;-</span> <span class="fu">kwic</span>(tokens, <span class="at">pattern =</span> keyword, <span class="at">window =</span> window_size)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create KWIC dataframe with proper error handling</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"kw"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(kw) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  kwic_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">paste</span>(kw<span class="sc">$</span>pre, kw<span class="sc">$</span>post),</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">doc_id =</span> kw<span class="sc">$</span>docname</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_tokens</span>(word, text)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Sentiment analysis with AFINN lexicon</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"tidytext"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    sentiment_scores <span class="ot">&lt;-</span> kwic_df <span class="sc">%&gt;%</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">inner_join</span>(tidytext<span class="sc">::</span><span class="fu">get_sentiments</span>(<span class="st">"afinn"</span>), <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(doc_id) <span class="sc">%&gt;%</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">sentiment =</span> <span class="fu">mean</span>(value))</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Add decade information if we have sentiment scores</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(sentiment_scores) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>      sentiment_scores<span class="sc">$</span>decade <span class="ot">&lt;-</span> <span class="fu">docvars</span>(corpus, <span class="st">"decade"</span>)[</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">match</span>(sentiment_scores<span class="sc">$</span>doc_id, <span class="fu">docnames</span>(corpus))</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 5. Now create the plot</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(ggplot2)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(sentiment_scores, <span class="fu">aes</span>(<span class="at">x =</span> decade, <span class="at">y =</span> sentiment)) <span class="sc">+</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Sentiment Around '"</span>, keyword, <span class="st">"' by Decade"</span>),</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> <span class="st">"Decade"</span>,</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="st">"Sentiment Score"</span>) <span class="sc">+</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_minimal</span>()</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"No sentiment-bearing words found in the contexts."</span>)</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"tidytext package is required for sentiment analysis."</span>)</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No KWIC matches found for keyword '"</span>, keyword, <span class="st">"'"</span>)</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-56.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Extract topic proportions (theta matrix) ===</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>topic_props <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(stm_model<span class="sc">$</span>theta)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(topic_props) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Topic_"</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(topic_props)))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>topic_props<span class="sc">$</span>docname <span class="ot">&lt;-</span> <span class="fu">rownames</span>(topic_props)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>topic_props<span class="sc">$</span>decade <span class="ot">&lt;-</span> stm_input<span class="sc">$</span>meta<span class="sc">$</span>decade</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Reshape for plotting ===</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>topic_long <span class="ot">&lt;-</span> topic_props <span class="sc">%&gt;%</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Topic_"</span>),</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"topic"</span>,</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"proportion"</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Plot — legend removed ===</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(topic_long, <span class="fu">aes</span>(<span class="at">x =</span> decade, <span class="at">y =</span> proportion, <span class="at">fill =</span> topic)) <span class="sc">+</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.5</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> topic, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Topic Proportions by Decade"</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Decade"</span>,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion"</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-57.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dfm to STM format</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(dfm, <span class="at">min_termfreq =</span> <span class="dv">5</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>stm_input <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm, <span class="at">to =</span> <span class="st">"stm"</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define more granular range of K values</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>k_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">20</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run searchK to evaluate model diagnostics across those K values</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>k_result <span class="ot">&lt;-</span> <span class="fu">searchK</span>(</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">documents =</span> stm_input<span class="sc">$</span>documents,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">vocab =</span> stm_input<span class="sc">$</span>vocab,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> stm_input<span class="sc">$</span>meta,</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> k_values,</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">init.type =</span> <span class="st">"Spectral"</span>,</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .....
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.535) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.505, relative change = 1.154e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.489, relative change = 6.472e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.472, relative change = 6.913e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.456, relative change = 6.329e-03) 
Topic 1: slave, free, labor, men, society 
 Topic 2: family, military, different, men, urban 
 Topic 3: political, system, large, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, different, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.446, relative change = 4.156e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.439, relative change = 2.994e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.434, relative change = 2.071e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.430, relative change = 1.428e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.428, relative change = 1.020e-03) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, population 
 Topic 3: political, public, men, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, different, society 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.426, relative change = 7.662e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.424, relative change = 5.988e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.423, relative change = 4.798e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.422, relative change = 3.901e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.422, relative change = 3.173e-04) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, public, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.421, relative change = 2.558e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.421, relative change = 2.039e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.420, relative change = 1.629e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.420, relative change = 1.316e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.420, relative change = 1.082e-04) 
Topic 1: slave, free, labor, men, system 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.419, relative change = 9.052e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.419, relative change = 7.440e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.419, relative change = 6.574e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.419, relative change = 5.374e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.419, relative change = 4.495e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.419, relative change = 3.890e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.419, relative change = 3.131e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.419, relative change = 2.623e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.418, relative change = 2.134e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.418, relative change = 1.820e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.418, relative change = 1.469e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.418, relative change = 1.278e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.418, relative change = 1.069e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.418, relative change = 1.073e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.418, relative change = 1.254e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.418, relative change = 1.398e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.418, relative change = 1.920e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.418, relative change = 2.294e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.418, relative change = 3.007e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.418, relative change = 2.857e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.418, relative change = 2.386e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.418, relative change = 2.240e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.418, relative change = 1.810e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.418, relative change = 1.613e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.418, relative change = 1.442e-05) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, population 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: labor, population, production, society, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.418, relative change = 1.449e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.418, relative change = 1.217e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.418, relative change = 1.146e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.418, relative change = 1.131e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ......
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.475) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.448, relative change = 1.064e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.437, relative change = 4.739e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.429, relative change = 3.310e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.422, relative change = 2.525e-03) 
Topic 1: slave, free, labor, men, urban 
 Topic 2: family, military, different, men, society 
 Topic 3: political, system, large, status, public 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, men, labor 
 Topic 6: labor, population, large, urban, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.417, relative change = 2.421e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.411, relative change = 2.278e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.406, relative change = 2.256e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.400, relative change = 2.233e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.395, relative change = 2.014e-03) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, large, system, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, labor, market 
 Topic 6: labor, population, large, urban, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.391, relative change = 1.825e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.387, relative change = 1.759e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.384, relative change = 1.310e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.382, relative change = 8.651e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.380, relative change = 6.096e-04) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, men, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, labor, market 
 Topic 6: labor, population, large, urban, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.379, relative change = 4.230e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.378, relative change = 3.120e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.378, relative change = 2.273e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.378, relative change = 1.453e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.377, relative change = 9.511e-05) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, labor, market 
 Topic 6: labor, population, large, urban, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.377, relative change = 7.005e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.377, relative change = 5.572e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.377, relative change = 4.621e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.377, relative change = 3.954e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.377, relative change = 3.472e-05) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, labor, market 
 Topic 6: labor, population, large, urban, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.377, relative change = 3.051e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.377, relative change = 2.658e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.377, relative change = 2.357e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.377, relative change = 1.997e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.376, relative change = 1.742e-05) 
Topic 1: slave, free, labor, men, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, labor, market 
 Topic 6: labor, population, large, urban, market 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.376, relative change = 1.563e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.376, relative change = 1.417e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.376, relative change = 1.234e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.376, relative change = 1.095e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .......
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.440) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.415, relative change = 1.040e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.401, relative change = 5.802e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.392, relative change = 3.529e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.386, relative change = 2.568e-03) 
Topic 1: slave, free, men, legal, law 
 Topic 2: family, society, important, urban, different 
 Topic 3: political, state, system, status, public 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, men, public 
 Topic 6: population, urban, large, free, labor 
 Topic 7: labor, society, market, large, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.380, relative change = 2.741e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.372, relative change = 3.377e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.365, relative change = 2.880e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.361, relative change = 1.627e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.358, relative change = 1.038e-03) 
Topic 1: slave, free, men, legal, labor 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, men, state, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, men, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, society, market, large, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.357, relative change = 8.235e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.355, relative change = 8.184e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.353, relative change = 6.003e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.353, relative change = 2.830e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.352, relative change = 1.896e-04) 
Topic 1: slave, free, men, legal, labor 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, men, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, society, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, society, market, important, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.352, relative change = 1.554e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.351, relative change = 1.377e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.351, relative change = 1.284e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.351, relative change = 1.251e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.350, relative change = 1.279e-04) 
Topic 1: slave, free, men, labor, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, society, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, society, important, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.350, relative change = 1.366e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.350, relative change = 1.526e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.349, relative change = 1.776e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.349, relative change = 2.114e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.348, relative change = 2.485e-04) 
Topic 1: slave, free, men, labor, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, society, important, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.348, relative change = 2.791e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.347, relative change = 2.902e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.346, relative change = 2.762e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.346, relative change = 2.422e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.345, relative change = 2.011e-04) 
Topic 1: slave, free, men, labor, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, important, large, society 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.345, relative change = 1.605e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.345, relative change = 1.269e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.344, relative change = 1.007e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.344, relative change = 8.098e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.344, relative change = 6.719e-05) 
Topic 1: slave, free, men, labor, system 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, large, important, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.344, relative change = 5.666e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.344, relative change = 4.931e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.344, relative change = 4.228e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.344, relative change = 3.694e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.344, relative change = 3.020e-05) 
Topic 1: slave, free, men, labor, system 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, large, important, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.343, relative change = 2.621e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.343, relative change = 2.156e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.343, relative change = 1.948e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.343, relative change = 1.680e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.343, relative change = 1.584e-05) 
Topic 1: slave, free, labor, men, system 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, large, important, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.343, relative change = 1.377e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.343, relative change = 1.300e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.343, relative change = 1.200e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.343, relative change = 1.046e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.343, relative change = 1.018e-05) 
Topic 1: slave, free, labor, men, system 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, society, different, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: labor, market, large, important, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.412) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.391, relative change = 8.568e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.385, relative change = 2.584e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.381, relative change = 1.710e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.376, relative change = 1.768e-03) 
Topic 1: slave, free, men, status, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, system, important, large, public 
 Topic 4: manumission, peculium, legal, law, system 
 Topic 5: production, different, men, large, public 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, public, status, free, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.372, relative change = 1.792e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.368, relative change = 1.555e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.365, relative change = 1.539e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.361, relative change = 1.648e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.357, relative change = 1.672e-03) 
Topic 1: slave, free, men, status, legal 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, system, state, large 
 Topic 4: manumission, peculium, legal, law, system 
 Topic 5: production, different, men, military, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, free, status, public, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.353, relative change = 1.613e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.349, relative change = 1.633e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.345, relative change = 1.754e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.342, relative change = 1.479e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.340, relative change = 9.407e-04) 
Topic 1: slave, free, men, legal, status 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, men, state, large 
 Topic 4: manumission, peculium, legal, law, system 
 Topic 5: production, different, military, men, large 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, status 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.338, relative change = 6.520e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.337, relative change = 4.695e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.336, relative change = 3.714e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.335, relative change = 3.056e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.335, relative change = 2.503e-04) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, public, men, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, status 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.334, relative change = 2.022e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.334, relative change = 1.646e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.334, relative change = 1.319e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.333, relative change = 1.064e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.333, relative change = 8.628e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, public, free, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.333, relative change = 7.069e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.333, relative change = 5.728e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.333, relative change = 4.884e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.333, relative change = 3.994e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.333, relative change = 3.365e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.333, relative change = 2.905e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.332, relative change = 2.445e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.332, relative change = 2.134e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.332, relative change = 1.802e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.332, relative change = 1.605e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, men, free, public, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.332, relative change = 1.432e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.332, relative change = 1.266e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.332, relative change = 1.051e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.387) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.363, relative change = 1.007e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.354, relative change = 3.791e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.348, relative change = 2.454e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.344, relative change = 1.846e-03) 
Topic 1: slave, free, men, legal, law 
 Topic 2: family, important, society, urban, legal 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, men, large 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, large, important, free, status 
 Topic 9: public, men, large, free, status 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.340, relative change = 1.408e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.337, relative change = 1.249e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.334, relative change = 1.567e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.329, relative change = 1.880e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.327, relative change = 1.162e-03) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, men, large 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, system 
 Topic 8: labor, large, important, free, legal 
 Topic 9: free, men, public, large, status 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.326, relative change = 4.698e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.325, relative change = 2.357e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.325, relative change = 1.622e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.324, relative change = 1.318e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.324, relative change = 1.196e-04) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.324, relative change = 1.132e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.324, relative change = 1.068e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.323, relative change = 9.804e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.323, relative change = 8.756e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.323, relative change = 8.076e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.323, relative change = 7.915e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.323, relative change = 8.367e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.322, relative change = 9.228e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.322, relative change = 1.017e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.322, relative change = 1.108e-04) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, free, legal 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.322, relative change = 1.175e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.321, relative change = 1.207e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.321, relative change = 1.235e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.321, relative change = 1.413e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.320, relative change = 2.064e-04) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, large, important, legal, free 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.319, relative change = 3.529e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.318, relative change = 4.034e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.318, relative change = 1.786e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.318, relative change = 6.895e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.318, relative change = 4.680e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, legal, free 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.318, relative change = 4.238e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.318, relative change = 4.087e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.317, relative change = 4.070e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.317, relative change = 3.863e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.317, relative change = 3.666e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, legal, free 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.317, relative change = 3.368e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.317, relative change = 3.038e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.317, relative change = 2.575e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.317, relative change = 2.200e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.317, relative change = 1.872e-05) 
Topic 1: slave, free, men, legal, large 
 Topic 2: family, military, different, men, society 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, men 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, important 
 Topic 8: labor, important, large, legal, free 
 Topic 9: free, men, public, status, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.317, relative change = 1.632e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.317, relative change = 1.355e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.317, relative change = 1.213e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.317, relative change = 1.044e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ..........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.366) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.341, relative change = 1.073e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.333, relative change = 3.222e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.329, relative change = 1.699e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.327, relative change = 1.041e-03) 
Topic 1: slave, free, urban, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, law, status, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.325, relative change = 6.511e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.324, relative change = 4.197e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.324, relative change = 2.878e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.323, relative change = 2.092e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.323, relative change = 1.634e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.322, relative change = 1.366e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.322, relative change = 1.207e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.322, relative change = 1.138e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.322, relative change = 1.117e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.321, relative change = 1.106e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.321, relative change = 1.070e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.321, relative change = 9.875e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.321, relative change = 8.727e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.320, relative change = 7.816e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.320, relative change = 7.526e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.320, relative change = 7.718e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.320, relative change = 8.284e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.320, relative change = 8.962e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.319, relative change = 9.496e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.319, relative change = 1.012e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.319, relative change = 1.025e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.319, relative change = 1.021e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.318, relative change = 9.775e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.318, relative change = 9.334e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.318, relative change = 9.613e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, military, different, society, important 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.318, relative change = 1.208e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.317, relative change = 2.079e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.316, relative change = 3.614e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.316, relative change = 3.509e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.315, relative change = 1.363e-04) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.315, relative change = 5.982e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.315, relative change = 4.945e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.315, relative change = 4.621e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.315, relative change = 4.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.315, relative change = 4.417e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.315, relative change = 4.205e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.315, relative change = 3.807e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.314, relative change = 3.490e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.314, relative change = 3.042e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.314, relative change = 2.561e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.314, relative change = 2.118e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.314, relative change = 1.775e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.314, relative change = 1.424e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.314, relative change = 1.212e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.314, relative change = 1.037e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, military, different, society, important 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, military, large, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ...........
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.360) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.335, relative change = 1.057e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.328, relative change = 2.920e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.325, relative change = 1.506e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.323, relative change = 9.118e-04) 
Topic 1: slave, free, legal, manumission, large 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, urban, state, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, society, law 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.321, relative change = 5.851e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.320, relative change = 4.249e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.319, relative change = 3.813e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.318, relative change = 3.810e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.318, relative change = 2.861e-04) 
Topic 1: slave, free, legal, large, manumission 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, important, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, urban, state, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, society, law 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.317, relative change = 1.717e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.317, relative change = 1.362e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.317, relative change = 1.344e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.316, relative change = 1.417e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.316, relative change = 1.407e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, important 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, society, law 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.316, relative change = 1.244e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.316, relative change = 9.529e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.315, relative change = 7.345e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.315, relative change = 6.213e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.315, relative change = 6.169e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, society, law 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.315, relative change = 6.424e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.315, relative change = 6.825e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.315, relative change = 7.502e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.314, relative change = 8.123e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.314, relative change = 8.805e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, state, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.314, relative change = 9.407e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.314, relative change = 9.918e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.314, relative change = 1.031e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.313, relative change = 1.027e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.313, relative change = 9.780e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, system, important, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.313, relative change = 8.908e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.313, relative change = 7.877e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.313, relative change = 6.686e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.312, relative change = 5.875e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.312, relative change = 5.086e-05) 
Topic 1: slave, free, large, system, manumission 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.312, relative change = 4.393e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.312, relative change = 3.802e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.312, relative change = 3.404e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.312, relative change = 2.995e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.312, relative change = 2.665e-05) 
Topic 1: slave, free, large, system, manumission 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, society, law 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.312, relative change = 2.361e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.312, relative change = 2.095e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.312, relative change = 1.903e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.312, relative change = 1.781e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.312, relative change = 1.561e-05) 
Topic 1: slave, free, large, manumission, legal 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.312, relative change = 1.567e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.312, relative change = 1.466e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.312, relative change = 1.414e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.312, relative change = 1.362e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.312, relative change = 1.341e-05) 
Topic 1: slave, free, large, manumission, legal 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.311, relative change = 1.685e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.311, relative change = 2.493e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.311, relative change = 5.493e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.311, relative change = 1.279e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.310, relative change = 2.508e-04) 
Topic 1: slave, free, large, manumission, legal 
 Topic 2: family, society, important, urban, legal 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, society 
 Topic 6: population, urban, large, free, important 
 Topic 7: society, market, system, state, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, society, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.310, relative change = 2.407e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 57 (approx. per word bound = -2.310, relative change = 7.783e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 58 (approx. per word bound = -2.310, relative change = 2.001e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 59 (approx. per word bound = -2.310, relative change = 1.201e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.354) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.330, relative change = 1.041e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.322, relative change = 3.240e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.318, relative change = 1.630e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.316, relative change = 9.922e-04) 
Topic 1: slave, free, system, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, urban, state, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, law, large 
 Topic 12: society, law, large, state, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.314, relative change = 6.999e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.313, relative change = 5.821e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.312, relative change = 3.972e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.312, relative change = 2.148e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.311, relative change = 1.463e-04) 
Topic 1: slave, free, system, legal, large 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, status, different 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, urban, state, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, law, large 
 Topic 12: society, law, large, state, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.311, relative change = 1.139e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.311, relative change = 9.334e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.311, relative change = 7.950e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.310, relative change = 6.766e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.310, relative change = 5.982e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, different, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, law, large 
 Topic 12: society, law, state, large, system 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.310, relative change = 5.262e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.310, relative change = 4.733e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.310, relative change = 4.302e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.310, relative change = 3.950e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.310, relative change = 3.767e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, different, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, law, large 
 Topic 12: society, law, state, system, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.310, relative change = 3.640e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.310, relative change = 3.553e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.310, relative change = 3.566e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.309, relative change = 3.758e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.309, relative change = 4.046e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, different, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, law, large 
 Topic 12: society, state, system, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.309, relative change = 4.509e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.309, relative change = 5.199e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.309, relative change = 6.200e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.309, relative change = 7.524e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.309, relative change = 9.318e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, different, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.308, relative change = 1.146e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.308, relative change = 1.339e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.308, relative change = 1.428e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.307, relative change = 1.324e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.307, relative change = 1.094e-04) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, law, system 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.307, relative change = 8.250e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.307, relative change = 6.396e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.307, relative change = 5.216e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.307, relative change = 4.316e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.306, relative change = 3.765e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, law, system 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.306, relative change = 3.473e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.306, relative change = 3.041e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.306, relative change = 2.963e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.306, relative change = 3.314e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.306, relative change = 4.604e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, law, important, different 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.306, relative change = 8.424e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.305, relative change = 1.762e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.305, relative change = 2.874e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.304, relative change = 2.094e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.304, relative change = 6.739e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, law, important, different 
 Topic 8: labor, important, large, different, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.304, relative change = 3.422e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.304, relative change = 2.982e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.304, relative change = 3.061e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.304, relative change = 2.768e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.304, relative change = 2.591e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, law, important, different 
 Topic 8: labor, important, large, different, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.304, relative change = 2.515e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 57 (approx. per word bound = -2.304, relative change = 2.371e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 58 (approx. per word bound = -2.304, relative change = 2.107e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 59 (approx. per word bound = -2.304, relative change = 1.943e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 60 (approx. per word bound = -2.304, relative change = 1.746e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, state, law, important, different 
 Topic 8: labor, important, large, different, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 61 (approx. per word bound = -2.304, relative change = 1.583e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 62 (approx. per word bound = -2.304, relative change = 1.364e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 63 (approx. per word bound = -2.304, relative change = 1.266e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 64 (approx. per word bound = -2.303, relative change = 1.087e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 65 (approx. per word bound = -2.303, relative change = 1.064e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, different, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, different, large, law, important 
 Topic 6: population, urban, large, free, different 
 Topic 7: market, law, state, important, different 
 Topic 8: labor, important, large, different, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, different, important, law, large 
 Topic 12: society, system, state, law, large 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.358) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.328, relative change = 1.290e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.320, relative change = 3.147e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.316, relative change = 1.641e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.314, relative change = 9.382e-04) 
Topic 1: slave, free, legal, system, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, urban, state, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, large, state, system 
 Topic 13: different, important, law, large, manumission 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.313, relative change = 5.493e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.312, relative change = 3.393e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.312, relative change = 2.247e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.311, relative change = 1.608e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.311, relative change = 1.201e-04) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, large, state, system 
 Topic 13: different, important, law, large, manumission 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.311, relative change = 9.431e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.311, relative change = 7.722e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.310, relative change = 6.540e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.310, relative change = 5.523e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.310, relative change = 4.857e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, state, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, large, system 
 Topic 13: different, important, law, large, manumission 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.310, relative change = 4.354e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.310, relative change = 3.918e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.310, relative change = 3.611e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.310, relative change = 3.376e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.310, relative change = 3.168e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, state, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, system, large 
 Topic 13: different, important, law, large, manumission 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.310, relative change = 3.044e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.310, relative change = 2.929e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.310, relative change = 2.975e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.310, relative change = 2.985e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.309, relative change = 3.048e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, state, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, system, law 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, state, law, system, large 
 Topic 13: different, important, law, large, manumission 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.309, relative change = 3.160e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.309, relative change = 3.342e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.309, relative change = 3.485e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.309, relative change = 3.829e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.309, relative change = 4.214e-05) 
Topic 1: slave, free, system, large, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, state, status 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, law, system 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, state, system, law, large 
 Topic 13: different, important, law, large, manumission 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.309, relative change = 4.601e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.309, relative change = 5.396e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.309, relative change = 6.506e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.308, relative change = 8.003e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.308, relative change = 9.818e-05) 
Topic 1: slave, free, system, large, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, system, important, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, law, system 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, system, state, law, large 
 Topic 13: different, important, law, large, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.308, relative change = 1.190e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.308, relative change = 1.366e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.307, relative change = 1.395e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.307, relative change = 1.226e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.307, relative change = 9.805e-05) 
Topic 1: slave, free, system, large, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, law, important, system 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, system, state, law, large 
 Topic 13: different, important, law, large, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.307, relative change = 7.349e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.307, relative change = 5.718e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.306, relative change = 4.709e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.306, relative change = 4.047e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.306, relative change = 3.870e-05) 
Topic 1: slave, free, large, system, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, law, important, system 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, system, state, law, large 
 Topic 13: different, important, law, large, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.306, relative change = 3.899e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.306, relative change = 4.488e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.306, relative change = 6.109e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.306, relative change = 9.461e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.305, relative change = 1.347e-04) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, law, important, system 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, system, state, law, large 
 Topic 13: different, important, law, large, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.305, relative change = 1.352e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.305, relative change = 8.033e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.305, relative change = 3.423e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.305, relative change = 1.784e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.305, relative change = 1.327e-05) 
Topic 1: slave, free, large, system, legal 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, system, status, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, law, state, important, system 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, system 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, system, state, law, large 
 Topic 13: different, important, law, large, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.305, relative change = 1.138e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ..............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.355) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.326, relative change = 1.254e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.318, relative change = 3.282e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.314, relative change = 1.607e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.312, relative change = 9.321e-04) 
Topic 1: slave, free, legal, manumission, large 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, state 
 Topic 7: market, state, important, law, large 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, large, state, manumission 
 Topic 13: different, important, law, large, manumission 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.311, relative change = 5.635e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.310, relative change = 3.562e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.309, relative change = 2.395e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.309, relative change = 1.689e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.309, relative change = 1.320e-04) 
Topic 1: slave, free, legal, large, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, state 
 Topic 7: market, state, important, law, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, large, state, manumission 
 Topic 13: different, important, law, large, manumission 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.308, relative change = 1.032e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.308, relative change = 8.530e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.308, relative change = 7.182e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.308, relative change = 6.143e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.308, relative change = 5.412e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, state 
 Topic 7: market, state, important, law, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, large, state, manumission 
 Topic 13: different, important, law, large, manumission 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.308, relative change = 4.751e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.308, relative change = 4.305e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.307, relative change = 3.800e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.307, relative change = 3.520e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.307, relative change = 3.139e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, manumission 
 Topic 6: population, urban, large, free, state 
 Topic 7: market, state, important, law, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, large, manumission 
 Topic 13: different, important, law, large, manumission 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.307, relative change = 3.048e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.307, relative change = 2.895e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.307, relative change = 2.663e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.307, relative change = 2.573e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.307, relative change = 2.496e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, law, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, state, urban, important 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, large, manumission 
 Topic 13: different, important, law, large, manumission 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.307, relative change = 2.455e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.307, relative change = 2.470e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.307, relative change = 2.429e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.307, relative change = 2.427e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.307, relative change = 2.423e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, important, law, large 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, large, important 
 Topic 13: different, important, law, large, manumission 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.307, relative change = 2.410e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.307, relative change = 2.562e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.307, relative change = 2.450e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.306, relative change = 2.562e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.306, relative change = 2.488e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, law, important, large 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, large, important 
 Topic 13: different, important, law, large, legal 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.306, relative change = 2.546e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.306, relative change = 2.569e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.306, relative change = 2.621e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.306, relative change = 2.752e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.306, relative change = 2.737e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, state, law, important, large 
 Topic 8: labor, important, large, legal, free 
 Topic 9: public, large, state, urban, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, law, state, large, important 
 Topic 13: different, important, law, large, legal 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.306, relative change = 2.802e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.306, relative change = 2.901e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.306, relative change = 2.990e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.306, relative change = 3.146e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.306, relative change = 3.518e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, urban, important, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, law, state, important, large 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, state, law, large, important 
 Topic 13: different, important, law, large, legal 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.306, relative change = 4.581e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.306, relative change = 6.573e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.305, relative change = 9.799e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.305, relative change = 1.212e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.305, relative change = 1.005e-04) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, urban, important, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, law, state, important, large 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, state, law, large, important 
 Topic 13: different, important, law, large, legal 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.305, relative change = 5.549e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.305, relative change = 2.771e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.305, relative change = 1.752e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.305, relative change = 1.462e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.304, relative change = 1.306e-05) 
Topic 1: slave, free, large, legal, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, large, law, important, legal 
 Topic 6: population, urban, large, free, important 
 Topic 7: market, law, state, important, large 
 Topic 8: labor, large, important, legal, free 
 Topic 9: public, large, state, urban, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, large, manumission 
 Topic 12: society, state, law, large, important 
 Topic 13: different, important, law, large, legal 
 Topic 14: system, state, status, law, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.304, relative change = 1.154e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 57 (approx. per word bound = -2.304, relative change = 1.073e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ...............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.351) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.321, relative change = 1.267e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.313, relative change = 3.566e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.309, relative change = 1.736e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.307, relative change = 1.005e-03) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, status, legal 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.305, relative change = 6.113e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.304, relative change = 3.925e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.304, relative change = 2.699e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.303, relative change = 1.978e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.303, relative change = 1.531e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, state 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.303, relative change = 1.228e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.302, relative change = 1.020e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.302, relative change = 8.614e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.302, relative change = 7.350e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.302, relative change = 6.409e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.302, relative change = 5.702e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.302, relative change = 5.064e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.302, relative change = 4.528e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.301, relative change = 4.137e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.301, relative change = 3.815e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, manumission, legal 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, important, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.301, relative change = 3.494e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.301, relative change = 3.290e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.301, relative change = 3.091e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.301, relative change = 2.888e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.301, relative change = 2.758e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, state, important, law, manumission 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, manumission, important 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.301, relative change = 2.735e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.301, relative change = 2.624e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.301, relative change = 2.592e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.301, relative change = 2.518e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.301, relative change = 2.501e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, important, law, free 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, manumission, legal 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.301, relative change = 2.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.301, relative change = 2.484e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.301, relative change = 2.520e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.301, relative change = 2.435e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.300, relative change = 2.533e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, important, law, free 
 Topic 8: labor, important, free, legal, status 
 Topic 9: public, state, urban, status, legal 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.300, relative change = 2.530e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.300, relative change = 2.511e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.300, relative change = 2.508e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.300, relative change = 2.480e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.300, relative change = 2.525e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, law, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, law, state, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.300, relative change = 2.488e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.300, relative change = 2.574e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.300, relative change = 2.526e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.300, relative change = 2.688e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.300, relative change = 2.938e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, important, state 
 Topic 7: market, state, law, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.300, relative change = 3.814e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.300, relative change = 5.615e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 48 (approx. per word bound = -2.299, relative change = 8.887e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 49 (approx. per word bound = -2.299, relative change = 1.244e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 50 (approx. per word bound = -2.299, relative change = 1.196e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, important, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, manumission 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, law, state, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 51 (approx. per word bound = -2.299, relative change = 7.138e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 52 (approx. per word bound = -2.299, relative change = 3.590e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 53 (approx. per word bound = -2.299, relative change = 2.159e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 54 (approx. per word bound = -2.299, relative change = 1.723e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 55 (approx. per word bound = -2.299, relative change = 1.530e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, important, urban, legal, status 
 Topic 3: political, important, status, law, state 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, important, legal, state 
 Topic 6: population, urban, free, state, important 
 Topic 7: market, law, state, important, free 
 Topic 8: labor, important, legal, free, status 
 Topic 9: public, state, urban, legal, status 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, important, law, manumission, legal 
 Topic 12: society, state, law, important, manumission 
 Topic 13: different, important, law, legal, manumission 
 Topic 14: system, state, status, law, important 
 Topic 15: large, law, urban, state, free 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 56 (approx. per word bound = -2.298, relative change = 1.353e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 57 (approx. per word bound = -2.298, relative change = 1.255e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 58 (approx. per word bound = -2.298, relative change = 1.108e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 59 (approx. per word bound = -2.298, relative change = 1.071e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    .................
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.356) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.321, relative change = 1.502e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.311, relative change = 4.070e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.307, relative change = 1.931e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.304, relative change = 1.111e-03) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, manumission, legal, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, manumission, free, legal 
 Topic 8: labor, free, status, legal, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, manumission 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.303, relative change = 6.771e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.302, relative change = 4.298e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.301, relative change = 2.906e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.301, relative change = 2.073e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.300, relative change = 1.562e-04) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, manumission, legal, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, manumission, free, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, manumission 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.300, relative change = 1.231e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.300, relative change = 1.014e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.300, relative change = 8.335e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.299, relative change = 7.184e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.299, relative change = 6.230e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, manumission, legal, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, manumission, free, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, manumission 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.299, relative change = 5.397e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.299, relative change = 4.812e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.299, relative change = 4.332e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.299, relative change = 3.827e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.299, relative change = 3.545e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, manumission, legal, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, manumission, free, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, manumission 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.299, relative change = 3.213e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.299, relative change = 2.915e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.299, relative change = 2.735e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.299, relative change = 2.511e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.298, relative change = 2.339e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, legal, manumission, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, free, manumission, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, manumission 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.298, relative change = 2.223e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.298, relative change = 2.031e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.298, relative change = 1.983e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.298, relative change = 1.843e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.298, relative change = 1.817e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, legal, manumission, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, free, manumission, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, legal 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.298, relative change = 1.753e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.298, relative change = 1.683e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.298, relative change = 1.619e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.298, relative change = 1.593e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.298, relative change = 1.555e-05) 
Topic 1: slave, free, legal, manumission, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, legal, manumission, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, free, manumission, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, manumission, legal, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, legal 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.298, relative change = 1.517e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.298, relative change = 1.443e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.298, relative change = 1.404e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.298, relative change = 1.345e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 40 (approx. per word bound = -2.298, relative change = 1.285e-05) 
Topic 1: slave, free, manumission, legal, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, legal, manumission, free 
 Topic 6: population, urban, free, manumission, law 
 Topic 7: market, law, free, manumission, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, legal, manumission, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, legal 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 41 (approx. per word bound = -2.298, relative change = 1.238e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 42 (approx. per word bound = -2.298, relative change = 1.159e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 43 (approx. per word bound = -2.298, relative change = 1.156e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 44 (approx. per word bound = -2.298, relative change = 1.087e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 45 (approx. per word bound = -2.298, relative change = 1.042e-05) 
Topic 1: slave, free, manumission, legal, urban 
 Topic 2: family, urban, legal, status, manumission 
 Topic 3: political, status, law, free, manumission 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: production, law, legal, manumission, free 
 Topic 6: population, urban, free, manumission, status 
 Topic 7: market, law, free, manumission, legal 
 Topic 8: labor, free, legal, status, law 
 Topic 9: public, urban, status, legal, free 
 Topic 10: men, free, status, law, legal 
 Topic 11: military, law, manumission, legal, free 
 Topic 12: society, law, manumission, free, legal 
 Topic 13: different, law, legal, manumission, free 
 Topic 14: system, status, law, free, manumission 
 Topic 15: large, law, urban, free, legal 
 Topic 16: important, status, law, free, legal 
 Topic 17: state, free, status, law, legal 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 46 (approx. per word bound = -2.298, relative change = 1.050e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 47 (approx. per word bound = -2.298, relative change = 1.055e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged 
Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ....................
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.360) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.320, relative change = 1.695e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.309, relative change = 4.904e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.304, relative change = 2.314e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.301, relative change = 1.342e-03) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, legal, free, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.299, relative change = 8.369e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.297, relative change = 5.440e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.297, relative change = 3.703e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.296, relative change = 2.640e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.295, relative change = 2.022e-04) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, legal, free, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.295, relative change = 1.575e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.295, relative change = 1.267e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.295, relative change = 1.067e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.294, relative change = 8.856e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.294, relative change = 7.600e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.294, relative change = 6.628e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.294, relative change = 5.864e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.294, relative change = 5.110e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.294, relative change = 4.605e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.294, relative change = 4.158e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, manumission, legal, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, manumission, free, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.294, relative change = 3.713e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 22 (approx. per word bound = -2.293, relative change = 3.406e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 23 (approx. per word bound = -2.293, relative change = 3.111e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 24 (approx. per word bound = -2.293, relative change = 2.834e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 25 (approx. per word bound = -2.293, relative change = 2.573e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 26 (approx. per word bound = -2.293, relative change = 2.408e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 27 (approx. per word bound = -2.293, relative change = 2.205e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 28 (approx. per word bound = -2.293, relative change = 2.065e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 29 (approx. per word bound = -2.293, relative change = 2.005e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 30 (approx. per word bound = -2.293, relative change = 1.794e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, manumission, legal, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 31 (approx. per word bound = -2.293, relative change = 1.691e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 32 (approx. per word bound = -2.293, relative change = 1.606e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 33 (approx. per word bound = -2.293, relative change = 1.534e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 34 (approx. per word bound = -2.293, relative change = 1.408e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 35 (approx. per word bound = -2.293, relative change = 1.351e-05) 
Topic 1: slave, free, legal, manumission, different 
 Topic 2: family, legal, manumission, free, different 
 Topic 3: political, manumission, free, legal, different 
 Topic 4: manumission, peculium, legal, free, different 
 Topic 5: production, legal, manumission, free, different 
 Topic 6: population, free, manumission, legal, different 
 Topic 7: market, manumission, free, legal, different 
 Topic 8: labor, free, legal, manumission, different 
 Topic 9: public, legal, free, manumission, different 
 Topic 10: men, free, legal, manumission, different 
 Topic 11: military, legal, manumission, free, different 
 Topic 12: society, manumission, free, legal, different 
 Topic 13: different, legal, manumission, free, family 
 Topic 14: system, free, manumission, legal, different 
 Topic 15: large, free, legal, manumission, different 
 Topic 16: important, free, manumission, legal, different 
 Topic 17: state, free, legal, manumission, different 
 Topic 18: law, legal, manumission, free, different 
 Topic 19: status, free, legal, manumission, different 
 Topic 20: urban, free, manumission, legal, different 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 36 (approx. per word bound = -2.293, relative change = 1.245e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 37 (approx. per word bound = -2.293, relative change = 1.250e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 38 (approx. per word bound = -2.293, relative change = 1.129e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 39 (approx. per word bound = -2.293, relative change = 1.106e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot diagnostics</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-58.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(dfm, <span class="at">min_termfreq =</span> <span class="dv">5</span>)  <span class="co"># Keep: filters noise without excessive pruning</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>stm_input <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm, <span class="at">to =</span> <span class="st">"stm"</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>stm_model <span class="ot">&lt;-</span> <span class="fu">stm</span>(</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">documents =</span> stm_input<span class="sc">$</span>documents,</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">vocab =</span> stm_input<span class="sc">$</span>vocab,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> stm_input<span class="sc">$</span>meta,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">15</span>,                                <span class="co"># Best coherence and strong overall fit</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prevalence =</span> <span class="sc">~</span> decade,                 <span class="co"># Tracks topic shifts over time</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.em.its =</span> <span class="dv">75</span>,                       <span class="co"># Sufficient; increase if convergence warning</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">init.type =</span> <span class="st">"Spectral"</span>,                <span class="co"># Stable with covariates</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beginning Spectral Initialization 
     Calculating the gram matrix...
     Finding anchor words...
    ...............
     Recovering initialization...
    
Initialization complete.
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 1 (approx. per word bound = -2.360) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 2 (approx. per word bound = -2.321, relative change = 1.667e-02) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 3 (approx. per word bound = -2.313, relative change = 3.591e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 4 (approx. per word bound = -2.309, relative change = 1.769e-03) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 5 (approx. per word bound = -2.306, relative change = 1.121e-03) 
Topic 1: slave, free, legal, manumission, large 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, free 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, important 
 Topic 6: production, large, law, free, important 
 Topic 7: market, important, free, law, large 
 Topic 8: labor, important, large, free, status 
 Topic 9: public, large, urban, important, legal 
 Topic 10: men, free, law, status, legal 
 Topic 11: military, free, large, law, manumission 
 Topic 12: society, law, large, free, manumission 
 Topic 13: system, free, law, status, important 
 Topic 14: state, status, free, law, legal 
 Topic 15: different, free, law, large, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 6 (approx. per word bound = -2.304, relative change = 7.354e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 7 (approx. per word bound = -2.303, relative change = 4.670e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 8 (approx. per word bound = -2.303, relative change = 2.869e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 9 (approx. per word bound = -2.302, relative change = 1.758e-04) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 10 (approx. per word bound = -2.302, relative change = 1.113e-04) 
Topic 1: slave, free, legal, large, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, free 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, important 
 Topic 6: production, large, law, free, important 
 Topic 7: market, important, free, law, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, urban, important, legal 
 Topic 10: men, free, law, status, legal 
 Topic 11: military, free, large, law, manumission 
 Topic 12: society, law, large, free, manumission 
 Topic 13: system, free, law, status, important 
 Topic 14: state, status, free, law, legal 
 Topic 15: different, free, law, large, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 11 (approx. per word bound = -2.302, relative change = 7.144e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 12 (approx. per word bound = -2.302, relative change = 5.084e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 13 (approx. per word bound = -2.302, relative change = 3.623e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 14 (approx. per word bound = -2.302, relative change = 2.734e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 15 (approx. per word bound = -2.301, relative change = 2.187e-05) 
Topic 1: slave, free, legal, large, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, free 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, important 
 Topic 6: production, large, law, free, important 
 Topic 7: market, important, law, free, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, urban, important, legal 
 Topic 10: men, free, law, status, legal 
 Topic 11: military, free, large, law, manumission 
 Topic 12: society, law, large, free, manumission 
 Topic 13: system, free, law, status, important 
 Topic 14: state, status, free, law, legal 
 Topic 15: different, free, law, large, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 16 (approx. per word bound = -2.301, relative change = 1.756e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 17 (approx. per word bound = -2.301, relative change = 1.542e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 18 (approx. per word bound = -2.301, relative change = 1.333e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 19 (approx. per word bound = -2.301, relative change = 1.211e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 20 (approx. per word bound = -2.301, relative change = 1.149e-05) 
Topic 1: slave, free, legal, large, manumission 
 Topic 2: family, important, urban, legal, large 
 Topic 3: political, important, status, law, free 
 Topic 4: manumission, peculium, legal, law, status 
 Topic 5: population, urban, large, free, important 
 Topic 6: production, large, law, free, important 
 Topic 7: market, important, law, free, large 
 Topic 8: labor, important, large, free, legal 
 Topic 9: public, large, urban, important, legal 
 Topic 10: men, free, law, status, legal 
 Topic 11: military, free, large, law, manumission 
 Topic 12: society, law, large, free, manumission 
 Topic 13: system, free, law, status, important 
 Topic 14: state, status, free, law, legal 
 Topic 15: different, free, law, large, important 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Completing Iteration 21 (approx. per word bound = -2.301, relative change = 1.115e-05) 
................
Completed E-Step (0 seconds). 
Completed M-Step. 
Model Converged </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">labelTopics</span>(stm_model, <span class="at">n =</span> <span class="dv">10</span>)  <span class="co"># Top 10 words per topic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Topic 1 Top Words:
     Highest Prob: slave, free, legal, large, manumission, urban, status, law, important, different 
     FREX: slave, free, legal, large, manumission, urban, status, important, law, different 
     Lift: slave, free, legal, manumission, large, urban, status, law, important, market 
     Score: slave, free, legal, manumission, large, urban, status, law, different, family 
Topic 2 Top Words:
     Highest Prob: family, important, urban, legal, large, status, manumission, law, free, different 
     FREX: family, important, urban, legal, large, status, law, free, manumission, different 
     Lift: family, important, urban, legal, large, status, manumission, law, free, market 
     Score: family, urban, important, legal, status, large, manumission, different, labor, market 
Topic 3 Top Words:
     Highest Prob: political, important, status, law, free, manumission, legal, large, urban, different 
     FREX: political, important, status, law, free, legal, manumission, urban, large, different 
     Lift: political, important, status, law, free, manumission, legal, large, urban, market 
     Score: political, important, status, law, different, family, labor, market, men, military 
Topic 4 Top Words:
     Highest Prob: manumission, peculium, legal, law, status, free, important, large, urban, different 
     FREX: manumission, peculium, legal, law, status, important, free, urban, large, different 
     Lift: peculium, manumission, legal, law, status, free, important, large, urban, market 
     Score: peculium, manumission, legal, status, law, important, different, family, labor, market 
Topic 5 Top Words:
     Highest Prob: population, urban, large, free, important, manumission, law, status, legal, different 
     FREX: population, urban, large, free, important, law, status, legal, manumission, different 
     Lift: population, urban, large, free, important, manumission, law, status, legal, market 
     Score: population, urban, large, free, important, manumission, different, family, labor, market 
Topic 6 Top Words:
     Highest Prob: production, large, law, free, important, manumission, legal, status, urban, different 
     FREX: production, large, important, legal, free, law, status, urban, manumission, different 
     Lift: production, large, law, free, important, manumission, legal, status, urban, market 
     Score: production, large, law, different, family, labor, market, men, military, peculium 
Topic 7 Top Words:
     Highest Prob: market, important, law, free, large, manumission, legal, urban, status, different 
     FREX: market, important, law, free, legal, large, urban, manumission, status, different 
     Lift: market, important, law, free, large, manumission, legal, urban, status, peculium 
     Score: market, important, law, large, free, different, family, labor, men, military 
Topic 8 Top Words:
     Highest Prob: labor, important, large, free, legal, status, law, manumission, urban, different 
     FREX: labor, important, large, free, legal, status, law, urban, manumission, different 
     Lift: labor, important, large, legal, free, status, law, manumission, urban, market 
     Score: labor, important, large, legal, free, status, urban, different, family, market 
Topic 9 Top Words:
     Highest Prob: public, large, urban, important, legal, status, free, law, manumission, different 
     FREX: public, large, urban, important, legal, status, free, law, manumission, different 
     Lift: public, large, urban, important, legal, status, free, law, manumission, market 
     Score: public, urban, large, important, legal, status, free, law, different, family 
Topic 10 Top Words:
     Highest Prob: men, free, law, status, legal, large, manumission, urban, important, different 
     FREX: men, free, law, legal, status, large, urban, important, manumission, different 
     Lift: men, law, free, status, legal, large, manumission, urban, important, market 
     Score: men, status, legal, law, free, large, manumission, urban, different, family 
Topic 11 Top Words:
     Highest Prob: military, free, large, law, manumission, important, legal, urban, status, different 
     FREX: military, free, important, legal, law, large, urban, manumission, status, different 
     Lift: military, free, large, law, manumission, important, legal, urban, status, market 
     Score: military, large, manumission, different, family, labor, market, men, peculium, political 
Topic 12 Top Words:
     Highest Prob: society, law, large, free, manumission, important, legal, urban, status, different 
     FREX: society, law, large, legal, important, free, urban, manumission, status, different 
     Lift: society, law, large, free, manumission, important, legal, urban, status, market 
     Score: society, law, large, different, family, labor, market, men, military, peculium 
Topic 13 Top Words:
     Highest Prob: system, free, law, status, important, manumission, legal, large, urban, different 
     FREX: system, important, free, status, legal, law, urban, manumission, large, different 
     Lift: system, free, law, status, important, manumission, legal, large, urban, market 
     Score: system, law, free, status, important, different, family, labor, market, men 
Topic 14 Top Words:
     Highest Prob: state, status, free, law, legal, large, manumission, important, urban, different 
     FREX: state, status, free, legal, law, important, large, urban, manumission, different 
     Lift: state, status, free, law, legal, large, manumission, important, urban, market 
     Score: state, status, free, law, legal, urban, different, family, labor, market 
Topic 15 Top Words:
     Highest Prob: different, free, law, large, important, manumission, legal, status, urban, family 
     FREX: different, important, free, legal, law, large, status, urban, manumission, family 
     Lift: different, free, law, large, important, manumission, legal, status, urban, market 
     Score: different, large, important, family, labor, market, men, military, peculium, political </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stm_model, <span class="at">type =</span> <span class="st">"summary"</span>, <span class="at">n =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-59.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">topic =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">15</span>),</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">proportion =</span> <span class="fu">colMeans</span>(stm_model<span class="sc">$</span>theta)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(<span class="fu">as.factor</span>(topic), <span class="sc">-</span>proportion), <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Topic"</span>, <span class="at">y =</span> <span class="st">"Average Proportion"</span>, <span class="at">title =</span> <span class="st">"Average Topic Proportions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-60.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>prep <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">~</span> decade, stm_model, <span class="at">meta =</span> stm_input<span class="sc">$</span>meta)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(prep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
estimateEffect(formula = 1:15 ~ decade, stmobj = stm_model, metadata = stm_input$meta)


Topic 1:

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.19333    0.18267   1.058    0.315
decade1980      0.08812    0.24094   0.366    0.722
decade1990     -0.16354    0.23450  -0.697    0.501
decade2000      0.12046    0.22820   0.528    0.609
decade2010      0.10769    0.23904   0.450    0.662
decadeOriginal  0.01386    0.32068   0.043    0.966


Topic 2:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    0.0099379  0.1046898   0.095    0.926
decade1980     0.1780010  0.1402691   1.269    0.233
decade1990     0.0040481  0.1354228   0.030    0.977
decade2000     0.0283488  0.1281543   0.221    0.829
decade2010     0.0006606  0.1349186   0.005    0.996
decadeOriginal 0.0174440  0.1805782   0.097    0.925


Topic 3:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.069223   0.103147   0.671    0.517
decade1980     -0.062038   0.132283  -0.469    0.649
decade1990      0.162286   0.135673   1.196    0.259
decade2000     -0.045876   0.126579  -0.362    0.725
decade2010     -0.054402   0.133367  -0.408    0.692
decadeOriginal  0.001766   0.179566   0.010    0.992


Topic 4:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    0.0032264  0.0917135   0.035    0.973
decade1980     0.0003089  0.1187785   0.003    0.998
decade1990     0.0013492  0.1188436   0.011    0.991
decade2000     0.0042129  0.1121946   0.038    0.971
decade2010     0.1567150  0.1327681   1.180    0.265
decadeOriginal 0.0008884  0.1587133   0.006    0.996


Topic 5:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.036822   0.107002   0.344    0.738
decade1980      0.017691   0.138901   0.127    0.901
decade1990      0.001038   0.138193   0.008    0.994
decade2000      0.193474   0.134294   1.441    0.180
decade2010     -0.028083   0.136351  -0.206    0.841
decadeOriginal -0.002899   0.183732  -0.016    0.988


Topic 6:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.091907   0.096645   0.951    0.364
decade1980     -0.080235   0.121557  -0.660    0.524
decade1990     -0.011616   0.122120  -0.095    0.926
decade2000     -0.005713   0.117360  -0.049    0.962
decade2010      0.015913   0.128526   0.124    0.904
decadeOriginal -0.034497   0.166339  -0.207    0.840


Topic 7:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.017791   0.051570   0.345    0.737
decade1980     -0.010959   0.065342  -0.168    0.870
decade1990      0.096751   0.075416   1.283    0.228
decade2000      0.005826   0.064117   0.091    0.929
decade2010     -0.015542   0.065724  -0.236    0.818
decadeOriginal  0.013500   0.089568   0.151    0.883


Topic 8:

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.09146    0.12113   0.755    0.468
decade1980      0.04592    0.15902   0.289    0.779
decade1990      0.11978    0.15780   0.759    0.465
decade2000     -0.01342    0.14584  -0.092    0.928
decade2010     -0.05446    0.15475  -0.352    0.732
decadeOriginal -0.02580    0.20668  -0.125    0.903


Topic 9:

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)     0.20248    0.08343   2.427   0.0356 *
decade1980     -0.15262    0.10171  -1.501   0.1644  
decade1990     -0.16992    0.09946  -1.708   0.1184  
decade2000     -0.18084    0.09668  -1.871   0.0909 .
decade2010     -0.18986    0.10092  -1.881   0.0893 .
decadeOriginal -0.07426    0.13653  -0.544   0.5984  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 10:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.014330   0.063673   0.225    0.826
decade1980      0.100051   0.086161   1.161    0.273
decade1990     -0.008131   0.081957  -0.099    0.923
decade2000      0.049335   0.078963   0.625    0.546
decade2010      0.100682   0.089546   1.124    0.287
decadeOriginal  0.168492   0.123360   1.366    0.202


Topic 11:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.025921   0.041706   0.622    0.548
decade1980      0.019108   0.057131   0.334    0.745
decade1990     -0.013448   0.053456  -0.252    0.806
decade2000     -0.004706   0.050803  -0.093    0.928
decade2010      0.032446   0.059062   0.549    0.595
decadeOriginal -0.008628   0.071136  -0.121    0.906


Topic 12:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.085905   0.055796   1.540    0.155
decade1980     -0.071416   0.069415  -1.029    0.328
decade1990      0.002518   0.070099   0.036    0.972
decade2000     -0.070489   0.064573  -1.092    0.301
decade2010     -0.077561   0.068427  -1.133    0.283
decadeOriginal -0.045051   0.090182  -0.500    0.628


Topic 13:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.055557   0.032885   1.689    0.122
decade1980     -0.044954   0.040641  -1.106    0.295
decade1990      0.004158   0.046035   0.090    0.930
decade2000     -0.047101   0.038837  -1.213    0.253
decade2010     -0.038115   0.041242  -0.924    0.377
decadeOriginal -0.023437   0.052233  -0.449    0.663


Topic 14:

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.031379   0.024295   1.292    0.226
decade1980      0.012347   0.032842   0.376    0.715
decade1990     -0.001102   0.032054  -0.034    0.973
decade2000     -0.021410   0.029309  -0.730    0.482
decade2010     -0.013936   0.031272  -0.446    0.665
decadeOriginal  0.043936   0.048328   0.909    0.385


Topic 15:

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     0.07120    0.06673   1.067    0.311
decade1980     -0.04019    0.08530  -0.471    0.648
decade1990     -0.02683    0.08590  -0.312    0.761
decade2000     -0.01290    0.08110  -0.159    0.877
decade2010      0.05561    0.09063   0.614    0.553
decadeOriginal -0.04931    0.11269  -0.438    0.671</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prep, <span class="at">covariate =</span> <span class="st">"decade"</span>, <span class="at">topics =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">"difference"</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">cov.value1 =</span> <span class="st">"2010"</span>, <span class="at">cov.value2 =</span> <span class="st">"Original"</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Difference in Topic Proportion"</span>, <span class="at">main =</span> <span class="st">"Topic 1: 2010 vs Original"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-61.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">topicCorr</span>(stm_model) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-62.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toLDAvis</span>(stm_model, stm_input<span class="sc">$</span>documents)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Estimate effect of decade on all topics</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>prep <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">~</span> decade, stm_model, <span class="at">meta =</span> stm_input<span class="sc">$</span>meta)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Loop through topics and plot differences: 2010 vs Original</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>) {</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(prep,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">covariate =</span> <span class="st">"decade"</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">topics =</span> k,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="st">"difference"</span>,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">cov.value1 =</span> <span class="st">"2010"</span>,</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">cov.value2 =</span> <span class="st">"Original"</span>,</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">"Difference in Topic Proportion (2010 – Original)"</span>,</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Topic"</span>, k, <span class="st">": 2010 vs Original"</span>))</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-63.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-64.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-65.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-66.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-67.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-68.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-69.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-70.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-71.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-72.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-73.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-74.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-75.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-76.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-77.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Loop through all 15 topics and plot by decade</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>) {</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(prep,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">covariate =</span> <span class="st">"decade"</span>,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">topics =</span> k,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">model =</span> stm_model,</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">"Decade"</span>,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"Expected Topic Proportion"</span>,</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Topic"</span>, k, <span class="st">": Trend by Decade"</span>))</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-78.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-79.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-80.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-81.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-82.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-83.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-84.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-85.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-86.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-87.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-88.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-89.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-90.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-91.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-92.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === Estimate topic correlations</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>topic_corr <span class="ot">&lt;-</span> <span class="fu">topicCorr</span>(stm_model)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># === Base R static plot</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(topic_corr,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"STM Topic Correlation Map (Intertopic Distances)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-93.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">########</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Estimate topic correlations</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>topic_corr <span class="ot">&lt;-</span> <span class="fu">topicCorr</span>(stm_model)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Replace non-positive correlations with 0</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>adj_matrix <span class="ot">&lt;-</span> topic_corr<span class="sc">$</span>cor</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>adj_matrix[adj_matrix <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co"># === Define topic labels</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>topic_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Slavery &amp; Status"</span>, <span class="st">"Family &amp; Military"</span>, <span class="st">"Politics &amp; Institutions"</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Freedom &amp; Ownership"</span>, <span class="st">"Urban Demography"</span>, <span class="st">"Production &amp; War"</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Markets &amp; Structure"</span>, <span class="st">"Labor &amp; Control"</span>, <span class="st">"Public Systems"</span>,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gender &amp; Citizenship"</span>, <span class="st">"Military Service &amp; Liberation"</span>, <span class="st">"Social Order &amp; Emancipation"</span>, <span class="st">"Governance &amp; Social Structure"</span>, <span class="st">"State &amp; Civil Rights"</span>, <span class="st">"Variation &amp; Law"</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create igraph object using cleaned matrix</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(adj_matrix,</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">mode =</span> <span class="st">"undirected"</span>,</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weighted =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">diag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co"># === Use Fruchterman-Reingold layout (now valid)</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">layout_with_fr</span>(g, <span class="at">weights =</span> <span class="fu">E</span>(g)<span class="sc">$</span>weight)</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the graph</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g,</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">layout =</span> layout,</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label =</span> topic_labels,</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.color =</span> <span class="st">"black"</span>,</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.color =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size =</span> <span class="dv">25</span>,</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.width =</span> <span class="fu">E</span>(g)<span class="sc">$</span>weight <span class="sc">*</span> <span class="dv">5</span>,</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"STM Intertopic Correlation Map"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-94.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># #findThoughts</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Example: Get top 3 representative documents for Topic 1</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # stm_model: your trained STM model</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # stm_input: your preprocessed input object that includes $documents and $meta</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Add document texts to metadata if not already included ===</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="co"># stm_input$meta$document_texts &lt;- texts  # Make sure 'texts' matches document order</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Loop through all topics and print top 3 representative passages ===</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for (k in 1:15) {</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   cat("\n Top Thoughts for Topic", k, "\n")</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   top_docs &lt;- findThoughts(</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     model = stm_model,</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     texts = stm_input$meta$document_texts,</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     topics = k,</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     n = 3</span></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   cat(paste0(" ", top_docs$docs[[1]]), sep = "\n\n")</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ############</span></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Add document names to metadata if not already included ===</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a><span class="co"># stm_input$meta$docname &lt;- names(texts)  # assuming 'texts' is a named vector with filenames</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Loop through each topic and output the top 3 filenames ===</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a><span class="co"># for (k in 1:15) {</span></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   cat("\n Top Documents for Topic", k, "\n")</span></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   top_docs &lt;- findThoughts(</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     model = stm_model,</span></span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     texts = stm_input$meta$docname,</span></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     topics = k,</span></span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     n = 3</span></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   cat(paste0(" ", top_docs$docs[[1]]), sep = "\n")</span></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ##########</span></span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a><span class="co"># === Extract FREX words for each topic ===</span></span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a>frex_words <span class="ot">&lt;-</span> <span class="fu">labelTopics</span>(stm_model, <span class="at">n =</span> <span class="dv">10</span>)<span class="sc">$</span>frex  <span class="co"># Top 10 FREX words per topic</span></span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a><span class="co"># === Display FREX terms cleanly per topic ===</span></span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(frex_words))) {</span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> Topic"</span>, k, <span class="st">"— FREX Words:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">" "</span>, frex_words[k, ]), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Topic 1 — FREX Words:
  slave
  free
  legal
  large
  manumission
  urban
  status
  important
  law
  different

 Topic 2 — FREX Words:
  family
  important
  urban
  legal
  large
  status
  law
  free
  manumission
  different

 Topic 3 — FREX Words:
  political
  important
  status
  law
  free
  legal
  manumission
  urban
  large
  different

 Topic 4 — FREX Words:
  manumission
  peculium
  legal
  law
  status
  important
  free
  urban
  large
  different

 Topic 5 — FREX Words:
  population
  urban
  large
  free
  important
  law
  status
  legal
  manumission
  different

 Topic 6 — FREX Words:
  production
  large
  important
  legal
  free
  law
  status
  urban
  manumission
  different

 Topic 7 — FREX Words:
  market
  important
  law
  free
  legal
  large
  urban
  manumission
  status
  different

 Topic 8 — FREX Words:
  labor
  important
  large
  free
  legal
  status
  law
  urban
  manumission
  different

 Topic 9 — FREX Words:
  public
  large
  urban
  important
  legal
  status
  free
  law
  manumission
  different

 Topic 10 — FREX Words:
  men
  free
  law
  legal
  status
  large
  urban
  important
  manumission
  different

 Topic 11 — FREX Words:
  military
  free
  important
  legal
  law
  large
  urban
  manumission
  status
  different

 Topic 12 — FREX Words:
  society
  law
  large
  legal
  important
  free
  urban
  manumission
  status
  different

 Topic 13 — FREX Words:
  system
  important
  free
  status
  legal
  law
  urban
  manumission
  large
  different

 Topic 14 — FREX Words:
  state
  status
  free
  legal
  law
  important
  large
  urban
  manumission
  different

 Topic 15 — FREX Words:
  different
  important
  free
  legal
  law
  large
  status
  urban
  manumission
  family</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #############</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute topic correlations ===</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>topic_corr <span class="ot">&lt;-</span> <span class="fu">topicCorr</span>(stm_model)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Extract the numeric correlation matrix ===</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> topic_corr<span class="sc">$</span>cor  <span class="co"># symmetric matrix of topic-topic correlations</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="co"># === Optionally round for easier viewing ===</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>cor_matrix_rounded <span class="ot">&lt;-</span> <span class="fu">round</span>(cor_matrix, <span class="dv">3</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Print correlation matrix ===</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_matrix_rounded)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]  [,10]
 [1,]  1.000 -0.264 -0.380  0.119 -0.059 -0.436 -0.243  0.053 -0.281  0.286
 [2,] -0.264  1.000 -0.090 -0.094  0.000 -0.116 -0.145 -0.208 -0.133  0.000
 [3,] -0.380 -0.090  1.000 -0.089 -0.184 -0.071 -0.028 -0.245  0.188 -0.224
 [4,]  0.119 -0.094 -0.089  1.000 -0.134 -0.191 -0.139 -0.173 -0.149 -0.161
 [5,] -0.059  0.000 -0.184 -0.134  1.000 -0.173 -0.013 -0.054 -0.119 -0.193
 [6,] -0.436 -0.116 -0.071 -0.191 -0.173  1.000  0.156 -0.098 -0.069 -0.045
 [7,] -0.243 -0.145 -0.028 -0.139 -0.013  0.156  1.000  0.203 -0.136 -0.288
 [8,]  0.053 -0.208 -0.245 -0.173 -0.054 -0.098  0.203  1.000 -0.127 -0.101
 [9,] -0.281 -0.133  0.188 -0.149 -0.119 -0.069 -0.136 -0.127  1.000  0.012
[10,]  0.286  0.000 -0.224 -0.161 -0.193 -0.045 -0.288 -0.101  0.012  1.000
[11,] -0.486  0.449 -0.073 -0.178 -0.078  0.561 -0.152 -0.299  0.000 -0.103
[12,] -0.191 -0.069  0.018 -0.128 -0.129  0.267  0.791 -0.044 -0.141 -0.282
[13,] -0.297 -0.194  0.917  0.047 -0.284 -0.117 -0.011 -0.247  0.269 -0.292
[14,] -0.128 -0.193  0.255 -0.056 -0.278 -0.243  0.011  0.024  0.391  0.362
[15,] -0.510  0.000  0.037 -0.146 -0.103  0.759 -0.117 -0.248  0.195 -0.136
       [,11]  [,12]  [,13]  [,14]  [,15]
 [1,] -0.486 -0.191 -0.297 -0.128 -0.510
 [2,]  0.449 -0.069 -0.194 -0.193  0.000
 [3,] -0.073  0.018  0.917  0.255  0.037
 [4,] -0.178 -0.128  0.047 -0.056 -0.146
 [5,] -0.078 -0.129 -0.284 -0.278 -0.103
 [6,]  0.561  0.267 -0.117 -0.243  0.759
 [7,] -0.152  0.791 -0.011  0.011 -0.117
 [8,] -0.299 -0.044 -0.247  0.024 -0.248
 [9,]  0.000 -0.141  0.269  0.391  0.195
[10,] -0.103 -0.282 -0.292  0.362 -0.136
[11,]  1.000 -0.112 -0.169 -0.221  0.863
[12,] -0.112  1.000  0.193  0.063 -0.118
[13,] -0.169  0.193  1.000  0.397 -0.045
[14,] -0.221  0.063  0.397  1.000 -0.209
[15,]  0.863 -0.118 -0.045 -0.209  1.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # === (Optional) Save to CSV for reporting ===</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># #write.csv(cor_matrix_rounded, file = "topic_correlation_matrix.csv", row.names = TRUE)</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="do">########</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute and prepare topic correlation matrix ===</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>topic_corr <span class="ot">&lt;-</span> <span class="fu">topicCorr</span>(stm_model)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">round</span>(topic_corr<span class="sc">$</span>cor, <span class="dv">3</span>)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co"># === Melt to long format for ggplot2 ===</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(cor_matrix)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Topic1"</span>, <span class="st">"Topic2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co"># === Create heatmap with subtle diverging colors ===</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_df, <span class="fu">aes</span>(<span class="at">x =</span> Topic1, <span class="at">y =</span> Topic2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"RdBu"</span>,  <span class="co"># diverging palette: red = high, blue = low</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,    <span class="co"># reverse it so blue = low, red = high</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"STM Topic Correlation Heatmap"</span>,</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Topic"</span>,</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Topic"</span></span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-95.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># === Define custom topic labels ===</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>topic_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Slavery &amp; Status"</span>, <span class="st">"Family &amp; Military"</span>, <span class="st">"Politics &amp; Institutions"</span>,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Freedom &amp; Ownership"</span>, <span class="st">"Urban Demography"</span>, <span class="st">"Production &amp; War"</span>,</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Markets &amp; Structure"</span>, <span class="st">"Labor &amp; Control"</span>, <span class="st">"Public Systems"</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gender &amp; Citizenship"</span>, <span class="st">"Military Service &amp; Liberation"</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Social Order &amp; Emancipation"</span>, <span class="st">"Governance &amp; Social Structure"</span>,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"State &amp; Civil Rights"</span>, <span class="st">"Valuation &amp; Law"</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute and reshape correlation matrix ===</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>topic_corr <span class="ot">&lt;-</span> <span class="fu">topicCorr</span>(stm_model)</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">round</span>(topic_corr<span class="sc">$</span>cor, <span class="dv">3</span>)</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor_matrix) <span class="ot">&lt;-</span> topic_labels</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_matrix) <span class="ot">&lt;-</span> topic_labels</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(cor_matrix)</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Topic1"</span>, <span class="st">"Topic2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="co"># === Plot the heatmap with topic names on axes ===</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_df, <span class="fu">aes</span>(<span class="at">x =</span> Topic1, <span class="at">y =</span> Topic2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"STM Topic Correlation Heatmap"</span>,</span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Topic"</span>,</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Topic"</span></span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-96.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Estimate prevalence effect of covariate on topic proportions ===</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prep &lt;- estimateEffect(1:15 ~ decade, stm_model, meta = stm_input$meta)</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Extract R²-like variance explained values for each topic ===</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rsq_values &lt;- summary(prep, topics = 1:15)$rsq</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Combine into a data frame for display or plotting ===</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rsq_df &lt;- data.frame(</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   Topic = paste0("Topic_", 1:15),</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   Variance_Explained = round(rsq_values, 3)</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # === View table ===</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print(rsq_df)</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # === Optional: Barplot of variance explained per topic ===</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(rsq_df, aes(x = reorder(Topic, -Variance_Explained), y = Variance_Explained)) +</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_col(fill = "skyblue") +</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Estimated Variance Explained by 'decade' (per Topic)",</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Topic",</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a><span class="co">#        y = "Variance Explained (Pseudo R²)") +</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ###########</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a><span class="co"># === Extract theta matrix (topic proportions per document) ===</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> stm_model<span class="sc">$</span>theta  <span class="co"># rows = documents, cols = topics</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a><span class="co"># === Compute Shannon entropy for each document ===</span></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>entropy <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">rowSums</span>(theta <span class="sc">*</span> <span class="fu">log</span>(theta <span class="sc">+</span> <span class="fl">1e-12</span>))  <span class="co"># add small value to avoid log(0)</span></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a><span class="co"># === Add entropy to metadata ===</span></span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>stm_input<span class="sc">$</span>meta<span class="sc">$</span>entropy <span class="ot">&lt;-</span> entropy</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a><span class="co"># === Histogram of entropy across all documents ===</span></span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stm_input<span class="sc">$</span>meta, <span class="fu">aes</span>(<span class="at">x =</span> entropy)) <span class="sc">+</span></span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entropy of Topic Assignments per Document"</span>,</span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Entropy (Topic Distribution Uncertainty)"</span>,</span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Document Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-97.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Optional: Summarize entropy by decade ===</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>entropy_by_decade <span class="ot">&lt;-</span> stm_input<span class="sc">$</span>meta <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decade) <span class="sc">%&gt;%</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_entropy =</span> <span class="fu">mean</span>(entropy), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(entropy_by_decade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  decade   mean_entropy
  &lt;chr&gt;           &lt;dbl&gt;
1 1970             1.96
2 1980             1.65
3 1990             1.69
4 2000             1.59
5 2010             1.41
6 Original         2.36</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #######</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Compute entropy for each document ===</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>entropy_values <span class="ot">&lt;-</span> <span class="fu">apply</span>(stm_model<span class="sc">$</span>theta, <span class="dv">1</span>, <span class="cf">function</span>(p) {</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log</span>(p <span class="sc">+</span> <span class="fl">1e-10</span>))  <span class="co"># add small constant to avoid log(0)</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Create a data frame with document-level entropy and metadata ===</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>entropy_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc_id =</span> <span class="fu">seq_along</span>(entropy_values),</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">entropy =</span> entropy_values,</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">decade =</span> stm_input<span class="sc">$</span>meta<span class="sc">$</span>decade</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Summary statistics by decade ===</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>summary_by_decade <span class="ot">&lt;-</span> entropy_df <span class="sc">%&gt;%</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decade) <span class="sc">%&gt;%</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_entropy =</span> <span class="fu">mean</span>(entropy),</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_entropy =</span> <span class="fu">sd</span>(entropy),</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_entropy =</span> <span class="fu">min</span>(entropy),</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_entropy =</span> <span class="fu">max</span>(entropy),</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_by_decade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  decade   mean_entropy sd_entropy min_entropy max_entropy     n
  &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
1 1970             1.96     0.0901        1.89        2.02     2
2 1980             1.65     0.243         1.47        1.93     3
3 1990             1.69     0.364         1.45        2.11     3
4 2000             1.59     0.345         1.34        2.09     4
5 2010             1.41     0.295         1.17        1.74     3
6 Original         2.36    NA             2.36        2.36     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Run one-way ANOVA ===</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>anova_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(entropy <span class="sc">~</span> decade, <span class="at">data =</span> entropy_df)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)
decade       5 0.8776 0.17552   1.903  0.181
Residuals   10 0.9224 0.09224               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Optional: Plot entropy distribution by decade ===</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(entropy_df, <span class="fu">aes</span>(<span class="at">x =</span> decade, <span class="at">y =</span> entropy)) <span class="sc">+</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Entropy of Topic Distributions by Decade"</span>,</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Decade"</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Entropy (Topic Distribution Uncertainty)"</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-98.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 1: Compute entropy for each document ===</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>entropy_values <span class="ot">&lt;-</span> <span class="fu">apply</span>(stm_model<span class="sc">$</span>theta, <span class="dv">1</span>, <span class="cf">function</span>(p) {</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log</span>(p <span class="sc">+</span> <span class="fl">1e-10</span>))  <span class="co"># small constant avoids log(0)</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 2: Create a data frame with entropy and metadata ===</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>entropy_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc_id =</span> <span class="fu">seq_along</span>(entropy_values),</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">entropy =</span> entropy_values,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">decade =</span> stm_input<span class="sc">$</span>meta<span class="sc">$</span>decade</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 3: Summary statistics by decade ===</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>summary_by_decade <span class="ot">&lt;-</span> entropy_df <span class="sc">%&gt;%</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(decade) <span class="sc">%&gt;%</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_entropy =</span> <span class="fu">mean</span>(entropy),</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_entropy =</span> <span class="fu">sd</span>(entropy),</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_entropy =</span> <span class="fu">min</span>(entropy),</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_entropy =</span> <span class="fu">max</span>(entropy),</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_by_decade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  decade   mean_entropy sd_entropy min_entropy max_entropy     n
  &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
1 1970             1.96     0.0901        1.89        2.02     2
2 1980             1.65     0.243         1.47        1.93     3
3 1990             1.69     0.364         1.45        2.11     3
4 2000             1.59     0.345         1.34        2.09     4
5 2010             1.41     0.295         1.17        1.74     3
6 Original         2.36    NA             2.36        2.36     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 4: Run one-way ANOVA ===</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>anova_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(entropy <span class="sc">~</span> decade, <span class="at">data =</span> entropy_df)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)
decade       5 0.8776 0.17552   1.903  0.181
Residuals   10 0.9224 0.09224               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 5: Tukey's HSD for pairwise comparisons ===</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>tukey_result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(anova_result)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tukey_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = entropy ~ decade, data = entropy_df)

$decade
                     diff        lwr       upr     p adj
1980-1970     -0.30318073 -1.2661440 0.6597826 0.8733581
1990-1970     -0.26990296 -1.2328663 0.6930604 0.9164189
2000-1970     -0.36524479 -1.2787920 0.5483024 0.7329725
2010-1970     -0.54784684 -1.5108102 0.4151165 0.4156858
Original-1970  0.40908099 -0.8828699 1.7010319 0.8708608
1990-1980      0.03327777 -0.8280228 0.8945783 0.9999916
2000-1980     -0.06206406 -0.8677370 0.7436089 0.9997476
2010-1980     -0.24466612 -1.1059667 0.6166345 0.9121818
Original-1980  0.71226171 -0.5058012 1.9303247 0.3894854
2000-1990     -0.09534183 -0.9010148 0.7103311 0.9980045
2010-1990     -0.27794389 -1.1392445 0.5833567 0.8622537
Original-1990  0.67898395 -0.5390790 1.8970469 0.4353248
2010-2000     -0.18260206 -0.9882750 0.6230709 0.9635697
Original-2000  0.77432578 -0.4050586 1.9537102 0.2844215
Original-2010  0.95692783 -0.2611351 2.1749908 0.1525005</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 6: Compute effect size (eta squared) ===</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>eta_sq <span class="ot">&lt;-</span> <span class="fu">eta_squared</span>(anova_result)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eta_sq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Effect Size for ANOVA

Parameter | Eta2 |       95% CI
-------------------------------
decade    | 0.49 | [0.00, 1.00]

- One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># === Step 7: Optional plot ===</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(entropy_df, <span class="fu">aes</span>(<span class="at">x =</span> decade, <span class="at">y =</span> entropy)) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Entropy of Topic Distributions by Decade"</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Decade"</span>,</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Entropy (Topic Distribution Uncertainty)"</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Finley15_files/figure-html/main_r-99.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>